<?xml version="1.0" encoding="UTF-8"?>
<con:pipelineEntry xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations">
    <con:coreEntry>
        <con:binding type="SOAP" isSoap12="false" xsi:type="con:SoapBindingType">
            <con3:wsdl ref="GestorUSSD/Resources/WSDL/USSDOperaciones" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con="http://www.bea.com/wli/sb/services/bindings/config" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/pipeline/config"/>
            <con:binding>
                <con:name>USSDOperacionesPortBinding</con:name>
                <con:namespace>http://ussd.operaciones.wom.ws.ncl.com</con:namespace>
            </con:binding>
        </con:binding>
        <oper:operations>
            <oper:monitoring enabled="true" aggregationInterval="10" level="pipeline"/>
            <oper:tracingEnabled>true</oper:tracingEnabled>
            <oper:reporting>true</oper:reporting>
            <oper:logging enabled="true" level="debug"/>
            <oper:sla-alerting enabled="true" level="normal"/>
            <oper:pipeline-alerting enabled="true" level="normal"/>
        </oper:operations>
    </con:coreEntry>
    <con:router xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config">
        <con:pipeline type="request" name="PipelineUSSDOperaciones_request">
            <con:stage name="setEventoOperacion">
                <con:context>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con2:assign varName="EventoOperacion">
                        <con1:id>_ActionId-9202987288639765781--5bdac8a6.1542979a4b5.-7945</con1:id>
                        <con2:expr>
                            <con1:xqueryText>$body/ussd:ussdOperacion/tipoOperacion/text()</con1:xqueryText>
                        </con2:expr>
                    </con2:assign>
                </con:actions>
            </con:stage>
            <con:stage name="validaParametrosEntrada" errorHandler="_onErrorHandler-847409460263594367--43cfa5ab.153f11f750f.-7c2d">
                <con:context>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con2:assign varName="bodyRequest">
                        <con1:id>_ActionId-9202987288639765781--5bdac8a6.1542979a4b5.-7a63</con1:id>
                        <con2:expr>
                            <con1:xqueryText>fn-bea:serialize($body/ussd:ussdOperacion)</con1:xqueryText>
                        </con2:expr>
                    </con2:assign>
                    <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-847409460263594367--43cfa5ab.153f11f750f.-7c65</con1:id>
                        <con4:logLevel>info</con4:logLevel>
                        <con4:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con4:expr>
                        <con4:message>-----|||Request PSUSSDOperaciones|||-----</con4:message>
                    </con4:log>
                    <con3:validate xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-847409460263594367--43cfa5ab.153f11f750f.-7c64</con1:id>
                        <con3:schema ref="GestorUSSD/Resources/WSDL/USSDOperaciones"/>
                        <con3:schemaElement xmlns:ussd="http://ussd.operaciones.wom.ws.ncl.com">ussd:ussdOperacion</con3:schemaElement>
                        <con3:varName>body</con3:varName>
                        <con3:location>
                            <con1:xpathText>./ussd:ussdOperacion</con1:xpathText>
                        </con3:location>
                    </con3:validate>
                    <con2:ifThenElse>
                        <con1:id>_ActionId-4609904447350628191-6d7a2582.154059a7eca.-7f93</con1:id>
                        <con2:case>
                            <con2:condition>
                                <con1:xqueryText>empty($body/ussd:ussdOperacion/nroCelular/text())</con1:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:Error>
                                    <con1:id>_ActionId-4609904447350628191-6d7a2582.154059a7eca.-7f5b</con1:id>
                                    <con2:errCode>00123</con2:errCode>
                                    <con2:message>El campo nroCelular debe ser ingresado</con2:message>
                                </con2:Error>
                            </con2:actions>
                        </con2:case>
                        <con2:case>
                            <con2:condition>
                                <con1:xqueryText>empty($body/ussd:ussdOperacion/tipoOperacion/text())</con1:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:Error>
                                    <con1:id>_ActionId-4609904447350628191-6d7a2582.154059a7eca.-7eb3</con1:id>
                                    <con2:errCode>00123</con2:errCode>
                                    <con2:message>El campo tipoOperacion debe ser ingresado</con2:message>
                                </con2:Error>
                            </con2:actions>
                        </con2:case>
                        <con2:default/>
                    </con2:ifThenElse>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="PipelineUSSDOperaciones_response"/>
        <con:pipeline type="error" name="_onErrorHandler-847409460263594367--43cfa5ab.153f11f750f.-7c2d">
            <con:stage name="stgErrorInValidate">
                <con:context>
                    <con1:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1"/>
                    <con1:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/PROVI_BOLS/REGISTROS_PG/REGISTRA_ERRORES_FN/" prefix="rlog"/>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-9202987288639765781--5bdac8a6.1542979a4b5.-7943</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
   <segmento></segmento>
   <errorCode>VAL-0001</errorCode>
   <errorDescription>{concat('stage: ',$fault/ctx:location/ctx:stage/text(),', Error: ',if( $fault/ctx:errorCode/text() = '00123') then ($fault/ctx:reason/text()) else ($fault/ctx:details/con1:ValidationFailureDetail/con1:message/text()))}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-1487657368312215333-2005ed96.15433afe5d3.-7d64</con1:id>
                        <con4:logLevel>error</con4:logLevel>
                        <con4:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con4:expr>
                        <con4:message>-----|||Response PSUSSDOperaciones|||-----</con4:message>
                    </con4:log>
                    <con2:ifThenElse>
                        <con1:id>_ActionId-9202987288639765781--5bdac8a6.1542979a4b5.-79bb</con1:id>
                        <con2:case>
                            <con2:condition>
                                <con1:xqueryText>$EventoOperacion = '1'</con1:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:assign varName="bodyResponse">
                                    <con1:id>_ActionId-9202987288639765781--5bdac8a6.1542979a4b5.-7897</con1:id>
                                    <con2:expr>
                                        <con1:xqueryText>fn-bea:serialize($body/ussd:ussdOperacionResponse)</con1:xqueryText>
                                    </con2:expr>
                                </con2:assign>
                                <con2:assign varName="stageError">
                                    <con1:id>_ActionId-9202987288639765781--5bdac8a6.1542979a4b5.-7895</con1:id>
                                    <con2:expr>
                                        <con1:xqueryText>$fault/ctx:location/ctx:stage/text()</con1:xqueryText>
                                    </con2:expr>
                                </con2:assign>
                                <con2:wsCallout>
                                    <con1:id>_ActionId-9202987288639765781--5bdac8a6.1542979a4b5.-788b</con1:id>
                                    <con2:service xsi:type="ref:BusinessServiceRef" ref="GestorUSSD/Business Services/BSServiceSetEventErrorServicePrepaid" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con2:operation>setEventErrorServicePrepaidDba</con2:operation>
                                    <con2:request>
                                        <con2:body>eventErrorServicePrepaidReq</con2:body>
                                    </con2:request>
                                    <con2:response>
                                        <con2:body>eventErrorServicePrepaidResp</con2:body>
                                    </con2:response>
                                    <con2:requestTransform>
                                        <con2:assign varName="eventErrorServicePrepaidReq">
                                            <con1:id>_ActionId-9202987288639765781--5bdac8a6.1542979a4b5.-788f</con1:id>
                                            <con2:expr>
                                                <con1:xqueryText><![CDATA[<reg:InputParameters xmlns:reg="http://xmlns.oracle.com/pcbpel/adapter/db/PROVI_BOLS/REGISTROS_PG/REGISTRA_ERRORES_FN/">
    <!--Optional:-->
    <reg:EN_NUM_REGISTRO>0</reg:EN_NUM_REGISTRO>
    <!--Optional:-->
    <reg:EV_NOM_USUARIO>USSD</reg:EV_NOM_USUARIO>
    <!--Optional:-->
    <reg:EV_NOM_METODO>CompraBolsasUSSD</reg:EV_NOM_METODO>
    <!--Optional:-->
    <reg:EV_DES_QUERY>{$stageError}</reg:EV_DES_QUERY>
    <!--Optional:-->
    <reg:EN_COD_RESPUESTA>{$body/ussd:ussdOperacionResponse/errorDescription/text()}</reg:EN_COD_RESPUESTA>
    <!--Optional:-->
    <reg:EV_MENS_RESPUESTA>{
    fn:substring($body/ussd:ussdOperacionResponse/errorDescription/text(),0,2001)
    }</reg:EV_MENS_RESPUESTA>
    <!--Optional:-->
    <reg:EV_NUM_ERROR_ORA>{$body/ussd:ussdOperacionResponse/errorCode/text()}</reg:EV_NUM_ERROR_ORA>
    <!--Optional:-->
    <reg:EV_DES_ERROR_ORA>{fn:substring($body/ussd:ussdOperacionResponse/errorDescription/text(),0,2001)}</reg:EV_DES_ERROR_ORA>
    <!--Optional:-->
    <reg:EC_DES_REQUEST>{$bodyRequest}</reg:EC_DES_REQUEST>
    <!--Optional:-->
    <reg:EC_DES_RESPONSE>{$bodyResponse}</reg:EC_DES_RESPONSE>
</reg:InputParameters>]]></con1:xqueryText>
                                            </con2:expr>
                                        </con2:assign>
                                    </con2:requestTransform>
                                    <con2:responseTransform>
                                        <con2:assign varName="eventoError">
                                            <con1:id>_ActionId-9202987288639765781--5bdac8a6.1542979a4b5.-788e</con1:id>
                                            <con2:expr>
                                                <con1:xqueryText>$eventErrorServicePrepaidResp/rlog:REGISTRA_ERRORES_FN/text()</con1:xqueryText>
                                            </con2:expr>
                                        </con2:assign>
                                        <con2:replace varName="body" contents-only="true">
                                            <con1:id>_ActionId-9202987288639765781--5bdac8a6.1542979a4b5.-788d</con1:id>
                                            <con2:expr>
                                                <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
	<errorCode>{$body/ussd:ussdOperacionResponse/errorCode/text()}</errorCode>
	<errorDescription>{concat('Transacción error: ',$eventoError,', Mensaje: ',$body/ussd:ussdOperacionResponse/errorDescription/text())}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                                            </con2:expr>
                                        </con2:replace>
                                        <con1:reply>
                                            <con1:id>_ActionId-9202987288639765781--5bdac8a6.1542979a4b5.-788c</con1:id>
                                        </con1:reply>
                                    </con2:responseTransform>
                                </con2:wsCallout>
                            </con2:actions>
                        </con2:case>
                        <con2:default>
                            <con1:reply xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                                <con1:id>_ActionId-9202987288639765781--5bdac8a6.1542979a4b5.-79b7</con1:id>
                            </con1:reply>
                        </con2:default>
                    </con2:ifThenElse>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="request" name="PipelinePairSegmento_request" errorHandler="_onErrorHandler-194002751992053644--538027f5.1540a9e515e.-7eb0">
            <con:stage name="getSegmentoCustomerInfo">
                <con:context>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con2:wsCallout>
                        <con1:id>_ActionId-847409460263594367--43cfa5ab.153f11f750f.-78c9</con1:id>
                        <con2:service xsi:type="ref:ProxyRef" ref="PortalCautivo/Proxy Services/PSBSCSPortalCautivoService" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>getNextelCustomerInfo</con2:operation>
                        <con2:request>
                            <con2:body>nextelCustomerInfoReq</con2:body>
                        </con2:request>
                        <con2:response>
                            <con2:body>nextelCustomerInfoResp</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                            <con2:replace varName="nextelCustomerInfoReq">
                                <con1:id>_ActionId-847409460263594367--43cfa5ab.153f11f750f.-783d</con1:id>
                                <con2:expr>
                                    <con1:xqueryTransform>
                                        <con1:resource ref="GestorUSSD/Resources/XQuery/IN_XQ_setCustomerInfo"/>
                                        <con1:param name="nroCelular">
                                            <con1:path>$body/ussd:ussdOperacion/nroCelular/text()</con1:path>
                                        </con1:param>
                                    </con1:xqueryTransform>
                                </con2:expr>
                            </con2:replace>
                        </con2:requestTransform>
                        <con2:responseTransform>
                            <con2:assign varName="segmento">
                                <con1:id>_ActionId-5118877757178843816-22f1016c.1566c0ada9d.-7dc0</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>upper-case(normalize-space($nextelCustomerInfoResp/segment_client/text()))</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:assign varName="LCtmcode">
                                <con1:id>_ActionId-3675802704336726882-19c03bf3.1612f5f57eb.-7f79</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>$nextelCustomerInfoResp/iDPlan/text()</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                        </con2:responseTransform>
                    </con2:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage name="getPlataformaPrepago">
                <con:context>
                    <con1:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/getPlataformaXPlanDba" prefix="pln"/>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con4:wsCallout xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7c26</con1:id>
                        <con4:service xsi:type="ref:BusinessServiceRef" ref="GestorUSSD/Business Services/BSServiceGetPlataformaXPlan" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con4:operation>getPlataformaXPlanDba</con4:operation>
                        <con4:request>
                            <con4:body>plataformaXPlanReq</con4:body>
                        </con4:request>
                        <con4:response>
                            <con4:body>plataformaXPlanRes</con4:body>
                        </con4:response>
                        <con4:requestTransform>
                            <con4:replace varName="plataformaXPlanReq" contents-only="false">
                                <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7c2c</con1:id>
                                <con4:expr>
                                    <con1:xqueryTransform>
                                        <con1:resource ref="GestorUSSD/Resources/XQuery/IN_XQ_GetPlataformaXPlan"/>
                                        <con1:param name="tmcode">
                                            <con1:path>$LCtmcode</con1:path>
                                        </con1:param>
                                    </con1:xqueryTransform>
                                </con4:expr>
                            </con4:replace>
                        </con4:requestTransform>
                        <con4:responseTransform>
                            <con4:assign varName="PlataformaPCRF">
                                <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7c2b</con1:id>
                                <con4:expr>
                                    <con1:xqueryText>upper-case($plataformaXPlanRes/pln:getPlataformaXPlanDbaOutput/pln:PLATAFORM_PCRF[1]/text())</con1:xqueryText>
                                </con4:expr>
                            </con4:assign>
                            <con4:assign varName="PlataformaICC">
                                <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7c2a</con1:id>
                                <con4:expr>
                                    <con1:xqueryText>upper-case($plataformaXPlanRes/pln:getPlataformaXPlanDbaOutput/pln:PLATAFORM_ICC[1]/text())</con1:xqueryText>
                                </con4:expr>
                            </con4:assign>
                            <con4:assign varName="clasificaOferta">
                                <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7c28</con1:id>
                                <con4:expr>
                                    <con1:xqueryText>if(empty($plataformaXPlanRes/pln:getPlataformaXPlanDbaOutput/pln:CLASIFICA_OFERTA[1]/text()) or $plataformaXPlanRes/pln:getPlataformaXPlanDbaOutput/pln:CLASIFICA_OFERTA[1]/text() = '') then (
'NaN'
)else(
	$plataformaXPlanRes/pln:getPlataformaXPlanDbaOutput/pln:CLASIFICA_OFERTA[1]/text()
)</con1:xqueryText>
                                </con4:expr>
                            </con4:assign>
                            <con4:assign varName="flagPrepago">
                                <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7c27</con1:id>
                                <con4:expr>
                                    <con1:xqueryText>if (upper-case($PlataformaPCRF) = 'X') then 
('PREPA_PCRFID')
else
(
if (upper-case($PlataformaICC) = 'X') then 
('PREPA_ICCID')
else
('PREPA_PCRFID')
)</con1:xqueryText>
                                </con4:expr>
                            </con4:assign>
                        </con4:responseTransform>
                    </con4:wsCallout>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="PipelinePairSegmento_response" errorHandler="_onErrorHandler-194002751992053644--538027f5.1540a9e515e.-7eaf">
            <con:stage name="getSegmentoCustomerInfoOut">
                <con:context/>
                <con:actions>
                    <con2:replace varName="body" contents-only="true">
                        <con1:id>_ActionId-847409460263594367--43cfa5ab.153f11f750f.-768a</con1:id>
                        <con2:expr>
                            <con1:xqueryTransform>
                                <con1:resource ref="GestorUSSD/Resources/XQuery/OUT_XQ_setCustomerInfo"/>
                                <con1:param name="clasificaOferta">
                                    <con1:path>$clasificaOferta</con1:path>
                                </con1:param>
                                <con1:param name="getNextelCustomerInfoResponse1">
                                    <con1:path>$nextelCustomerInfoResp</con1:path>
                                </con1:param>
                                <con1:param name="plataforma">
                                    <con1:path>$flagPrepago</con1:path>
                                </con1:param>
                            </con1:xqueryTransform>
                        </con2:expr>
                    </con2:replace>
                    <con2:delete varName="LCtmcode">
                        <con1:id>_ActionId-3675802704336726882-19c03bf3.1612f5f57eb.-7f05</con1:id>
                    </con2:delete>
                    <con2:delete varName="segmento">
                        <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7df0</con1:id>
                    </con2:delete>
                    <con2:delete varName="PlataformaPCRF">
                        <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7dee</con1:id>
                    </con2:delete>
                    <con2:delete varName="PlataformaICC">
                        <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7ded</con1:id>
                    </con2:delete>
                    <con2:delete varName="flagPrepago">
                        <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7deb</con1:id>
                    </con2:delete>
                    <con2:delete varName="clasificaOferta">
                        <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7c6c</con1:id>
                    </con2:delete>
                    <con1:reply>
                        <con1:id>_ActionId-847409460263594367--43cfa5ab.153f11f750f.-766d</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="request" name="PipelinePairDefault_request">
            <con:stage name="getOperacionDefault">
                <con:context>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-847409460263594367--43cfa5ab.153f11f750f.-7938</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
   <segmento></segmento>
   <errorCode>ERR-1111</errorCode>
   <errorDescription>{concat('Ingreso un tipo de operación invalida, Operación: ',$body/ussd:ussdOperacion/tipoOperacion/text(),', favor comunicarse con el administrador.' )}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-1487657368312215333-2005ed96.15433afe5d3.-7d2b</con1:id>
                        <con4:logLevel>error</con4:logLevel>
                        <con4:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con4:expr>
                        <con4:message>-----|||Response PSUSSDOperaciones|||-----</con4:message>
                    </con4:log>
                    <con1:reply isError="false" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-773b</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="PipelinePairDefault_response"/>
        <con:pipeline type="request" name="PipelinePairCompraBolsas_request" errorHandler="_onErrorHandler-194002751992053644--538027f5.1540a9e515e.-7eae">
            <con:stage name="validaParametroEntradaXCompra">
                <con:context>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con2:ifThenElse>
                        <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-7f1f</con1:id>
                        <con2:case>
                            <con2:condition>
                                <con1:xqueryText>empty($body/ussd:ussdOperacion/idProd/text()) or empty($body/ussd:ussdOperacion/idServicio/text())</con1:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:Error>
                                    <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-7f1e</con1:id>
                                    <con2:errCode>VAL-0001</con2:errCode>
                                    <con2:message>los campos idProd y idServicio deben ser ingresados</con2:message>
                                </con2:Error>
                            </con2:actions>
                        </con2:case>
                        <con2:default/>
                    </con2:ifThenElse>
                </con:actions>
            </con:stage>
            <con:stage name="getCustomerInfo">
                <con:context>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con2:wsCallout>
                        <con1:id>_ActionId-4609904447350628191-6d7a2582.154059a7eca.-7dba</con1:id>
                        <con2:service xsi:type="ref:ProxyRef" ref="PortalCautivo/Proxy Services/PSBSCSPortalCautivoService" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>getNextelCustomerInfo</con2:operation>
                        <con2:request>
                            <con2:body>nextelCustomerInfoReq</con2:body>
                        </con2:request>
                        <con2:response>
                            <con2:body>nextelCustomerInfoResp</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                            <con2:replace varName="nextelCustomerInfoReq">
                                <con1:id>_ActionId-4609904447350628191-6d7a2582.154059a7eca.-7dbb</con1:id>
                                <con2:expr>
                                    <con1:xqueryTransform>
                                        <con1:resource ref="GestorUSSD/Resources/XQuery/IN_XQ_setCustomerInfo"/>
                                        <con1:param name="nroCelular">
                                            <con1:path>$body/ussd:ussdOperacion/nroCelular/text()</con1:path>
                                        </con1:param>
                                    </con1:xqueryTransform>
                                </con2:expr>
                            </con2:replace>
                        </con2:requestTransform>
                        <con2:responseTransform/>
                    </con2:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage name="setNextelActiveProduct">
                <con:context>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con2:wsCallout>
                        <con1:id>_ActionId-4609904447350628191-6d7a2582.154059a7eca.-7cf9</con1:id>
                        <con2:service xsi:type="ref:ProxyRef" ref="PortalCautivo/Proxy Services/PSBSCSPortalCautivoService" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>setNextelActiveProduct</con2:operation>
                        <con2:request>
                            <con2:body>NextelActiveProductReq</con2:body>
                        </con2:request>
                        <con2:response>
                            <con2:body>NextelActiveProductResp</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                            <con2:replace varName="NextelActiveProductReq">
                                <con1:id>_ActionId-4609904447350628191-6d7a2582.154059a7eca.-7cc0</con1:id>
                                <con2:expr>
                                    <con1:xqueryTransform>
                                        <con1:resource ref="GestorUSSD/Resources/XQuery/IN_XQ_NextelActiveProduct_OutInfoCliente"/>
                                        <con1:param name="id_prod_service">
                                            <con1:path>$body/ussd:ussdOperacion/idServicio/text()</con1:path>
                                        </con1:param>
                                        <con1:param name="getNextelCustomerInfoResponse1">
                                            <con1:path>$nextelCustomerInfoResp</con1:path>
                                        </con1:param>
                                        <con1:param name="id_prod">
                                            <con1:path>$body/ussd:ussdOperacion/idProd/text()</con1:path>
                                        </con1:param>
                                        <con1:param name="nroCelular">
                                            <con1:path>$body/ussd:ussdOperacion/nroCelular/text()</con1:path>
                                        </con1:param>
                                    </con1:xqueryTransform>
                                </con2:expr>
                            </con2:replace>
                        </con2:requestTransform>
                        <con2:responseTransform>
                            <con2:assign varName="msjPortalRespuesta">
                                <con1:id>_ActionId-922314644721791269-30c1b5a0.15472db8909.-7f6f</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>$NextelActiveProductResp/err_description/text()</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:assign varName="codPortalRespuesta">
                                <con1:id>_ActionId-922314644721791269-30c1b5a0.15472db8909.-7d2a</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>$NextelActiveProductResp/error_code/text()</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                        </con2:responseTransform>
                    </con2:wsCallout>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="PipelinePairCompraBolsas_response" errorHandler="_onErrorHandler-194002751992053644--538027f5.1540a9e515e.-7ead">
            <con:stage name="outCompraBolsas">
                <con:comment/>
                <con:context>
                    <con1:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/getInfoMensajeDba" prefix="ns0"/>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con2:ifThenElse>
                        <con1:id>_ActionId-922314644721791269-30c1b5a0.15472db8909.-7fa9</con1:id>
                        <con2:case>
                            <con2:condition>
                                <con1:xqueryText>fn-bea:trim(upper-case($msjPortalRespuesta)) = 'OK'</con1:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:wsCallout>
                                    <con1:id>_ActionId-922314644721791269-30c1b5a0.15472db8909.-7eb4</con1:id>
                                    <con2:service xsi:type="ref:BusinessServiceRef" ref="GestorUSSD/Business Services/BSServiceGetInfoMensaje" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con2:operation>getInfoMensajeDba</con2:operation>
                                    <con2:request>
                                        <con2:body>InfoMensajeReq</con2:body>
                                    </con2:request>
                                    <con2:response>
                                        <con2:body>InfoMensajeResp</con2:body>
                                    </con2:response>
                                    <con2:requestTransform>
                                        <con2:replace varName="InfoMensajeReq" contents-only="false">
                                            <con1:id>_ActionId-922314644721791269-30c1b5a0.15472db8909.-7eb8</con1:id>
                                            <con2:expr>
                                                <con1:xqueryTransform>
                                                    <con1:resource ref="GestorUSSD/Resources/XQuery/IN_XQ_getMensaje"/>
                                                    <con1:param name="idMsj">
                                                        <con1:path>$body/ussd:ussdOperacion/idProd/text()</con1:path>
                                                    </con1:param>
                                                </con1:xqueryTransform>
                                            </con2:expr>
                                        </con2:replace>
                                    </con2:requestTransform>
                                    <con2:responseTransform>
                                        <con2:assign varName="msjOut">
                                            <con1:id>_ActionId-922314644721791269-30c1b5a0.15472db8909.-7eb7</con1:id>
                                            <con2:expr>
                                                <con1:xqueryText>$InfoMensajeResp/ns0:getInfoMensajeDbaOutput[1]/ns0:MENSAJE/text()</con1:xqueryText>
                                            </con2:expr>
                                        </con2:assign>
                                        <con2:ifThenElse>
                                            <con1:id>_ActionId-922314644721791269-30c1b5a0.15472db8909.-7eb6</con1:id>
                                            <con2:case>
                                                <con2:condition>
                                                    <con1:xqueryText>empty($msjOut)</con1:xqueryText>
                                                </con2:condition>
                                                <con2:actions>
                                                    <con2:assign varName="msjOut">
                                                        <con1:id>_ActionId-922314644721791269-30c1b5a0.15472db8909.-7df0</con1:id>
                                                        <con2:expr>
                                                            <con1:xqueryText>'Felicidades su bolsa ha sido activada :D.'</con1:xqueryText>
                                                        </con2:expr>
                                                    </con2:assign>
                                                </con2:actions>
                                            </con2:case>
                                            <con2:default/>
                                        </con2:ifThenElse>
                                        <con2:replace varName="body" contents-only="true">
                                            <con1:id>_ActionId-922314644721791269-30c1b5a0.15472db8909.-7d63</con1:id>
                                            <con2:expr>
                                                <con1:xqueryTransform>
                                                    <con1:resource ref="GestorUSSD/Resources/XQuery/OUT_XQ_Msj_NextelActiveProduct"/>
                                                    <con1:param name="codError">
                                                        <con1:path>$codPortalRespuesta</con1:path>
                                                    </con1:param>
                                                    <con1:param name="msjError">
                                                        <con1:path>$msjOut</con1:path>
                                                    </con1:param>
                                                </con1:xqueryTransform>
                                            </con2:expr>
                                        </con2:replace>
                                    </con2:responseTransform>
                                </con2:wsCallout>
                            </con2:actions>
                        </con2:case>
                        <con2:default>
                            <con2:replace varName="body" contents-only="true">
                                <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7ba2</con1:id>
                                <con2:expr>
                                    <con1:xqueryTransform>
                                        <con1:resource ref="GestorUSSD/Resources/XQuery/OUT_XQ_NextelActiveProduct"/>
                                        <con1:param name="setNextelActiveProductResponse1">
                                            <con1:path>$NextelActiveProductResp</con1:path>
                                        </con1:param>
                                    </con1:xqueryTransform>
                                </con2:expr>
                            </con2:replace>
                        </con2:default>
                    </con2:ifThenElse>
                    <con2:delete varName="InfoMensajeResp">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7b0c</con1:id>
                    </con2:delete>
                    <con2:delete varName="InfoMensajeReq">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7b0b</con1:id>
                    </con2:delete>
                    <con2:delete varName="NextelActiveProductResp">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7b0a</con1:id>
                    </con2:delete>
                    <con2:delete varName="NextelActiveProductReq">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7b09</con1:id>
                    </con2:delete>
                    <con2:delete varName="getBolsaIlimitadaXPlanResp">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7b08</con1:id>
                    </con2:delete>
                    <con2:delete varName="getBolsaIlimitadaXPlanReq">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7b07</con1:id>
                    </con2:delete>
                    <con2:delete varName="nextelCustomerInfoResp">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7b06</con1:id>
                    </con2:delete>
                    <con2:delete varName="nextelCustomerInfoReq">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7b05</con1:id>
                    </con2:delete>
                    <con2:delete varName="msjOut">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7b04</con1:id>
                    </con2:delete>
                    <con2:delete varName="codPortalRespuesta">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7b03</con1:id>
                    </con2:delete>
                    <con2:delete varName="msjPortalRespuesta">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7b02</con1:id>
                    </con2:delete>
                    <con1:reply isError="false">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7afe</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-194002751992053644--538027f5.1540a9e515e.-7eb0">
            <con:stage name="stgErrorInSeg">
                <con:context>
                    <con1:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1"/>
                </con:context>
                <con:actions>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-7e3c</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
   <segmento></segmento>
   <errorCode>{$fault/ctx:errorCode/text()}</errorCode>
   <errorDescription>{concat('stage: ',$fault/ctx:location/ctx:stage/text(),', Error: ', $fault/ctx:reason/text())}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con2:delete varName="LCtmcode">
                        <con1:id>_ActionId-3675802704336726882-19c03bf3.1612f5f57eb.-7f3e</con1:id>
                    </con2:delete>
                    <con2:delete varName="segmento">
                        <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7d46</con1:id>
                    </con2:delete>
                    <con2:delete varName="PlataformaPCRF">
                        <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7ef1</con1:id>
                    </con2:delete>
                    <con2:delete varName="PlataformaICC">
                        <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7eb8</con1:id>
                    </con2:delete>
                    <con2:delete varName="flagPrepago">
                        <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7e9a</con1:id>
                    </con2:delete>
                    <con2:delete varName="clasificaOferta">
                        <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7c6e</con1:id>
                    </con2:delete>
                    <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-1487657368312215333-2005ed96.15433afe5d3.-7b24</con1:id>
                        <con4:logLevel>error</con4:logLevel>
                        <con4:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con4:expr>
                        <con4:message>-----|||Response PSUSSDOperaciones|||-----</con4:message>
                    </con4:log>
                    <con1:reply isError="false" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-7e3b</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-194002751992053644--538027f5.1540a9e515e.-7eaf">
            <con:stage name="stgErrorOutSeg">
                <con:context>
                    <con1:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1"/>
                </con:context>
                <con:actions>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-7d5a</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
   <segmento></segmento>
   <errorCode>{$fault/ctx:errorCode/text()}</errorCode>
   <errorDescription>{concat('stage: ',$fault/ctx:location/ctx:stage/text(),', Error: ', $fault/ctx:reason/text())}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con2:delete varName="LCtmcode">
                        <con1:id>_ActionId-3675802704336726882-19c03bf3.1612f5f57eb.-7ee8</con1:id>
                    </con2:delete>
                    <con2:delete varName="segmento">
                        <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7e19</con1:id>
                    </con2:delete>
                    <con2:delete varName="PlataformaPCRF">
                        <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7e17</con1:id>
                    </con2:delete>
                    <con2:delete varName="PlataformaICC">
                        <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7e16</con1:id>
                    </con2:delete>
                    <con2:delete varName="flagPrepago">
                        <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7e14</con1:id>
                    </con2:delete>
                    <con2:delete varName="clasificaOferta">
                        <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7c6a</con1:id>
                    </con2:delete>
                    <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-1487657368312215333-2005ed96.15433afe5d3.-7b41</con1:id>
                        <con4:logLevel>error</con4:logLevel>
                        <con4:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con4:expr>
                        <con4:message>-----|||Response PSUSSDOperaciones|||-----</con4:message>
                    </con4:log>
                    <con1:reply isError="false" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-7dc9</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-194002751992053644--538027f5.1540a9e515e.-7eae">
            <con:stage name="stgErrorInCompBols">
                <con:context>
                    <con1:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1"/>
                    <con1:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/PROVI_BOLS/REGISTROS_PG/REGISTRA_ERRORES_FN/" prefix="rlog"/>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-7ce9</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
   <segmento></segmento>
   <errorCode>{$fault/ctx:errorCode/text()}</errorCode>
   <errorDescription>{concat('stage: ',$fault/ctx:location/ctx:stage/text(),', Error: ', $fault/ctx:reason/text())}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con2:assign varName="bodyResponse">
                        <con1:id>_ActionId-9202987288639765781--5bdac8a6.1542979a4b5.-7a2b</con1:id>
                        <con2:expr>
                            <con1:xqueryText>fn-bea:serialize($body/ussd:ussdOperacionResponse)</con1:xqueryText>
                        </con2:expr>
                    </con2:assign>
                    <con2:assign varName="stageError">
                        <con1:id>_ActionId-9202987288639765781--5bdac8a6.1542979a4b5.-79f3</con1:id>
                        <con2:expr>
                            <con1:xqueryText>$fault/ctx:location/ctx:stage/text()</con1:xqueryText>
                        </con2:expr>
                    </con2:assign>
                    <con2:wsCallout>
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7ad7</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="GestorUSSD/Business Services/BSServiceSetEventErrorServicePrepaid" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>setEventErrorServicePrepaidDba</con2:operation>
                        <con2:request>
                            <con2:body>eventErrorServicePrepaidReq</con2:body>
                        </con2:request>
                        <con2:response>
                            <con2:body>eventErrorServicePrepaidResp</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                            <con2:assign varName="eventErrorServicePrepaidReq">
                                <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7adb</con1:id>
                                <con2:expr>
                                    <con1:xqueryText><![CDATA[<reg:InputParameters xmlns:reg="http://xmlns.oracle.com/pcbpel/adapter/db/PROVI_BOLS/REGISTROS_PG/REGISTRA_ERRORES_FN/">
    <!--Optional:-->
    <reg:EN_NUM_REGISTRO>0</reg:EN_NUM_REGISTRO>
    <!--Optional:-->
    <reg:EV_NOM_USUARIO>USSD</reg:EV_NOM_USUARIO>
    <!--Optional:-->
    <reg:EV_NOM_METODO>CompraBolsasUSSD</reg:EV_NOM_METODO>
    <!--Optional:-->
    <reg:EV_DES_QUERY>{$stageError}</reg:EV_DES_QUERY>
    <!--Optional:-->
    <reg:EN_COD_RESPUESTA>{$body/ussd:ussdOperacionResponse/errorDescription/text()}</reg:EN_COD_RESPUESTA>
    <!--Optional:-->
    <reg:EV_MENS_RESPUESTA>{
    fn:substring($body/ussd:ussdOperacionResponse/errorDescription/text(),0,2001)
    }</reg:EV_MENS_RESPUESTA>
    <!--Optional:-->
    <reg:EV_NUM_ERROR_ORA>{$body/ussd:ussdOperacionResponse/errorCode/text()}</reg:EV_NUM_ERROR_ORA>
    <!--Optional:-->
    <reg:EV_DES_ERROR_ORA>{fn:substring($body/ussd:ussdOperacionResponse/errorDescription/text(),0,2001)}</reg:EV_DES_ERROR_ORA>
    <!--Optional:-->
    <reg:EC_DES_REQUEST>{$bodyRequest}</reg:EC_DES_REQUEST>
    <!--Optional:-->
    <reg:EC_DES_RESPONSE>{$bodyResponse}</reg:EC_DES_RESPONSE>
</reg:InputParameters>]]></con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                        </con2:requestTransform>
                        <con2:responseTransform>
                            <con2:assign varName="eventoError">
                                <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7ada</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>$eventErrorServicePrepaidResp/rlog:REGISTRA_ERRORES_FN/text()</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:replace varName="body" contents-only="true">
                                <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7ad9</con1:id>
                                <con2:expr>
                                    <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
	<errorCode>{$body/ussd:ussdOperacionResponse/errorCode/text()}</errorCode>
	<errorDescription>{concat('Transacción error: ',$eventoError,', Mensaje: ',$body/ussd:ussdOperacionResponse/errorDescription/text())}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                                </con2:expr>
                            </con2:replace>
                            <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                                <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7ad8</con1:id>
                                <con4:logLevel>error</con4:logLevel>
                                <con4:expr>
                                    <con1:xqueryText>$body</con1:xqueryText>
                                </con4:expr>
                                <con4:message>-----|||Response PSUSSDOperaciones|||-----</con4:message>
                            </con4:log>
                        </con2:responseTransform>
                    </con2:wsCallout>
                    <con2:delete varName="msjPortalRespuesta">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7c46</con1:id>
                    </con2:delete>
                    <con2:delete varName="codPortalRespuesta">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7c45</con1:id>
                    </con2:delete>
                    <con2:delete varName="msjOut">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7c44</con1:id>
                    </con2:delete>
                    <con2:delete varName="nextelCustomerInfoReq">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7c43</con1:id>
                    </con2:delete>
                    <con2:delete varName="nextelCustomerInfoResp">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7c42</con1:id>
                    </con2:delete>
                    <con2:delete varName="getBolsaIlimitadaXPlanReq">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7c41</con1:id>
                    </con2:delete>
                    <con2:delete varName="getBolsaIlimitadaXPlanResp">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7c40</con1:id>
                    </con2:delete>
                    <con2:delete varName="NextelActiveProductReq">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7c3f</con1:id>
                    </con2:delete>
                    <con2:delete varName="NextelActiveProductResp">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7c3e</con1:id>
                    </con2:delete>
                    <con2:delete varName="InfoMensajeReq">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7c3d</con1:id>
                    </con2:delete>
                    <con2:delete varName="InfoMensajeResp">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7c3c</con1:id>
                    </con2:delete>
                    <con1:reply isError="false">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7ae1</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-194002751992053644--538027f5.1540a9e515e.-7ead">
            <con:stage name="stgErrorOutCompBols">
                <con:comment/>
                <con:context>
                    <con1:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1"/>
                    <con1:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/PROVI_BOLS/REGISTROS_PG/REGISTRA_ERRORES_FN/" prefix="rlog"/>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-7c79</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
   <segmento></segmento>
   <errorCode>{$fault/ctx:errorCode/text()}</errorCode>
   <errorDescription>{concat('stage: ',$fault/ctx:location/ctx:stage/text(),', Error: ', $fault/ctx:reason/text())}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con2:assign varName="bodyResponse">
                        <con1:id>_ActionId-9202987288639765781--5bdac8a6.1542979a4b5.-7919</con1:id>
                        <con2:expr>
                            <con1:xqueryText>fn-bea:serialize($body/ussd:ussdOperacionResponse)</con1:xqueryText>
                        </con2:expr>
                    </con2:assign>
                    <con2:assign varName="stageError">
                        <con1:id>_ActionId-9202987288639765781--5bdac8a6.1542979a4b5.-7918</con1:id>
                        <con2:expr>
                            <con1:xqueryText>$fault/ctx:location/ctx:stage/text()</con1:xqueryText>
                        </con2:expr>
                    </con2:assign>
                    <con2:wsCallout>
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7b96</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="GestorUSSD/Business Services/BSServiceSetEventErrorServicePrepaid" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>setEventErrorServicePrepaidDba</con2:operation>
                        <con2:request>
                            <con2:body>eventErrorServicePrepaidReq</con2:body>
                        </con2:request>
                        <con2:response>
                            <con2:body>eventErrorServicePrepaidResp</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                            <con2:assign varName="eventErrorServicePrepaidReq">
                                <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7b9b</con1:id>
                                <con2:expr>
                                    <con1:xqueryText><![CDATA[<reg:InputParameters xmlns:reg="http://xmlns.oracle.com/pcbpel/adapter/db/PROVI_BOLS/REGISTROS_PG/REGISTRA_ERRORES_FN/">
    <!--Optional:-->
    <reg:EN_NUM_REGISTRO>0</reg:EN_NUM_REGISTRO>
    <!--Optional:-->
    <reg:EV_NOM_USUARIO>USSD</reg:EV_NOM_USUARIO>
    <!--Optional:-->
    <reg:EV_NOM_METODO>CompraBolsasUSSD</reg:EV_NOM_METODO>
    <!--Optional:-->
    <reg:EV_DES_QUERY>{$stageError}</reg:EV_DES_QUERY>
    <!--Optional:-->
    <reg:EN_COD_RESPUESTA>{$body/ussd:ussdOperacionResponse/errorDescription/text()}</reg:EN_COD_RESPUESTA>
    <!--Optional:-->
    <reg:EV_MENS_RESPUESTA>{
    fn:substring($body/ussd:ussdOperacionResponse/errorDescription/text(),0,2001)
    }</reg:EV_MENS_RESPUESTA>
    <!--Optional:-->
    <reg:EV_NUM_ERROR_ORA>{$body/ussd:ussdOperacionResponse/errorCode/text()}</reg:EV_NUM_ERROR_ORA>
    <!--Optional:-->
    <reg:EV_DES_ERROR_ORA>{fn:substring($body/ussd:ussdOperacionResponse/errorDescription/text(),0,2001)}</reg:EV_DES_ERROR_ORA>
    <!--Optional:-->
    <reg:EC_DES_REQUEST>{$bodyRequest}</reg:EC_DES_REQUEST>
    <!--Optional:-->
    <reg:EC_DES_RESPONSE>{$bodyResponse}</reg:EC_DES_RESPONSE>
</reg:InputParameters>]]></con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                        </con2:requestTransform>
                        <con2:responseTransform>
                            <con2:assign varName="eventoError">
                                <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7b9a</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>$eventErrorServicePrepaidResp/rlog:REGISTRA_ERRORES_FN/text()</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:replace varName="body" contents-only="true">
                                <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7b99</con1:id>
                                <con2:expr>
                                    <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
	<errorCode>{$body/ussd:ussdOperacionResponse/errorCode/text()}</errorCode>
	<errorDescription>{concat('Transacción error: ',$eventoError,', Mensaje: ',$body/ussd:ussdOperacionResponse/errorDescription/text())}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                                </con2:expr>
                            </con2:replace>
                            <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                                <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7b98</con1:id>
                                <con4:logLevel>error</con4:logLevel>
                                <con4:expr>
                                    <con1:xqueryText>$body</con1:xqueryText>
                                </con4:expr>
                                <con4:message>-----|||Response PSUSSDOperaciones|||-----</con4:message>
                            </con4:log>
                        </con2:responseTransform>
                    </con2:wsCallout>
                    <con2:delete varName="msjPortalRespuesta">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7c77</con1:id>
                    </con2:delete>
                    <con2:delete varName="codPortalRespuesta">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7c76</con1:id>
                    </con2:delete>
                    <con2:delete varName="msjOut">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7c75</con1:id>
                    </con2:delete>
                    <con2:delete varName="nextelCustomerInfoReq">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7c74</con1:id>
                    </con2:delete>
                    <con2:delete varName="nextelCustomerInfoResp">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7c73</con1:id>
                    </con2:delete>
                    <con2:delete varName="getBolsaIlimitadaXPlanReq">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7c72</con1:id>
                    </con2:delete>
                    <con2:delete varName="getBolsaIlimitadaXPlanResp">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7c71</con1:id>
                    </con2:delete>
                    <con2:delete varName="NextelActiveProductReq">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7c70</con1:id>
                    </con2:delete>
                    <con2:delete varName="NextelActiveProductResp">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7c6f</con1:id>
                    </con2:delete>
                    <con2:delete varName="InfoMensajeReq">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7c6e</con1:id>
                    </con2:delete>
                    <con2:delete varName="InfoMensajeResp">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7c6d</con1:id>
                    </con2:delete>
                    <con1:reply isError="false">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7b94</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="request" name="PipelineMsjPromocion_request" errorHandler="_onErrorHandler-194002751992053644--538027f5.1540a9e515e.-77ae">
            <con:stage name="getMensajePromocional">
                <con:context>
                    <con1:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/getInfoMensajeDba" prefix="ns0"/>
                </con:context>
                <con:actions>
                    <con2:wsCallout>
                        <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-7a72</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="GestorUSSD/Business Services/BSServiceGetInfoMensaje" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>getInfoMensajeDba</con2:operation>
                        <con2:request>
                            <con2:body>InfoMensajeReq</con2:body>
                        </con2:request>
                        <con2:response>
                            <con2:body>InfoMensajeResp</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                            <con2:replace varName="InfoMensajeReq">
                                <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-7a3a</con1:id>
                                <con2:expr>
                                    <con1:xqueryTransform>
                                        <con1:resource ref="GestorUSSD/Resources/XQuery/IN_XQ_getMensaje"/>
                                        <con1:param name="idMsj">
                                            <con1:path>10001</con1:path>
                                        </con1:param>
                                    </con1:xqueryTransform>
                                </con2:expr>
                            </con2:replace>
                        </con2:requestTransform>
                        <con2:responseTransform>
                            <con2:assign varName="msgOut">
                                <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-7958</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>$InfoMensajeResp/ns0:getInfoMensajeDbaOutput[1]/ns0:MENSAJE/text()</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:ifThenElse>
                                <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-791f</con1:id>
                                <con2:case>
                                    <con2:condition>
                                        <con1:xqueryText>empty($msgOut)</con1:xqueryText>
                                    </con2:condition>
                                    <con2:actions>
                                        <con2:Error>
                                            <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-77e5</con1:id>
                                            <con2:errCode>ERR-0001</con2:errCode>
                                            <con2:message>No se encuentra el mensaje de la promoción.</con2:message>
                                        </con2:Error>
                                    </con2:actions>
                                </con2:case>
                                <con2:default/>
                            </con2:ifThenElse>
                        </con2:responseTransform>
                    </con2:wsCallout>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="PipelineMsjPromocion_response" errorHandler="_onErrorHandler-194002751992053644--538027f5.1540a9e515e.-77ad">
            <con:stage name="getMensajePromocionalOut">
                <con:comment/>
                <con:context/>
                <con:actions>
                    <con2:replace varName="body" contents-only="true">
                        <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-79c9</con1:id>
                        <con2:expr>
                            <con1:xqueryTransform>
                                <con1:resource ref="GestorUSSD/Resources/XQuery/OUT_XQ_getMensaje"/>
                                <con1:param name="getInfoMensajeDbaOutputCollection1">
                                    <con1:path>$InfoMensajeResp</con1:path>
                                </con1:param>
                            </con1:xqueryTransform>
                        </con2:expr>
                    </con2:replace>
                    <con1:reply>
                        <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-79c8</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-194002751992053644--538027f5.1540a9e515e.-77ae">
            <con:stage name="stgErrorInMsjPromo">
                <con:comment/>
                <con:context>
                    <con1:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1"/>
                </con:context>
                <con:actions>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-7692</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
   <segmento></segmento>
   <errorCode>{$fault/ctx:errorCode/text()}</errorCode>
   <errorDescription>{concat('stage: ',$fault/ctx:location/ctx:stage/text(),', Error: ', $fault/ctx:reason/text())}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-1487657368312215333-2005ed96.15433afe5d3.-7bd2</con1:id>
                        <con4:logLevel>error</con4:logLevel>
                        <con4:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con4:expr>
                        <con4:message>-----|||Response PSUSSDOperaciones|||-----</con4:message>
                    </con4:log>
                    <con1:reply isError="false" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-7691</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-194002751992053644--538027f5.1540a9e515e.-77ad">
            <con:stage name="stgErrorOutMsjPromo">
                <con:comment/>
                <con:context>
                    <con1:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1"/>
                </con:context>
                <con:actions>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-773c</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
   <segmento></segmento>
   <errorCode>{$fault/ctx:errorCode/text()}</errorCode>
   <errorDescription>{concat('stage: ',$fault/ctx:location/ctx:stage/text(),', Error: ', $fault/ctx:reason/text())}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-1487657368312215333-2005ed96.15433afe5d3.-7bef</con1:id>
                        <con4:logLevel>error</con4:logLevel>
                        <con4:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con4:expr>
                        <con4:message>-----|||Response PSUSSDOperaciones|||-----</con4:message>
                    </con4:log>
                    <con1:reply isError="false" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-773b</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="request" name="PipelineMsjRecarga_request" errorHandler="_onErrorHandler-194002751992053644--538027f5.1540a9e515e.-756d">
            <con:stage name="getMensajeRecarga">
                <con:context>
                    <con1:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/getInfoMensajeDba" prefix="ns0"/>
                </con:context>
                <con:actions>
                    <con2:wsCallout>
                        <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-75e0</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="GestorUSSD/Business Services/BSServiceGetInfoMensaje" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>getInfoMensajeDba</con2:operation>
                        <con2:request>
                            <con2:body>InfoMensajeReq</con2:body>
                        </con2:request>
                        <con2:response>
                            <con2:body>InfoMensajeResp</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                            <con2:replace varName="InfoMensajeReq">
                                <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-75e4</con1:id>
                                <con2:expr>
                                    <con1:xqueryTransform>
                                        <con1:resource ref="GestorUSSD/Resources/XQuery/IN_XQ_getMensaje"/>
                                        <con1:param name="idMsj">
                                            <con1:path>10002</con1:path>
                                        </con1:param>
                                    </con1:xqueryTransform>
                                </con2:expr>
                            </con2:replace>
                        </con2:requestTransform>
                        <con2:responseTransform>
                            <con2:assign varName="msgOut">
                                <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-75e3</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>$InfoMensajeResp/ns0:getInfoMensajeDbaOutput[1]/ns0:MENSAJE/text()</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:ifThenElse>
                                <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-75e2</con1:id>
                                <con2:case>
                                    <con2:condition>
                                        <con1:xqueryText>empty($msgOut)</con1:xqueryText>
                                    </con2:condition>
                                    <con2:actions>
                                        <con2:Error>
                                            <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-75e1</con1:id>
                                            <con2:errCode>ERR-0001</con2:errCode>
                                            <con2:message>No se encuentra el mensaje de la recarga</con2:message>
                                        </con2:Error>
                                    </con2:actions>
                                </con2:case>
                                <con2:default/>
                            </con2:ifThenElse>
                        </con2:responseTransform>
                    </con2:wsCallout>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="PipelineMsjRecarga_response" errorHandler="_onErrorHandler-194002751992053644--538027f5.1540a9e515e.-756c">
            <con:stage name="getMensajeRecargaOut">
                <con:comment/>
                <con:context/>
                <con:actions>
                    <con2:replace varName="body" contents-only="true">
                        <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-756f</con1:id>
                        <con2:expr>
                            <con1:xqueryTransform>
                                <con1:resource ref="GestorUSSD/Resources/XQuery/OUT_XQ_getMensaje"/>
                                <con1:param name="getInfoMensajeDbaOutputCollection1">
                                    <con1:path>$InfoMensajeResp</con1:path>
                                </con1:param>
                            </con1:xqueryTransform>
                        </con2:expr>
                    </con2:replace>
                    <con1:reply>
                        <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-756e</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-194002751992053644--538027f5.1540a9e515e.-756d">
            <con:stage name="stgErrorInMsjRecarga">
                <con:comment/>
                <con:context>
                    <con1:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1"/>
                </con:context>
                <con:actions>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-7489</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
   <segmento></segmento>
   <errorCode>{$fault/ctx:errorCode/text()}</errorCode>
   <errorDescription>{concat('stage: ',$fault/ctx:location/ctx:stage/text(),', Error: ', $fault/ctx:reason/text())}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-1487657368312215333-2005ed96.15433afe5d3.-7c0c</con1:id>
                        <con4:logLevel>error</con4:logLevel>
                        <con4:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con4:expr>
                        <con4:message>-----|||Response PSUSSDOperaciones|||-----</con4:message>
                    </con4:log>
                    <con1:reply isError="false" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-7488</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-194002751992053644--538027f5.1540a9e515e.-756c">
            <con:stage name="stgErrorOutMsjRecarga">
                <con:comment/>
                <con:context>
                    <con1:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1"/>
                </con:context>
                <con:actions>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-74fb</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
   <segmento></segmento>
   <errorCode>{$fault/ctx:errorCode/text()}</errorCode>
   <errorDescription>{concat('stage: ',$fault/ctx:location/ctx:stage/text(),', Error: ', $fault/ctx:reason/text())}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-1487657368312215333-2005ed96.15433afe5d3.-7c29</con1:id>
                        <con4:logLevel>error</con4:logLevel>
                        <con4:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con4:expr>
                        <con4:message>-----|||Response PSUSSDOperaciones|||-----</con4:message>
                    </con4:log>
                    <con1:reply isError="false" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-74fa</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="request" name="PipelineMsjTarifa_request" errorHandler="_onErrorHandler-194002751992053644--538027f5.1540a9e515e.-732c">
            <con:stage name="getMensajeTarifa">
                <con:context>
                    <con1:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/getInfoMensajeDba" prefix="ns0"/>
                </con:context>
                <con:actions>
                    <con2:wsCallout>
                        <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-739f</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="GestorUSSD/Business Services/BSServiceGetInfoMensaje" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>getInfoMensajeDba</con2:operation>
                        <con2:request>
                            <con2:body>InfoMensajeReq</con2:body>
                        </con2:request>
                        <con2:response>
                            <con2:body>InfoMensajeResp</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                            <con2:replace varName="InfoMensajeReq">
                                <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-73a3</con1:id>
                                <con2:expr>
                                    <con1:xqueryTransform>
                                        <con1:resource ref="GestorUSSD/Resources/XQuery/IN_XQ_getMensaje"/>
                                        <con1:param name="idMsj">
                                            <con1:path>10003</con1:path>
                                        </con1:param>
                                    </con1:xqueryTransform>
                                </con2:expr>
                            </con2:replace>
                        </con2:requestTransform>
                        <con2:responseTransform>
                            <con2:assign varName="msgOut">
                                <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-73a2</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>$InfoMensajeResp/ns0:getInfoMensajeDbaOutput[1]/ns0:MENSAJE/text()</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:ifThenElse>
                                <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-73a1</con1:id>
                                <con2:case>
                                    <con2:condition>
                                        <con1:xqueryText>empty($msgOut)</con1:xqueryText>
                                    </con2:condition>
                                    <con2:actions>
                                        <con2:Error>
                                            <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-73a0</con1:id>
                                            <con2:errCode>ERR-0001</con2:errCode>
                                            <con2:message>No se encuentra el mensaje de la tarifa</con2:message>
                                        </con2:Error>
                                    </con2:actions>
                                </con2:case>
                                <con2:default/>
                            </con2:ifThenElse>
                        </con2:responseTransform>
                    </con2:wsCallout>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="PipelineMsjTarifa_response" errorHandler="_onErrorHandler-194002751992053644--538027f5.1540a9e515e.-732b">
            <con:stage name="getMensajeTarifaOut">
                <con:comment/>
                <con:context/>
                <con:actions>
                    <con2:replace varName="body" contents-only="true">
                        <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-732e</con1:id>
                        <con2:expr>
                            <con1:xqueryTransform>
                                <con1:resource ref="GestorUSSD/Resources/XQuery/OUT_XQ_getMensaje"/>
                                <con1:param name="getInfoMensajeDbaOutputCollection1">
                                    <con1:path>$InfoMensajeResp</con1:path>
                                </con1:param>
                            </con1:xqueryTransform>
                        </con2:expr>
                    </con2:replace>
                    <con1:reply>
                        <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-732d</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-194002751992053644--538027f5.1540a9e515e.-732c">
            <con:stage name="stgErrorInMsjTarifa">
                <con:comment/>
                <con:context>
                    <con1:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1"/>
                </con:context>
                <con:actions>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-7248</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
   <segmento></segmento>
   <errorCode>{$fault/ctx:errorCode/text()}</errorCode>
   <errorDescription>{concat('stage: ',$fault/ctx:location/ctx:stage/text(),', Error: ', $fault/ctx:reason/text())}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-1487657368312215333-2005ed96.15433afe5d3.-7c46</con1:id>
                        <con4:logLevel>error</con4:logLevel>
                        <con4:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con4:expr>
                        <con4:message>-----|||Response PSUSSDOperaciones|||-----</con4:message>
                    </con4:log>
                    <con1:reply isError="false" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-7247</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-194002751992053644--538027f5.1540a9e515e.-732b">
            <con:stage name="stgErrorOutMsjTarifa">
                <con:comment/>
                <con:context>
                    <con1:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1"/>
                </con:context>
                <con:actions>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-72ba</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
   <segmento></segmento>
   <errorCode>{$fault/ctx:errorCode/text()}</errorCode>
   <errorDescription>{concat('stage: ',$fault/ctx:location/ctx:stage/text(),', Error: ', $fault/ctx:reason/text())}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-1487657368312215333-2005ed96.15433afe5d3.-7c63</con1:id>
                        <con4:logLevel>error</con4:logLevel>
                        <con4:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con4:expr>
                        <con4:message>-----|||Response PSUSSDOperaciones|||-----</con4:message>
                    </con4:log>
                    <con1:reply isError="false" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-194002751992053644--538027f5.1540a9e515e.-72b9</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="request" name="PipelineConsultaSaldo_request" errorHandler="_onErrorHandler-4367511924980638058--baaeb92.1540fdb5490.-7f16">
            <con:stage name="getTotalSaldo">
                <con:context>
                    <con1:userNsDecl namespace="http://ws.nextel.cl/schemas/searchBalanceIcc/alcatel/getAllInformation" prefix="gets"/>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con2:wsCallout>
                        <con1:id>_ActionId-4367511924980638058--baaeb92.1540fdb5490.-7df9</con1:id>
                        <con2:service xsi:type="ref:ProxyRef" ref="PrepaidWave/Proxy Services/PSServiceSearchPrepagoICC" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>getSearchBalanceIcc</con2:operation>
                        <con2:request>
                            <con2:body>searchBalanceIccReq</con2:body>
                        </con2:request>
                        <con2:response>
                            <con2:body>searchBalanceIccResp</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                            <con2:replace varName="searchBalanceIccReq" contents-only="false">
                                <con1:id>_ActionId-4367511924980638058--baaeb92.1540fdb5490.-7dbe</con1:id>
                                <con2:expr>
                                    <con1:xqueryTransform>
                                        <con1:resource ref="GestorUSSD/Resources/XQuery/IN_XQ_SearchPrepaidWave"/>
                                        <con1:param name="nroCelular">
                                            <con1:path>$body/ussd:ussdOperacion/nroCelular/text()</con1:path>
                                        </con1:param>
                                    </con1:xqueryTransform>
                                </con2:expr>
                            </con2:replace>
                        </con2:requestTransform>
                        <con2:responseTransform>
                            <con2:assign varName="getErrorSearchPrepaid">
                                <con1:id>_ActionId-4367511924980638058--baaeb92.1540fdb5490.-7d4f</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>$searchBalanceIccResp/gets:error_code/text()</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:ifThenElse>
                                <con1:id>_ActionId-4367511924980638058--baaeb92.1540fdb5490.-7ce0</con1:id>
                                <con2:case>
                                    <con2:condition>
                                        <con1:xqueryText>empty($getErrorSearchPrepaid) or $getErrorSearchPrepaid != '0'</con1:xqueryText>
                                    </con2:condition>
                                    <con2:actions>
                                        <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                                            <con1:id>_ActionId-4367511924980638058--baaeb92.1540fdb5490.-7bfe</con1:id>
                                            <con3:expr>
                                                <con1:xqueryTransform>
                                                    <con1:resource ref="GestorUSSD/Resources/XQuery/OUT_XQ_getSearchPrepaidError"/>
                                                    <con1:param name="searchBalancesICC_response1">
                                                        <con1:path>$searchBalanceIccResp</con1:path>
                                                    </con1:param>
                                                </con1:xqueryTransform>
                                            </con3:expr>
                                        </con3:replace>
                                        <con2:delete varName="searchBalanceIccReq">
                                            <con1:id>_ActionId-4653326524858331419-38eda4b5.1651a484407.-7f15</con1:id>
                                        </con2:delete>
                                        <con2:delete varName="searchBalanceIccResp">
                                            <con1:id>_ActionId-4653326524858331419-38eda4b5.1651a484407.-7f13</con1:id>
                                        </con2:delete>
                                        <con1:reply xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                                            <con1:id>_ActionId-4367511924980638058--baaeb92.1540fdb5490.-7bfc</con1:id>
                                        </con1:reply>
                                    </con2:actions>
                                </con2:case>
                                <con2:default>
                                    <con2:replace varName="ordTotalesDatosSmsVoz" contents-only="false">
                                        <con1:id>_ActionId-3032204925682445224--6da18fac.1541a146c60.-7eea</con1:id>
                                        <con2:expr>
                                            <con1:xqueryTransform>
                                                <con1:resource ref="GestorUSSD/Resources/XQuery/XQ_OrdTotalesDatosSmsVoz"/>
                                                <con1:param name="searchBalancesICC_response1">
                                                    <con1:path>$searchBalanceIccResp</con1:path>
                                                </con1:param>
                                            </con1:xqueryTransform>
                                        </con2:expr>
                                    </con2:replace>
                                    <con2:assign varName="saldoTotal">
                                        <con1:id>_ActionId-3032204925682445224--6da18fac.1541a146c60.-7ecd</con1:id>
                                        <con2:expr>
                                            <con1:xqueryText>$ordTotalesDatosSmsVoz/total/saldoTotal/text()</con1:xqueryText>
                                        </con2:expr>
                                    </con2:assign>
                                    <con2:assign varName="totalDatos">
                                        <con1:id>_ActionId-3032204925682445224--6da18fac.1541a146c60.-7e94</con1:id>
                                        <con2:expr>
                                            <con1:xqueryText>$ordTotalesDatosSmsVoz/total/totalDatos/text()</con1:xqueryText>
                                        </con2:expr>
                                    </con2:assign>
                                    <con2:assign varName="totalDatos4G">
                                        <con1:id>_ActionId-3032204925682445224--6da18fac.1541a146c60.-7e5b</con1:id>
                                        <con2:expr>
                                            <con1:xqueryText>$ordTotalesDatosSmsVoz/total/totalDatos4G/text()</con1:xqueryText>
                                        </con2:expr>
                                    </con2:assign>
                                    <con2:assign varName="totalDatosSocial">
                                        <con1:id>_ActionId-3032204925682445224--6da18fac.1541a146c60.-7e22</con1:id>
                                        <con2:expr>
                                            <con1:xqueryText>$ordTotalesDatosSmsVoz/total/totalDatosSocial/text()</con1:xqueryText>
                                        </con2:expr>
                                    </con2:assign>
                                    <con2:assign varName="DatosWhatSapp">
                                        <con1:id>_ActionId-3816260879449921381-5991cc91.157d2da18b3.-7fc8</con1:id>
                                        <con2:expr>
                                            <con1:xqueryText>$ordTotalesDatosSmsVoz/total/DatosWhatSapp/text()</con1:xqueryText>
                                        </con2:expr>
                                    </con2:assign>
                                    <con2:assign varName="totalVoz">
                                        <con1:id>_ActionId-3032204925682445224--6da18fac.1541a146c60.-7de9</con1:id>
                                        <con2:expr>
                                            <con1:xqueryText>$ordTotalesDatosSmsVoz/total/totalVoz/text()</con1:xqueryText>
                                        </con2:expr>
                                    </con2:assign>
                                    <con2:assign varName="totalSms">
                                        <con1:id>_ActionId-3032204925682445224--6da18fac.1541a146c60.-7db0</con1:id>
                                        <con2:expr>
                                            <con1:xqueryText>$ordTotalesDatosSmsVoz/total/totalSms/text()</con1:xqueryText>
                                        </con2:expr>
                                    </con2:assign>
                                </con2:default>
                            </con2:ifThenElse>
                        </con2:responseTransform>
                    </con2:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage name="getSaldoExtraSaldo" errorHandler="_onErrorHandler-1586447002420683682--1e5664d8.15cb2264ba3.-7fc2">
                <con:context>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con2:wsCallout>
                        <con1:id>_ActionId-2824430347831579628--50997130.15c17bd5bef.-7faa</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="GestorUSSD/Business Services/BSConsultaExtraSaldo" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>OperationConsultaExtraSaldo</con2:operation>
                        <con2:request>
                            <con2:body wrapped="false">requestConsultaEC</con2:body>
                        </con2:request>
                        <con2:response>
                            <con2:body wrapped="false">responseConsultaEC</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                            <con2:assign varName="requestConsultaEC">
                                <con1:id>_ActionId-2824430347831579628--50997130.15c17bd5bef.-7f7e</con1:id>
                                <con2:expr>
                                    <con1:xqueryTransform>
                                        <con1:resource ref="GestorUSSD/Resources/XQuery/IN_XQ_ConsultaExtraSaldo"/>
                                        <con1:param name="nroCelular">
                                            <con1:path>$body/ussd:ussdOperacion/nroCelular/text()</con1:path>
                                        </con1:param>
                                    </con1:xqueryTransform>
                                </con2:expr>
                            </con2:assign>
                        </con2:requestTransform>
                        <con2:responseTransform>
                            <con2:assign varName="respuestaConsulta">
                                <con1:id>_ActionId-2824430347831579628--50997130.15c17bd5bef.-7f5e</con1:id>
                                <con2:expr>
                                    <con1:xqueryTransform>
                                        <con1:resource ref="GestorUSSD/Resources/XQuery/OUT_XQ_ConsultaExtraSaldo"/>
                                        <con1:param name="consultaExtraCreditoResponse">
                                            <con1:path>$responseConsultaEC</con1:path>
                                        </con1:param>
                                    </con1:xqueryTransform>
                                </con2:expr>
                            </con2:assign>
                            <con2:assign varName="saldoPendienteEC">
                                <con1:id>_ActionId-2824430347831579628--50997130.15c17bd5bef.-7ee7</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>concat("$",$respuestaConsulta/saldoPendiente/text())</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                        </con2:responseTransform>
                    </con2:wsCallout>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="PipelineConsultaSaldo_response" errorHandler="_onErrorHandler-4367511924980638058--baaeb92.1540fdb5490.-7f15">
            <con:stage name="getTotalSaldoOut">
                <con:context/>
                <con:actions>
                    <con2:replace varName="body" contents-only="true">
                        <con1:id>_ActionId-3032204925682445224--6da18fac.1541a146c60.-7f5a</con1:id>
                        <con2:expr>
                            <con1:xqueryTransform>
                                <con1:resource ref="GestorUSSD/Resources/XQuery/OUT_XQ_SearchPrepaidWave"/>
                                <con1:param name="totalDatosSocial">
                                    <con1:path>$totalDatosSocial</con1:path>
                                </con1:param>
                                <con1:param name="saldoPendienteEc">
                                    <con1:path>$saldoPendienteEC</con1:path>
                                </con1:param>
                                <con1:param name="saldoTotal">
                                    <con1:path>$saldoTotal</con1:path>
                                </con1:param>
                                <con1:param name="totalVoz">
                                    <con1:path>$totalVoz</con1:path>
                                </con1:param>
                                <con1:param name="totalDatos4G">
                                    <con1:path>$totalDatos4G</con1:path>
                                </con1:param>
                                <con1:param name="totalSms">
                                    <con1:path>$totalSms</con1:path>
                                </con1:param>
                                <con1:param name="DatosWhatSapp">
                                    <con1:path>$DatosWhatSapp</con1:path>
                                </con1:param>
                                <con1:param name="totalDatos">
                                    <con1:path>$totalDatos</con1:path>
                                </con1:param>
                            </con1:xqueryTransform>
                        </con2:expr>
                    </con2:replace>
                    <con2:delete varName="searchBalanceIccReq">
                        <con1:id>_ActionId-8386188088139128452--1be819e3.164c8832b6e.-7def</con1:id>
                    </con2:delete>
                    <con2:delete varName="searchBalanceIccResp">
                        <con1:id>_ActionId-8386188088139128452--1be819e3.164c8832b6e.-7dee</con1:id>
                    </con2:delete>
                    <con2:delete varName="requestConsultaEC">
                        <con1:id>_ActionId-8386188088139128452--1be819e3.164c8832b6e.-7d79</con1:id>
                    </con2:delete>
                    <con2:delete varName="responseConsultaEC">
                        <con1:id>_ActionId-8386188088139128452--1be819e3.164c8832b6e.-7d78</con1:id>
                    </con2:delete>
                    <con1:reply>
                        <con1:id>_ActionId-3032204925682445224--6da18fac.1541a146c60.-7f59</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-4367511924980638058--baaeb92.1540fdb5490.-7f16">
            <con:stage name="stgErrorInConsultaSaldo">
                <con:comment/>
                <con:context>
                    <con1:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1"/>
                </con:context>
                <con:actions>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-4367511924980638058--baaeb92.1540fdb5490.-7ea4</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
   <segmento></segmento>
   <errorCode>{$fault/ctx:errorCode/text()}</errorCode>
   <errorDescription>{concat('stage: ',$fault/ctx:location/ctx:stage/text(),', Error: ', $fault/ctx:reason/text())}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-1487657368312215333-2005ed96.15433afe5d3.-7b98</con1:id>
                        <con4:logLevel>error</con4:logLevel>
                        <con4:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con4:expr>
                        <con4:message>-----|||Response PSUSSDOperaciones|||-----</con4:message>
                    </con4:log>
                    <con2:delete varName="searchBalanceIccReq">
                        <con1:id>_ActionId-8386188088139128452--1be819e3.164c8832b6e.-7e2e</con1:id>
                    </con2:delete>
                    <con2:delete varName="searchBalanceIccResp">
                        <con1:id>_ActionId-8386188088139128452--1be819e3.164c8832b6e.-7e30</con1:id>
                    </con2:delete>
                    <con2:delete varName="requestConsultaEC">
                        <con1:id>_ActionId-8386188088139128452--1be819e3.164c8832b6e.-7dd0</con1:id>
                    </con2:delete>
                    <con2:delete varName="responseConsultaEC">
                        <con1:id>_ActionId-8386188088139128452--1be819e3.164c8832b6e.-7dcf</con1:id>
                    </con2:delete>
                    <con1:reply isError="false" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-4367511924980638058--baaeb92.1540fdb5490.-7ea3</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-4367511924980638058--baaeb92.1540fdb5490.-7f15">
            <con:stage name="stgErrorOutConsultaSaldo">
                <con:comment/>
                <con:context>
                    <con1:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1"/>
                </con:context>
                <con:actions>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-4367511924980638058--baaeb92.1540fdb5490.-7e32</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
   <segmento></segmento>
   <errorCode>{$fault/ctx:errorCode/text()}</errorCode>
   <errorDescription>{concat('stage: ',$fault/ctx:location/ctx:stage/text(),', Error: ', $fault/ctx:reason/text())}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-1487657368312215333-2005ed96.15433afe5d3.-7bb5</con1:id>
                        <con4:logLevel>error</con4:logLevel>
                        <con4:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con4:expr>
                        <con4:message>-----|||Response PSUSSDOperaciones|||-----</con4:message>
                    </con4:log>
                    <con2:delete varName="searchBalanceIccReq">
                        <con1:id>_ActionId-8386188088139128452--1be819e3.164c8832b6e.-7e0e</con1:id>
                    </con2:delete>
                    <con2:delete varName="searchBalanceIccResp">
                        <con1:id>_ActionId-8386188088139128452--1be819e3.164c8832b6e.-7e0d</con1:id>
                    </con2:delete>
                    <con2:delete varName="requestConsultaEC">
                        <con1:id>_ActionId-8386188088139128452--1be819e3.164c8832b6e.-7d5a</con1:id>
                    </con2:delete>
                    <con2:delete varName="responseConsultaEC">
                        <con1:id>_ActionId-8386188088139128452--1be819e3.164c8832b6e.-7d59</con1:id>
                    </con2:delete>
                    <con1:reply isError="false" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-4367511924980638058--baaeb92.1540fdb5490.-7e31</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="request" name="PipelineGetMsjDeudaVencida_request" errorHandler="_onErrorHandler-9202987288639765781--5bdac8a6.1542979a4b5.-7db2">
            <con:stage name="getDeudaVencida">
                <con:context>
                    <con1:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/FTOLERANCE/NII_IVR_CONSULTS_PKG/NII_DEBT_CONSULT_PRC/" prefix="ns0"/>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con2:wsCallout>
                        <con1:id>_ActionId-9202987288639765781--5bdac8a6.1542979a4b5.-7eb1</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="GestorUSSD/Business Services/BSServiceGetInfoDeuda" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>getInfoDeuda</con2:operation>
                        <con2:request>
                            <con2:body>InfoDeudaReq</con2:body>
                        </con2:request>
                        <con2:response>
                            <con2:body>InfoDeudaResp</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                            <con2:replace varName="InfoDeudaReq">
                                <con1:id>_ActionId-9202987288639765781--5bdac8a6.1542979a4b5.-7e78</con1:id>
                                <con2:expr>
                                    <con1:xqueryTransform>
                                        <con1:resource ref="GestorUSSD/Resources/XQuery/IN_XQ_getInfoDeuda_nii_consults_pkg"/>
                                        <con1:param name="nroCelular">
                                            <con1:path>$body/ussd:ussdOperacion/nroCelular/text()</con1:path>
                                        </con1:param>
                                    </con1:xqueryTransform>
                                </con2:expr>
                            </con2:replace>
                        </con2:requestTransform>
                        <con2:responseTransform>
                            <con2:assign varName="getErrorInfoDeudaDba">
                                <con1:id>_ActionId-9202987288639765781--5bdac8a6.1542979a4b5.-7c5f</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>$InfoDeudaResp/ns0:OUT_COD_ERROR/text()</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:ifThenElse>
                                <con1:id>_ActionId-9202987288639765781--5bdac8a6.1542979a4b5.-7c42</con1:id>
                                <con2:case>
                                    <con2:condition>
                                        <con1:xqueryText>not(empty($getErrorInfoDeudaDba))</con1:xqueryText>
                                    </con2:condition>
                                    <con2:actions>
                                        <con2:replace varName="body">
                                            <con1:id>_ActionId-9202987288639765781--5bdac8a6.1542979a4b5.-7c09</con1:id>
                                            <con2:expr>
                                                <con1:xqueryTransform>
                                                    <con1:resource ref="GestorUSSD/Resources/XQuery/OUT_XQ_getInfoDeuda_nii_consults_pkg_error_sql"/>
                                                    <con1:param name="outputParameters1">
                                                        <con1:path>$InfoDeudaResp</con1:path>
                                                    </con1:param>
                                                </con1:xqueryTransform>
                                            </con2:expr>
                                        </con2:replace>
                                    </con2:actions>
                                </con2:case>
                                <con2:default/>
                            </con2:ifThenElse>
                        </con2:responseTransform>
                    </con2:wsCallout>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="PipelineGetMsjDeudaVencida_response" errorHandler="_onErrorHandler-9202987288639765781--5bdac8a6.1542979a4b5.-7db1">
            <con:stage name="getDeudaVencidaOut">
                <con:context/>
                <con:actions>
                    <con2:replace varName="body" contents-only="true">
                        <con1:id>_ActionId-9202987288639765781--5bdac8a6.1542979a4b5.-7db4</con1:id>
                        <con2:expr>
                            <con1:xqueryTransform>
                                <con1:resource ref="GestorUSSD/Resources/XQuery/OUT_XQ_getInfoDeuda_nii_consults_pkg"/>
                                <con1:param name="outputParameters1">
                                    <con1:path>$InfoDeudaResp</con1:path>
                                </con1:param>
                            </con1:xqueryTransform>
                        </con2:expr>
                    </con2:replace>
                    <con1:reply>
                        <con1:id>_ActionId-9202987288639765781--5bdac8a6.1542979a4b5.-7db3</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-9202987288639765781--5bdac8a6.1542979a4b5.-7db2">
            <con:stage name="stgErrorInDeuda">
                <con:comment/>
                <con:context>
                    <con1:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1"/>
                </con:context>
                <con:actions>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-9202987288639765781--5bdac8a6.1542979a4b5.-7c98</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
   <segmento></segmento>
   <errorCode>{$fault/ctx:errorCode/text()}</errorCode>
   <errorDescription>{concat('stage: ',$fault/ctx:location/ctx:stage/text(),', Error: ', $fault/ctx:reason/text())}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-1487657368312215333-2005ed96.15433afe5d3.-7cb7</con1:id>
                        <con4:logLevel>error</con4:logLevel>
                        <con4:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con4:expr>
                        <con4:message>-----|||Response PSUSSDOperaciones|||-----</con4:message>
                    </con4:log>
                    <con1:reply isError="false" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-9202987288639765781--5bdac8a6.1542979a4b5.-7c97</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-9202987288639765781--5bdac8a6.1542979a4b5.-7db1">
            <con:stage name="stgErrorOutDeuda">
                <con:comment/>
                <con:context>
                    <con1:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1"/>
                </con:context>
                <con:actions>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-9202987288639765781--5bdac8a6.1542979a4b5.-7d40</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
   <segmento></segmento>
   <errorCode>{$fault/ctx:errorCode/text()}</errorCode>
   <errorDescription>{concat('stage: ',$fault/ctx:location/ctx:stage/text(),', Error: ', $fault/ctx:reason/text())}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-1487657368312215333-2005ed96.15433afe5d3.-7cd4</con1:id>
                        <con4:logLevel>error</con4:logLevel>
                        <con4:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con4:expr>
                        <con4:message>-----|||Response PSUSSDOperaciones|||-----</con4:message>
                    </con4:log>
                    <con1:reply isError="false" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-9202987288639765781--5bdac8a6.1542979a4b5.-7d3f</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="request" name="PipelineCicloFacturacion_request" errorHandler="_onErrorHandler-1487657368312215333-2005ed96.15433afe5d3.-7e82">
            <con:stage name="getInfoPlanCicloFact">
                <con:context>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con2:wsCallout>
                        <con1:id>_ActionId-2571964048415978422--67d69c3e.1542fb6fa7f.-7f5c</con1:id>
                        <con2:service xsi:type="ref:ProxyRef" ref="NewIVRLocal/LTInfoService/Proxy Services/PSLTInfoService" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>LTIInfoPlanCiclo</con2:operation>
                        <con2:request>
                            <con2:body>infoPlanCicloReq</con2:body>
                        </con2:request>
                        <con2:response>
                            <con2:body>infoPlanCicloResp</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                            <con2:replace varName="infoPlanCicloReq" contents-only="false">
                                <con1:id>_ActionId-2571964048415978422--67d69c3e.1542fb6fa7f.-7f24</con1:id>
                                <con2:expr>
                                    <con1:xqueryTransform>
                                        <con1:resource ref="GestorUSSD/Resources/XQuery/IN_XQ_getInfoPlanCicloFact"/>
                                        <con1:param name="NroCelular">
                                            <con1:path>$body/ussd:ussdOperacion/nroCelular/text()</con1:path>
                                        </con1:param>
                                    </con1:xqueryTransform>
                                </con2:expr>
                            </con2:replace>
                        </con2:requestTransform>
                        <con2:responseTransform/>
                    </con2:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage name="getDeudaVencida">
                <con:context>
                    <con1:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/FTOLERANCE/NII_IVR_CONSULTS_PKG/NII_DEBT_CONSULT_PRC/" prefix="ns0"/>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con2:wsCallout>
                        <con1:id>_ActionId-1487657368312215333-2005ed96.15433afe5d3.-7f7c</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="GestorUSSD/Business Services/BSServiceGetInfoDeuda" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>getInfoDeuda</con2:operation>
                        <con2:request>
                            <con2:body>InfoDeudaReq</con2:body>
                        </con2:request>
                        <con2:response>
                            <con2:body>InfoDeudaResp</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                            <con2:replace varName="InfoDeudaReq">
                                <con1:id>_ActionId-1487657368312215333-2005ed96.15433afe5d3.-7f80</con1:id>
                                <con2:expr>
                                    <con1:xqueryTransform>
                                        <con1:resource ref="GestorUSSD/Resources/XQuery/IN_XQ_getInfoDeuda_nii_consults_pkg"/>
                                        <con1:param name="nroCelular">
                                            <con1:path>$body/ussd:ussdOperacion/nroCelular/text()</con1:path>
                                        </con1:param>
                                    </con1:xqueryTransform>
                                </con2:expr>
                            </con2:replace>
                        </con2:requestTransform>
                        <con2:responseTransform/>
                    </con2:wsCallout>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="PipelineCicloFacturacion_response" errorHandler="_onErrorHandler-1487657368312215333-2005ed96.15433afe5d3.-7e81">
            <con:stage name="getCicloFacturacion">
                <con:context/>
                <con:actions>
                    <con2:replace varName="body" contents-only="true">
                        <con1:id>_ActionId-1487657368312215333-2005ed96.15433afe5d3.-7e9f</con1:id>
                        <con2:expr>
                            <con1:xqueryTransform>
                                <con1:resource ref="GestorUSSD/Resources/XQuery/OUT_XQ_getInfoPlanCiclo_getDeudaVencida"/>
                                <con1:param name="infoPlanCicloResponse1">
                                    <con1:path>$infoPlanCicloResp</con1:path>
                                </con1:param>
                                <con1:param name="outputParameters1">
                                    <con1:path>$InfoDeudaResp</con1:path>
                                </con1:param>
                            </con1:xqueryTransform>
                        </con2:expr>
                    </con2:replace>
                    <con1:reply>
                        <con1:id>_ActionId-1487657368312215333-2005ed96.15433afe5d3.-7e9e</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-1487657368312215333-2005ed96.15433afe5d3.-7e82">
            <con:stage name="stgErrorInCicloFacturacion">
                <con:comment/>
                <con:context>
                    <con1:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1"/>
                </con:context>
                <con:actions>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-1487657368312215333-2005ed96.15433afe5d3.-7d9e</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
   <segmento></segmento>
   <errorCode>{$fault/ctx:errorCode/text()}</errorCode>
   <errorDescription>{concat('stage: ',$fault/ctx:location/ctx:stage/text(),', Error: ', $fault/ctx:reason/text())}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-1487657368312215333-2005ed96.15433afe5d3.-7cf1</con1:id>
                        <con4:logLevel>error</con4:logLevel>
                        <con4:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con4:expr>
                        <con4:message>-----|||Response PSUSSDOperaciones|||-----</con4:message>
                    </con4:log>
                    <con1:reply isError="false" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-1487657368312215333-2005ed96.15433afe5d3.-7d9d</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-1487657368312215333-2005ed96.15433afe5d3.-7e81">
            <con:stage name="stgErrorOutCicloFacturacion">
                <con:comment/>
                <con:context>
                    <con1:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1"/>
                </con:context>
                <con:actions>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-1487657368312215333-2005ed96.15433afe5d3.-7e10</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
   <segmento></segmento>
   <errorCode>{$fault/ctx:errorCode/text()}</errorCode>
   <errorDescription>{concat('stage: ',$fault/ctx:location/ctx:stage/text(),', Error: ', $fault/ctx:reason/text())}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-1487657368312215333-2005ed96.15433afe5d3.-7d0e</con1:id>
                        <con4:logLevel>error</con4:logLevel>
                        <con4:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con4:expr>
                        <con4:message>-----|||Response PSUSSDOperaciones|||-----</con4:message>
                    </con4:log>
                    <con1:reply isError="false" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-1487657368312215333-2005ed96.15433afe5d3.-7e0f</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="request" name="PipelineCreditoEmergencia_request" errorHandler="_onErrorHandler-4281554535167830158--5b023162.159b2063421.-7893">
            <con:stage name="getExtraCredito">
                <con:context>
                    <con1:userNsDecl namespace="http://operaciones.extracredito.wom.ws.ncl.com" prefix="ope"/>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con2:wsCallout>
                        <con1:id>_ActionId-4281554535167830158--5b023162.159b2063421.-7c08</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="GestorUSSD/Business Services/BSExtraCredito" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>SuscribeExtraCreditoWS</con2:operation>
                        <con2:request>
                            <con2:body>requestEC</con2:body>
                        </con2:request>
                        <con2:response>
                            <con2:body>responseEC</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                            <con2:assign varName="requestEC">
                                <con1:id>_ActionId-4281554535167830158--5b023162.159b2063421.-7be1</con1:id>
                                <con2:expr>
                                    <con1:xqueryTransform>
                                        <con1:resource ref="GestorUSSD/Resources/XQuery/IN_getCreditoEmergencia_TO_ExtraCredito"/>
                                        <con1:param name="nroCelular">
                                            <con1:path>$body/ussd:ussdOperacion/nroCelular/text()</con1:path>
                                        </con1:param>
                                    </con1:xqueryTransform>
                                </con2:expr>
                            </con2:assign>
                        </con2:requestTransform>
                        <con2:responseTransform>
                            <con2:assign varName="respuestaEC">
                                <con1:id>_ActionId-7884824700829185119-16b4a4b0.15a1a217f4d.-7feb</con1:id>
                                <con2:expr>
                                    <con1:xqueryTransform>
                                        <con1:resource ref="GestorUSSD/Resources/XQuery/OUT_XQ_ExtraCredito"/>
                                        <con1:param name="suscribeExtraCreditoResponse">
                                            <con1:path>$responseEC</con1:path>
                                        </con1:param>
                                    </con1:xqueryTransform>
                                </con2:expr>
                            </con2:assign>
                        </con2:responseTransform>
                    </con2:wsCallout>
                    <con2:assign varName="errorCode">
                        <con1:id>_ActionId-4281554535167830158--5b023162.159b2063421.-7894</con1:id>
                        <con2:expr>
                            <con1:xqueryText>$respuestaEC/errorCode/text()</con1:xqueryText>
                        </con2:expr>
                    </con2:assign>
                    <con2:assign varName="errorDescription">
                        <con1:id>_ActionId-4281554535167830158--5b023162.159b2063421.-78b1</con1:id>
                        <con2:expr>
                            <con1:xqueryText>$respuestaEC/errorDescription/text()</con1:xqueryText>
                        </con2:expr>
                    </con2:assign>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="PipelineCreditoEmergencia_response" errorHandler="_onErrorHandler-4281554535167830158--5b023162.159b2063421.-7850">
            <con:stage name="getInfoMensajeCreditoEmergecia">
                <con:context>
                    <con1:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/getInfoMensajeDba" prefix="gmec"/>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con2:ifThenElse>
                        <con1:id>_ActionId-4281554535167830158--5b023162.159b2063421.-7aac</con1:id>
                        <con2:case>
                            <con2:condition>
                                <con1:xqueryText>$errorCode != '00' or empty($errorCode) or not(exists($errorCode))</con1:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:replace varName="body" contents-only="true">
                                    <con1:id>_ActionId-4281554535167830158--5b023162.159b2063421.-7a64</con1:id>
                                    <con2:expr>
                                        <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
   <segmento></segmento>
   <errorCode>{if(empty($errorCode)) then ("99") else $errorCode}</errorCode>
   <errorDescription>{if(empty($errorDescription)) then ("Error con el Servicio ExtraCredito") else($errorDescription)}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                                    </con2:expr>
                                </con2:replace>
                                <con1:reply isError="false">
                                    <con1:id>_ActionId-4281554535167830158--5b023162.159b2063421.-7a2e</con1:id>
                                </con1:reply>
                            </con2:actions>
                        </con2:case>
                        <con2:default>
                            <con2:wsCallout>
                                <con1:id>_ActionId-4281554535167830158--5b023162.159b2063421.-7aa6</con1:id>
                                <con2:service xsi:type="ref:BusinessServiceRef" ref="GestorUSSD/Business Services/BSServiceGetInfoMensaje" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                <con2:operation>getInfoMensajeDba</con2:operation>
                                <con2:request>
                                    <con2:body>InfoMensajeReq</con2:body>
                                </con2:request>
                                <con2:response>
                                    <con2:body>InfoMensajeResp</con2:body>
                                </con2:response>
                                <con2:requestTransform>
                                    <con2:assign varName="InfoMensajeReq">
                                        <con1:id>_ActionId-4281554535167830158--5b023162.159b2063421.-7aa8</con1:id>
                                        <con2:expr>
                                            <con1:xqueryTransform>
                                                <con1:resource ref="GestorUSSD/Resources/XQuery/IN_XQ_getMensaje"/>
                                                <con1:param name="idMsj">
                                                    <con1:path>'10004'</con1:path>
                                                </con1:param>
                                            </con1:xqueryTransform>
                                        </con2:expr>
                                    </con2:assign>
                                </con2:requestTransform>
                                <con2:responseTransform>
                                    <con2:assign varName="respuestaMensaje">
                                        <con1:id>_ActionId-4281554535167830158--5b023162.159b2063421.-7aa7</con1:id>
                                        <con2:expr>
                                            <con1:xqueryTransform>
                                                <con1:resource ref="GestorUSSD/Resources/XQuery/OUT_XQ_getMensaje_TO_EC"/>
                                                <con1:param name="getInfoMensajeDbaOutputCollection">
                                                    <con1:path>$InfoMensajeResp</con1:path>
                                                </con1:param>
                                            </con1:xqueryTransform>
                                        </con2:expr>
                                    </con2:assign>
                                </con2:responseTransform>
                            </con2:wsCallout>
                            <con2:assign varName="respuestaMensaje">
                                <con1:id>_ActionId-4281554535167830158--5b023162.159b2063421.-799c</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>let $fecha_inicio := substring(xs:string(xs:dateTime(fn:current-dateTime())),1,10)
              let $fecha_termino := substring(xs:string(xs:dateTime(fn:current-dateTime()+ xdt:dayTimeDuration("PT120H"))),1,10)
              let $mensaje1 := replace($respuestaMensaje/MENSAJE/text(),'#1',$fecha_inicio)
              let $mensaje2 := replace($mensaje1,'#2',$fecha_termino)
return $mensaje2</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:wsCallout>
                                <con1:id>_ActionId-4281554535167830158--5b023162.159b2063421.-7a10</con1:id>
                                <con2:service xsi:type="ref:BusinessServiceRef" ref="GestorUSSD/Business Services/BSServiceSendSMSSiebelRqRs" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                <con2:operation>sendSMS</con2:operation>
                                <con2:request>
                                    <con2:body>sendSMSReq</con2:body>
                                </con2:request>
                                <con2:response>
                                    <con2:body>sendSMSResp</con2:body>
                                </con2:response>
                                <con2:requestTransform>
                                    <con2:assign varName="sendSMSReq">
                                        <con1:id>_ActionId-4281554535167830158--5b023162.159b2063421.-79fc</con1:id>
                                        <con2:expr>
                                            <con1:xqueryTransform>
                                                <con1:resource ref="GestorUSSD/Resources/XQuery/IN_XQ_SendSMSSiebel"/>
                                                <con1:param name="nroCelular">
                                                    <con1:path>$body/ussd:ussdOperacion/nroCelular/text()</con1:path>
                                                </con1:param>
                                                <con1:param name="mensaje">
                                                    <con1:path>$respuestaMensaje</con1:path>
                                                </con1:param>
                                            </con1:xqueryTransform>
                                        </con2:expr>
                                    </con2:assign>
                                </con2:requestTransform>
                                <con2:responseTransform/>
                            </con2:wsCallout>
                            <con2:replace varName="body" contents-only="true">
                                <con1:id>_ActionId-5359922311114869135-5af9468d.159b69bee2e.-7fc0</con1:id>
                                <con2:expr>
                                    <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
   <segmento></segmento>
   <errorCode>0</errorCode>
   <errorDescription>{$respuestaMensaje}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                                </con2:expr>
                            </con2:replace>
                            <con1:reply>
                                <con1:id>_ActionId-5359922311114869135-5af9468d.159b69bee2e.-7f9c</con1:id>
                            </con1:reply>
                        </con2:default>
                    </con2:ifThenElse>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-4281554535167830158--5b023162.159b2063421.-7893">
            <con:stage name="stage_FaultExtraCredito_request">
                <con:context/>
                <con:actions>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-4281554535167830158--5b023162.159b2063421.-7853</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
   <segmento></segmento>
   <errorCode>{$fault/ctx:errorCode/text()}</errorCode>
   <errorDescription>{concat('stage: ',$fault/ctx:location/ctx:stage/text(),', Error: ', $fault/ctx:reason/text())}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-4281554535167830158--5b023162.159b2063421.-7852</con1:id>
                        <con4:logLevel>error</con4:logLevel>
                        <con4:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con4:expr>
                        <con4:message>-----|||Response PSUSSDOperaciones|||-----</con4:message>
                    </con4:log>
                    <con1:reply isError="false" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-4281554535167830158--5b023162.159b2063421.-7851</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-4281554535167830158--5b023162.159b2063421.-7850">
            <con:stage name="stageFaultExtraCredito_response">
                <con:context/>
                <con:actions>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-4281554535167830158--5b023162.159b2063421.-784c</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
   <segmento></segmento>
   <errorCode>{$fault/ctx:errorCode/text()}</errorCode>
   <errorDescription>{concat('stage: ',$fault/ctx:location/ctx:stage/text(),', Error: ', $fault/ctx:reason/text())}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-4281554535167830158--5b023162.159b2063421.-784b</con1:id>
                        <con4:logLevel>error</con4:logLevel>
                        <con4:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con4:expr>
                        <con4:message>-----|||Response PSUSSDOperaciones|||-----</con4:message>
                    </con4:log>
                    <con1:reply isError="false" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-4281554535167830158--5b023162.159b2063421.-784a</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-1586447002420683682--1e5664d8.15cb2264ba3.-7fc2">
            <con:stage name="getTotalSaldoOut1">
                <con:context/>
                <con:actions>
                    <con2:assign varName="saldoPendienteEC">
                        <con1:id>_ActionId-1586447002420683682--1e5664d8.15cb2264ba3.-7fb5</con1:id>
                        <con2:expr>
                            <con1:xqueryText>"SI"</con1:xqueryText>
                        </con2:expr>
                    </con2:assign>
                    <con2:replace varName="body" contents-only="true">
                        <con1:id>_ActionId-1586447002420683682--1e5664d8.15cb2264ba3.-7fb9</con1:id>
                        <con2:expr>
                            <con1:xqueryTransform>
                                <con1:resource ref="GestorUSSD/Resources/XQuery/OUT_XQ_SearchPrepaidWave"/>
                                <con1:param name="totalDatosSocial">
                                    <con1:path>$totalDatosSocial</con1:path>
                                </con1:param>
                                <con1:param name="saldoPendienteEc">
                                    <con1:path>$saldoPendienteEC</con1:path>
                                </con1:param>
                                <con1:param name="saldoTotal">
                                    <con1:path>$saldoTotal</con1:path>
                                </con1:param>
                                <con1:param name="totalVoz">
                                    <con1:path>$totalVoz</con1:path>
                                </con1:param>
                                <con1:param name="totalDatos4G">
                                    <con1:path>$totalDatos4G</con1:path>
                                </con1:param>
                                <con1:param name="totalSms">
                                    <con1:path>$totalSms</con1:path>
                                </con1:param>
                                <con1:param name="DatosWhatSapp">
                                    <con1:path>$DatosWhatSapp</con1:path>
                                </con1:param>
                                <con1:param name="totalDatos">
                                    <con1:path>$totalDatos</con1:path>
                                </con1:param>
                            </con1:xqueryTransform>
                        </con2:expr>
                    </con2:replace>
                    <con2:delete varName="searchBalanceIccReq">
                        <con1:id>_ActionId-4653326524858331419-38eda4b5.1651a484407.-7fdd</con1:id>
                    </con2:delete>
                    <con2:delete varName="searchBalanceIccResp">
                        <con1:id>_ActionId-4653326524858331419-38eda4b5.1651a484407.-7fdc</con1:id>
                    </con2:delete>
                    <con2:delete varName="requestConsultaEC">
                        <con1:id>_ActionId-4653326524858331419-38eda4b5.1651a484407.-7fdb</con1:id>
                    </con2:delete>
                    <con2:delete varName="responseConsultaEC">
                        <con1:id>_ActionId-4653326524858331419-38eda4b5.1651a484407.-7fda</con1:id>
                    </con2:delete>
                    <con1:reply>
                        <con1:id>_ActionId-1586447002420683682--1e5664d8.15cb2264ba3.-7fb8</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="request" name="PipelinePairNode1_request" errorHandler="_onErrorHandler-3543478420719782908-77411288.15d573757ef.-7ecc">
            <con:stage name="getConsultaSaldoTematico">
                <con:context>
                    <con1:userNsDecl namespace="http://ws.nextel.cl/schemas/searchBalanceIcc/alcatel/getAllInformation" prefix="gets"/>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con2:wsCallout>
                        <con1:id>_ActionId-2625246617180527964-5c492c8.15d50f19f01.-7bdf</con1:id>
                        <con2:service xsi:type="ref:ProxyRef" ref="PrepaidWave/Proxy Services/PSServiceSearchPrepagoICC" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>getSearchBalanceIcc</con2:operation>
                        <con2:request>
                            <con2:body>searchBalanceIccReq</con2:body>
                        </con2:request>
                        <con2:response>
                            <con2:body>searchBalanceIccResp</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                            <con2:assign varName="searchBalanceIccReq">
                                <con1:id>_ActionId-2625246617180527964-5c492c8.15d50f19f01.-7bc3</con1:id>
                                <con2:expr>
                                    <con1:xqueryTransform>
                                        <con1:resource ref="GestorUSSD/Resources/XQuery/IN_XQ_SearchPrepaidWave"/>
                                        <con1:param name="nroCelular">
                                            <con1:path>$body/ussd:ussdOperacion/nroCelular/text()</con1:path>
                                        </con1:param>
                                    </con1:xqueryTransform>
                                </con2:expr>
                            </con2:assign>
                        </con2:requestTransform>
                        <con2:responseTransform>
                            <con2:ifThenElse>
                                <con1:id>_ActionId-2625246617180527964-5c492c8.15d50f19f01.-7bea</con1:id>
                                <con2:case>
                                    <con2:condition>
                                        <con1:xqueryText>empty($searchBalanceIccResp/gets:error_code/text()) or $searchBalanceIccResp/gets:error_code/text() != '0'</con1:xqueryText>
                                    </con2:condition>
                                    <con2:actions>
                                        <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                                            <con1:id>_ActionId-2625246617180527964-5c492c8.15d50f19f01.-7be9</con1:id>
                                            <con3:expr>
                                                <con1:xqueryTransform>
                                                    <con1:resource ref="GestorUSSD/Resources/XQuery/OUT_XQ_getSearchPrepaidError"/>
                                                    <con1:param name="searchBalancesICC_response1">
                                                        <con1:path>$searchBalanceIccResp</con1:path>
                                                    </con1:param>
                                                </con1:xqueryTransform>
                                            </con3:expr>
                                        </con3:replace>
                                        <con1:reply xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                                            <con1:id>_ActionId-2625246617180527964-5c492c8.15d50f19f01.-7be8</con1:id>
                                        </con1:reply>
                                    </con2:actions>
                                </con2:case>
                                <con2:default>
                                    <con2:assign varName="saldosTematicos">
                                        <con1:id>_ActionId-3543478420719782908-77411288.15d573757ef.-7f09</con1:id>
                                        <con2:expr>
                                            <con1:xqueryTransform>
                                                <con1:resource ref="GestorUSSD/Resources/XQuery/getConsultaSaldoTematico"/>
                                                <con1:param name="searchBalancesICCResponse">
                                                    <con1:path>$searchBalanceIccResp</con1:path>
                                                </con1:param>
                                            </con1:xqueryTransform>
                                        </con2:expr>
                                    </con2:assign>
                                </con2:default>
                            </con2:ifThenElse>
                        </con2:responseTransform>
                    </con2:wsCallout>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="PipelinePairNode1_response" errorHandler="_onErrorHandler-3543478420719782908-77411288.15d573757ef.-7ecb">
            <con:stage name="getConsultaSaldoTematicoResponse">
                <con:context/>
                <con:actions>
                    <con2:assign varName="mensaje">
                        <con1:id>_ActionId-3543478420719782908-77411288.15d573757ef.-7ecf</con1:id>
                        <con2:expr>
                            <con1:xqueryTransform>
                                <con1:resource ref="GestorUSSD/Resources/XQuery/armarMensaje"/>
                                <con1:param name="whatsappIlimitado">
                                    <con1:path>$saldosTematicos/ilimitada/whatsapp/text()</con1:path>
                                </con1:param>
                                <con1:param name="vozIlimitada">
                                    <con1:path>$saldosTematicos/ilimitada/vozIlimitado/text()</con1:path>
                                </con1:param>
                            </con1:xqueryTransform>
                        </con2:expr>
                    </con2:assign>
                    <con2:replace contents-only="true" varName="body">
                        <con1:id>_ActionId-3543478420719782908-77411288.15d573757ef.-7ed3</con1:id>
                        <con2:expr>
                            <con1:xqueryTransform>
                                <con1:resource ref="GestorUSSD/Resources/XQuery/getConsultaSaldoTematicoResponse"/>
                                <con1:param name="mensaje">
                                    <con1:path>$mensaje</con1:path>
                                </con1:param>
                                <con1:param name="codigo">
                                    <con1:path>'0'</con1:path>
                                </con1:param>
                            </con1:xqueryTransform>
                        </con2:expr>
                    </con2:replace>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-3543478420719782908-77411288.15d573757ef.-7ecc">
            <con:stage name="manejarError">
                <con:context/>
                <con:actions>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-3543478420719782908-77411288.15d573757ef.-7e77</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
   <segmento></segmento>
   <errorCode>{$fault/ctx:errorCode/text()}</errorCode>
   <errorDescription>{concat('stage: ',$fault/ctx:location/ctx:stage/text(),', Error: ', $fault/ctx:reason/text())}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-3543478420719782908-77411288.15d573757ef.-7dcb</con1:id>
                        <con4:logLevel>error</con4:logLevel>
                        <con4:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con4:expr>
                        <con4:message>-----|||Response PSUSSDOperaciones|||-----</con4:message>
                    </con4:log>
                    <con1:reply isError="false" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-3543478420719782908-77411288.15d573757ef.-7dcd</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-3543478420719782908-77411288.15d573757ef.-7ecb">
            <con:stage name="manejarError">
                <con:context/>
                <con:actions>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-3543478420719782908-77411288.15d573757ef.-7d77</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
   <segmento></segmento>
   <errorCode>{$fault/ctx:errorCode/text()}</errorCode>
   <errorDescription>{concat('stage: ',$fault/ctx:location/ctx:stage/text(),', Error: ', $fault/ctx:reason/text())}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-3543478420719782908-77411288.15d573757ef.-7ccb</con1:id>
                        <con4:logLevel>error</con4:logLevel>
                        <con4:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con4:expr>
                        <con4:message>-----|||Response PSUSSDOperaciones|||-----</con4:message>
                    </con4:log>
                    <con1:reply isError="false" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-3543478420719782908-77411288.15d573757ef.-7ccd</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="request" name="PipelinePairCompraBolsasMahindra_request" errorHandler="_onErrorHandler-6568258738919597800-e8be9f4.15ccffec13a.-7947">
            <con:stage name="validaParametroEntradaXCompra" xmlns:con3="http://www.bea.com/wli/sb/stages/publish/config">
                <con:context>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con2:assign varName="usuarioMahindra">
                        <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-762b</con1:id>
                        <con2:expr>
                            <con1:xqueryTransform>
                                <con1:resource ref="GestorUSSD/Resources/XQuery/XQ_USERPASSWORD"/>
                            </con1:xqueryTransform>
                        </con2:expr>
                    </con2:assign>
                    <con2:ifThenElse>
                        <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-7950</con1:id>
                        <con2:case>
                            <con2:condition>
                                <con1:xqueryText>empty($body/ussd:ussdOperacion/idProd/text()) or empty($body/ussd:ussdOperacion/idServicio/text())</con1:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:Error>
                                    <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-794f</con1:id>
                                    <con2:errCode>VAL-0001</con2:errCode>
                                    <con2:message>los campos idProd y idServicio deben ser ingresados</con2:message>
                                </con2:Error>
                            </con2:actions>
                        </con2:case>
                        <con2:default/>
                    </con2:ifThenElse>
                </con:actions>
            </con:stage>
            <con:stage name="getCustomerInfo" xmlns:con3="http://www.bea.com/wli/sb/stages/publish/config">
                <con:context>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con2:wsCallout>
                        <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-794d</con1:id>
                        <con2:service xsi:type="ref:ProxyRef" ref="PortalCautivo/Proxy Services/PSBSCSPortalCautivoService" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>getNextelCustomerInfo</con2:operation>
                        <con2:request>
                            <con2:body>nextelCustomerInfoReq</con2:body>
                        </con2:request>
                        <con2:response>
                            <con2:body>nextelCustomerInfoResp</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                            <con2:replace varName="nextelCustomerInfoReq">
                                <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-794e</con1:id>
                                <con2:expr>
                                    <con1:xqueryTransform>
                                        <con1:resource ref="GestorUSSD/Resources/XQuery/IN_XQ_setCustomerInfo"/>
                                        <con1:param name="nroCelular">
                                            <con1:path>$body/ussd:ussdOperacion/nroCelular/text()</con1:path>
                                        </con1:param>
                                    </con1:xqueryTransform>
                                </con2:expr>
                            </con2:replace>
                        </con2:requestTransform>
                        <con2:responseTransform/>
                    </con2:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage name="setNextelActiveProduct" xmlns:con3="http://www.bea.com/wli/sb/stages/publish/config">
                <con:context>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con2:wsCallout>
                        <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-7948</con1:id>
                        <con2:service xsi:type="ref:ProxyRef" ref="PortalCautivo/Proxy Services/PSBSCSPortalCautivoService" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>setNextelActiveProduct</con2:operation>
                        <con2:request>
                            <con2:body>NextelActiveProductReq</con2:body>
                        </con2:request>
                        <con2:response>
                            <con2:body>NextelActiveProductResp</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                            <con2:replace varName="NextelActiveProductReq" contents-only="false">
                                <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-794c</con1:id>
                                <con2:expr>
                                    <con1:xqueryTransform>
                                        <con1:resource ref="GestorUSSD/Resources/XQuery/IN_XQ_NextelActiveProduct_OutInfoCliente"/>
                                        <con1:param name="id_prod_service">
                                            <con1:path>$body/ussd:ussdOperacion/idServicio/text()</con1:path>
                                        </con1:param>
                                        <con1:param name="getNextelCustomerInfoResponse1">
                                            <con1:path>$nextelCustomerInfoResp</con1:path>
                                        </con1:param>
                                        <con1:param name="id_prod">
                                            <con1:path>$body/ussd:ussdOperacion/idProd/text()</con1:path>
                                        </con1:param>
                                        <con1:param name="nroCelular">
                                            <con1:path>$body/ussd:ussdOperacion/nroCelular/text()</con1:path>
                                        </con1:param>
                                    </con1:xqueryTransform>
                                </con2:expr>
                            </con2:replace>
                        </con2:requestTransform>
                        <con2:responseTransform>
                            <con2:assign varName="msjPortalRespuesta">
                                <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-794b</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>$NextelActiveProductResp/err_description/text()</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:assign varName="codPortalRespuesta">
                                <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-794a</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>$NextelActiveProductResp/error_code/text()</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:assign varName="transcode">
                                <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-7949</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>$NextelActiveProductResp/transaction_code/text()</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                        </con2:responseTransform>
                    </con2:wsCallout>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="PipelinePairCompraBolsasMahindra_response" errorHandler="_onErrorHandler-6568258738919597800-e8be9f4.15ccffec13a.-7931">
            <con:stage name="outCompraBolsas" xmlns:con3="http://www.bea.com/wli/sb/stages/publish/config">
                <con:comment/>
                <con:context>
                    <con1:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/getInfoMensajeDba" prefix="ns0"/>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con2:ifThenElse>
                        <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-793d</con1:id>
                        <con2:case>
                            <con2:condition>
                                <con1:xqueryText>fn-bea:trim(upper-case($msjPortalRespuesta)) = 'OK'</con1:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:wsCallout>
                                    <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-7938</con1:id>
                                    <con2:service xsi:type="ref:BusinessServiceRef" ref="GestorUSSD/Business Services/BSServiceGetInfoMensaje" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con2:operation>getInfoMensajeDba</con2:operation>
                                    <con2:request>
                                        <con2:body>InfoMensajeReq</con2:body>
                                    </con2:request>
                                    <con2:response>
                                        <con2:body>InfoMensajeResp</con2:body>
                                    </con2:response>
                                    <con2:requestTransform>
                                        <con2:replace varName="InfoMensajeReq" contents-only="false">
                                            <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-793c</con1:id>
                                            <con2:expr>
                                                <con1:xqueryTransform>
                                                    <con1:resource ref="GestorUSSD/Resources/XQuery/IN_XQ_getMensaje"/>
                                                    <con1:param name="idMsj">
                                                        <con1:path>$body/ussd:ussdOperacion/idProd/text()</con1:path>
                                                    </con1:param>
                                                </con1:xqueryTransform>
                                            </con2:expr>
                                        </con2:replace>
                                    </con2:requestTransform>
                                    <con2:responseTransform>
                                        <con2:assign varName="msjOut">
                                            <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-793b</con1:id>
                                            <con2:expr>
                                                <con1:xqueryText>$InfoMensajeResp/ns0:getInfoMensajeDbaOutput[1]/ns0:MENSAJE/text()</con1:xqueryText>
                                            </con2:expr>
                                        </con2:assign>
                                        <con2:ifThenElse>
                                            <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-793a</con1:id>
                                            <con2:case>
                                                <con2:condition>
                                                    <con1:xqueryText>empty($msjOut)</con1:xqueryText>
                                                </con2:condition>
                                                <con2:actions>
                                                    <con2:assign varName="msjOut">
                                                        <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-7939</con1:id>
                                                        <con2:expr>
                                                            <con1:xqueryText>'Felicidades su bolsa ha sido activada :D.'</con1:xqueryText>
                                                        </con2:expr>
                                                    </con2:assign>
                                                </con2:actions>
                                            </con2:case>
                                            <con2:default/>
                                        </con2:ifThenElse>
                                    </con2:responseTransform>
                                </con2:wsCallout>
                                <con3:route>
                                    <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-7937</con1:id>
                                    <con3:service ref="GestorUSSD/Business Services/BSServicesEventNotifierMahindra" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con3:operation>eventNotifier</con3:operation>
                                    <con3:outboundTransform>
                                        <con2:replace varName="body" contents-only="true">
                                            <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-7936</con1:id>
                                            <con2:expr>
                                                <con1:xqueryTransform>
                                                    <con1:resource ref="GestorUSSD/Resources/XQuery/IN_XQ_EventNotifier"/>
                                                    <con1:param name="pass">
                                                        <con1:path>data($usuarioMahindra/pass)</con1:path>
                                                    </con1:param>
                                                    <con1:param name="IdTransaccion">
                                                        <con1:path>$transcode</con1:path>
                                                    </con1:param>
                                                    <con1:param name="ussdOperacion1">
                                                        <con1:path>$body/ussd:ussdOperacion</con1:path>
                                                    </con1:param>
                                                    <con1:param name="usuario">
                                                        <con1:path>data($usuarioMahindra/user)</con1:path>
                                                    </con1:param>
                                                </con1:xqueryTransform>
                                            </con2:expr>
                                        </con2:replace>
                                    </con3:outboundTransform>
                                </con3:route>
                                <con2:replace varName="body" contents-only="true">
                                    <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-7935</con1:id>
                                    <con2:expr>
                                        <con1:xqueryTransform>
                                            <con1:resource ref="GestorUSSD/Resources/XQuery/OUT_XQ_Msj_NextelActiveProduct"/>
                                            <con1:param name="codError">
                                                <con1:path>$codPortalRespuesta</con1:path>
                                            </con1:param>
                                            <con1:param name="msjError">
                                                <con1:path>$msjOut</con1:path>
                                            </con1:param>
                                        </con1:xqueryTransform>
                                    </con2:expr>
                                </con2:replace>
                            </con2:actions>
                        </con2:case>
                        <con2:default>
                            <con2:replace varName="body" contents-only="true">
                                <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-7933</con1:id>
                                <con2:expr>
                                    <con1:xqueryTransform>
                                        <con1:resource ref="GestorUSSD/Resources/XQuery/OUT_XQ_NextelActiveProduct"/>
                                        <con1:param name="setNextelActiveProductResponse1">
                                            <con1:path>$NextelActiveProductResp</con1:path>
                                        </con1:param>
                                    </con1:xqueryTransform>
                                </con2:expr>
                            </con2:replace>
                        </con2:default>
                    </con2:ifThenElse>
                    <con2:delete varName="InfoMensajeResp">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-79c9</con1:id>
                    </con2:delete>
                    <con2:delete varName="InfoMensajeReq">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-79c8</con1:id>
                    </con2:delete>
                    <con2:delete varName="NextelActiveProductResp">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-79c7</con1:id>
                    </con2:delete>
                    <con2:delete varName="NextelActiveProductReq">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-79c6</con1:id>
                    </con2:delete>
                    <con2:delete varName="getBolsaIlimitadaXPlanResp">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-79c5</con1:id>
                    </con2:delete>
                    <con2:delete varName="getBolsaIlimitadaXPlanReq">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-79c4</con1:id>
                    </con2:delete>
                    <con2:delete varName="nextelCustomerInfoResp">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-79c3</con1:id>
                    </con2:delete>
                    <con2:delete varName="nextelCustomerInfoReq">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-79c2</con1:id>
                    </con2:delete>
                    <con2:delete varName="msjOut">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-79c1</con1:id>
                    </con2:delete>
                    <con2:delete varName="codPortalRespuesta">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-79c0</con1:id>
                    </con2:delete>
                    <con2:delete varName="msjPortalRespuesta">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-79bf</con1:id>
                    </con2:delete>
                    <con1:reply>
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-79bb</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-6568258738919597800-e8be9f4.15ccffec13a.-7947">
            <con:stage name="stgErrorInCompBols" xmlns:con3="http://www.bea.com/wli/sb/stages/publish/config">
                <con:context>
                    <con1:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1"/>
                    <con1:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/PROVI_BOLS/REGISTROS_PG/REGISTRA_ERRORES_FN/" prefix="rlog"/>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7a2c</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
   <segmento></segmento>
   <errorCode>{$fault/ctx:errorCode/text()}</errorCode>
   <errorDescription>{concat('stage: ',$fault/ctx:location/ctx:stage/text(),', Error: ', $fault/ctx:reason/text()), 'Detalle: ' ,$NextelActiveProductResp/err_description/text()}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con2:assign varName="bodyResponse">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7a2a</con1:id>
                        <con2:expr>
                            <con1:xqueryText>fn-bea:serialize($body/ussd:ussdOperacionResponse)</con1:xqueryText>
                        </con2:expr>
                    </con2:assign>
                    <con2:assign varName="stageError">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7a28</con1:id>
                        <con2:expr>
                            <con1:xqueryText>$fault/ctx:location/ctx:stage/text()</con1:xqueryText>
                        </con2:expr>
                    </con2:assign>
                    <con2:wsCallout>
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7a1c</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="GestorUSSD/Business Services/BSServiceSetEventErrorServicePrepaid" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>setEventErrorServicePrepaidDba</con2:operation>
                        <con2:request>
                            <con2:body>eventErrorServicePrepaidReq</con2:body>
                        </con2:request>
                        <con2:response>
                            <con2:body>eventErrorServicePrepaidResp</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                            <con2:assign varName="eventErrorServicePrepaidReq">
                                <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7a21</con1:id>
                                <con2:expr>
                                    <con1:xqueryText><![CDATA[<reg:InputParameters xmlns:reg="http://xmlns.oracle.com/pcbpel/adapter/db/PROVI_BOLS/REGISTROS_PG/REGISTRA_ERRORES_FN/">
    <!--Optional:-->
    <reg:EN_NUM_REGISTRO>0</reg:EN_NUM_REGISTRO>
    <!--Optional:-->
    <reg:EV_NOM_USUARIO>USSD</reg:EV_NOM_USUARIO>
    <!--Optional:-->
    <reg:EV_NOM_METODO>CompraBolsasUSSD</reg:EV_NOM_METODO>
    <!--Optional:-->
    <reg:EV_DES_QUERY>{$stageError}</reg:EV_DES_QUERY>
    <!--Optional:-->
    <reg:EN_COD_RESPUESTA>{$body/ussd:ussdOperacionResponse/errorDescription/text()}</reg:EN_COD_RESPUESTA>
    <!--Optional:-->
    <reg:EV_MENS_RESPUESTA>{
    fn:substring($body/ussd:ussdOperacionResponse/errorDescription/text(),0,2001)
    }</reg:EV_MENS_RESPUESTA>
    <!--Optional:-->
    <reg:EV_NUM_ERROR_ORA>{$body/ussd:ussdOperacionResponse/errorCode/text()}</reg:EV_NUM_ERROR_ORA>
    <!--Optional:-->
    <reg:EV_DES_ERROR_ORA>{fn:substring($body/ussd:ussdOperacionResponse/errorDescription/text(),0,2001)}</reg:EV_DES_ERROR_ORA>
    <!--Optional:-->
    <reg:EC_DES_REQUEST>{$bodyRequest}</reg:EC_DES_REQUEST>
    <!--Optional:-->
    <reg:EC_DES_RESPONSE>{$bodyResponse}</reg:EC_DES_RESPONSE>
</reg:InputParameters>]]></con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                        </con2:requestTransform>
                        <con2:responseTransform>
                            <con2:assign varName="eventoError">
                                <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7a20</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>$eventErrorServicePrepaidResp/rlog:REGISTRA_ERRORES_FN/text()</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:replace varName="body" contents-only="true">
                                <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7a1f</con1:id>
                                <con2:expr>
                                    <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
	<errorCode>{$body/ussd:ussdOperacionResponse/errorCode/text()}</errorCode>
	<errorDescription>{concat('Transacción error: ',$eventoError,', Mensaje: ',$body/ussd:ussdOperacionResponse/errorDescription/text())}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                                </con2:expr>
                            </con2:replace>
                            <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                                <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7a1e</con1:id>
                                <con4:logLevel>error</con4:logLevel>
                                <con4:expr>
                                    <con1:xqueryText>$body</con1:xqueryText>
                                </con4:expr>
                                <con4:message>-----|||Response PSUSSDOperaciones|||-----</con4:message>
                            </con4:log>
                        </con2:responseTransform>
                    </con2:wsCallout>
                    <con2:delete varName="segmento">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7a32</con1:id>
                    </con2:delete>
                    <con2:delete varName="PlataformaPCRF">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7a31</con1:id>
                    </con2:delete>
                    <con2:delete varName="PlataformaICC">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7a30</con1:id>
                    </con2:delete>
                    <con2:delete varName="flagPrepago">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7a2f</con1:id>
                    </con2:delete>
                    <con2:delete varName="clasificaOferta">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7a2e</con1:id>
                    </con2:delete>
                    <con1:reply isError="false">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7a18</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-6568258738919597800-e8be9f4.15ccffec13a.-7931">
            <con:stage name="stgErrorOutCompBols" xmlns:con3="http://www.bea.com/wli/sb/stages/publish/config">
                <con:comment/>
                <con:context>
                    <con1:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1"/>
                    <con1:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/PROVI_BOLS/REGISTROS_PG/REGISTRA_ERRORES_FN/" prefix="rlog"/>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-7930</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
   <segmento></segmento>
   <errorCode>{$fault/ctx:errorCode/text()}</errorCode>
   <errorDescription>{concat('stage: ',$fault/ctx:location/ctx:stage/text(),', Error: ', $fault/ctx:reason/text())}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con2:assign varName="bodyResponse">
                        <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-792f</con1:id>
                        <con2:expr>
                            <con1:xqueryText>fn-bea:serialize($body/ussd:ussdOperacionResponse)</con1:xqueryText>
                        </con2:expr>
                    </con2:assign>
                    <con2:assign varName="stageError">
                        <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-792e</con1:id>
                        <con2:expr>
                            <con1:xqueryText>$fault/ctx:location/ctx:stage/text()</con1:xqueryText>
                        </con2:expr>
                    </con2:assign>
                    <con2:wsCallout>
                        <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-7928</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="GestorUSSD/Business Services/BSServiceSetEventErrorServicePrepaid" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>setEventErrorServicePrepaidDba</con2:operation>
                        <con2:request>
                            <con2:body>eventErrorServicePrepaidReq</con2:body>
                        </con2:request>
                        <con2:response>
                            <con2:body>eventErrorServicePrepaidResp</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                            <con2:assign varName="eventErrorServicePrepaidReq">
                                <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-792d</con1:id>
                                <con2:expr>
                                    <con1:xqueryText><![CDATA[<reg:InputParameters xmlns:reg="http://xmlns.oracle.com/pcbpel/adapter/db/PROVI_BOLS/REGISTROS_PG/REGISTRA_ERRORES_FN/">
    <!--Optional:-->
    <reg:EN_NUM_REGISTRO>0</reg:EN_NUM_REGISTRO>
    <!--Optional:-->
    <reg:EV_NOM_USUARIO>USSD</reg:EV_NOM_USUARIO>
    <!--Optional:-->
    <reg:EV_NOM_METODO>CompraBolsasUSSD</reg:EV_NOM_METODO>
    <!--Optional:-->
    <reg:EV_DES_QUERY>{$stageError}</reg:EV_DES_QUERY>
    <!--Optional:-->
    <reg:EN_COD_RESPUESTA>{$body/ussd:ussdOperacionResponse/errorDescription/text()}</reg:EN_COD_RESPUESTA>
    <!--Optional:-->
    <reg:EV_MENS_RESPUESTA>{
    fn:substring($body/ussd:ussdOperacionResponse/errorDescription/text(),0,2001)
    }</reg:EV_MENS_RESPUESTA>
    <!--Optional:-->
    <reg:EV_NUM_ERROR_ORA>{$body/ussd:ussdOperacionResponse/errorCode/text()}</reg:EV_NUM_ERROR_ORA>
    <!--Optional:-->
    <reg:EV_DES_ERROR_ORA>{fn:substring($body/ussd:ussdOperacionResponse/errorDescription/text(),0,2001)}</reg:EV_DES_ERROR_ORA>
    <!--Optional:-->
    <reg:EC_DES_REQUEST>{$bodyRequest}</reg:EC_DES_REQUEST>
    <!--Optional:-->
    <reg:EC_DES_RESPONSE>{$bodyResponse}</reg:EC_DES_RESPONSE>
</reg:InputParameters>]]></con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                        </con2:requestTransform>
                        <con2:responseTransform>
                            <con2:assign varName="eventoError">
                                <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-792c</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>$eventErrorServicePrepaidResp/rlog:REGISTRA_ERRORES_FN/text()</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:replace varName="body" contents-only="true">
                                <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-792b</con1:id>
                                <con2:expr>
                                    <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
	<errorCode>{$body/ussd:ussdOperacionResponse/errorCode/text()}</errorCode>
	<errorDescription>{concat('Transacción error: ',$eventoError,', Mensaje: ',$body/ussd:ussdOperacionResponse/errorDescription/text())}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                                </con2:expr>
                            </con2:replace>
                            <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                                <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-792a</con1:id>
                                <con4:logLevel>error</con4:logLevel>
                                <con4:expr>
                                    <con1:xqueryText>$body</con1:xqueryText>
                                </con4:expr>
                                <con4:message>-----|||Response PSUSSDOperaciones|||-----</con4:message>
                            </con4:log>
                        </con2:responseTransform>
                    </con2:wsCallout>
                    <con2:delete varName="msjPortalRespuesta">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7987</con1:id>
                    </con2:delete>
                    <con2:delete varName="codPortalRespuesta">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7986</con1:id>
                    </con2:delete>
                    <con2:delete varName="msjOut">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7985</con1:id>
                    </con2:delete>
                    <con2:delete varName="nextelCustomerInfoReq">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7984</con1:id>
                    </con2:delete>
                    <con2:delete varName="nextelCustomerInfoResp">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7983</con1:id>
                    </con2:delete>
                    <con2:delete varName="getBolsaIlimitadaXPlanReq">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7982</con1:id>
                    </con2:delete>
                    <con2:delete varName="getBolsaIlimitadaXPlanResp">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7981</con1:id>
                    </con2:delete>
                    <con2:delete varName="NextelActiveProductReq">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7980</con1:id>
                    </con2:delete>
                    <con2:delete varName="NextelActiveProductResp">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-797f</con1:id>
                    </con2:delete>
                    <con2:delete varName="InfoMensajeReq">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-797e</con1:id>
                    </con2:delete>
                    <con2:delete varName="InfoMensajeResp">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-797d</con1:id>
                    </con2:delete>
                    <con1:reply isError="false">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7979</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="request" name="PipelineGetOffersMahindra_request" errorHandler="_onErrorHandler-6568258738919597800-e8be9f4.15ccffec13a.-743a">
            <con:stage name="stgGetOffersMahindra">
                <con:context>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con2:assign varName="usuarioMahindra">
                        <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-74e0</con1:id>
                        <con2:expr>
                            <con1:xqueryTransform>
                                <con1:resource ref="GestorUSSD/Resources/XQuery/XQ_USERPASSWORD"/>
                            </con1:xqueryTransform>
                        </con2:expr>
                    </con2:assign>
                    <con2:assign varName="IdTransaccion" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config">
                        <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-74de</con1:id>
                        <con2:expr>
                            <con1:xqueryText>let $nowId:=xs:string(fn:current-dateTime())
let $Id := fn:substring($nowId,0,(fn:string-length($nowId)-6))
return
replace($Id,'[T:.]','')</con1:xqueryText>
                        </con2:expr>
                    </con2:assign>
                    <con2:wsCallout>
                        <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-7587</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="GestorUSSD/Business Services/BSServicesEventNotifierMahindra" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>getOffers</con2:operation>
                        <con2:request>
                            <con2:body>getOffersReq</con2:body>
                        </con2:request>
                        <con2:response>
                            <con2:body>getOffersResp</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                            <con2:replace varName="getOffersReq">
                                <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-74e2</con1:id>
                                <con2:expr>
                                    <con1:xqueryTransform>
                                        <con1:resource ref="GestorUSSD/Resources/XQuery/IN_XQ_GetOfferUssd"/>
                                        <con1:param name="pass">
                                            <con1:path>data($usuarioMahindra/pass)</con1:path>
                                        </con1:param>
                                        <con1:param name="IdTransaccion">
                                            <con1:path>$IdTransaccion</con1:path>
                                        </con1:param>
                                        <con1:param name="ussdOperacion1">
                                            <con1:path>$body/ussd:ussdOperacion</con1:path>
                                        </con1:param>
                                        <con1:param name="usuario">
                                            <con1:path>data($usuarioMahindra/user)</con1:path>
                                        </con1:param>
                                    </con1:xqueryTransform>
                                </con2:expr>
                            </con2:replace>
                        </con2:requestTransform>
                        <con2:responseTransform/>
                    </con2:wsCallout>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="PipelineGetOffersMahindra_response" errorHandler="_onErrorHandler-6568258738919597800-e8be9f4.15ccffec13a.-7439">
            <con:stage name="stgOutGetOffersMahindra">
                <con:context/>
                <con:actions>
                    <con2:replace varName="body" contents-only="true">
                        <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-7275</con1:id>
                        <con2:expr>
                            <con1:xqueryTransform>
                                <con1:resource ref="GestorUSSD/Resources/XQuery/OUT_XQ_GetOfferUssd"/>
                                <con1:param name="getOffersResponse1">
                                    <con1:path>$getOffersResp</con1:path>
                                </con1:param>
                            </con1:xqueryTransform>
                        </con2:expr>
                    </con2:replace>
                    <con1:reply>
                        <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-7204</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-6568258738919597800-e8be9f4.15ccffec13a.-743a">
            <con:stage name="stgErrorGetOffersMahindra">
                <con:comment/>
                <con:context>
                    <con1:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1"/>
                </con:context>
                <con:actions>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-73c6</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
   <segmento></segmento>
   <errorCode>{$fault/ctx:errorCode/text()}</errorCode>
   <errorDescription>{concat('stage: ',$fault/ctx:location/ctx:stage/text(),', Error: ', $fault/ctx:reason/text())}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-73c5</con1:id>
                        <con4:logLevel>error</con4:logLevel>
                        <con4:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con4:expr>
                        <con4:message>-----|||Response PSUSSDOperaciones|||-----</con4:message>
                    </con4:log>
                    <con1:reply isError="false" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-73c4</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-6568258738919597800-e8be9f4.15ccffec13a.-7439">
            <con:stage name="stgErrorGetOutOffersMahindra">
                <con:comment/>
                <con:context>
                    <con1:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1"/>
                </con:context>
                <con:actions>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-7351</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
   <segmento></segmento>
   <errorCode>{$fault/ctx:errorCode/text()}</errorCode>
   <errorDescription>{concat('stage: ',$fault/ctx:location/ctx:stage/text(),', Error: ', $fault/ctx:reason/text())}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-7350</con1:id>
                        <con4:logLevel>error</con4:logLevel>
                        <con4:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con4:expr>
                        <con4:message>-----|||Response PSUSSDOperaciones|||-----</con4:message>
                    </con4:log>
                    <con1:reply isError="false" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-6568258738919597800-e8be9f4.15ccffec13a.-734f</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="request" name="PipelineCompraBolsaIlimitaXPlan_request" errorHandler="_onErrorHandler-1125534872727065929-5944a1b0.15f2650c606.-7413">
            <con:stage name="getCustomerInfo">
                <con:context>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con2:wsCallout>
                        <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-78ad</con1:id>
                        <con2:service xsi:type="ref:ProxyRef" ref="PortalCautivo/Proxy Services/PSBSCSPortalCautivoService" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>getNextelCustomerInfo</con2:operation>
                        <con2:request>
                            <con2:body>nextelCustomerInfoReq</con2:body>
                        </con2:request>
                        <con2:response>
                            <con2:body>nextelCustomerInfoResp</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                            <con2:replace varName="nextelCustomerInfoReq">
                                <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-78ae</con1:id>
                                <con2:expr>
                                    <con1:xqueryTransform>
                                        <con1:resource ref="GestorUSSD/Resources/XQuery/IN_XQ_setCustomerInfo"/>
                                        <con1:param name="nroCelular">
                                            <con1:path>$body/ussd:ussdOperacion/nroCelular/text()</con1:path>
                                        </con1:param>
                                    </con1:xqueryTransform>
                                </con2:expr>
                            </con2:replace>
                        </con2:requestTransform>
                        <con2:responseTransform>
                            <con2:assign varName="iDPlan">
                                <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-773f</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>$nextelCustomerInfoResp/iDPlan/text()</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                        </con2:responseTransform>
                    </con2:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage name="getBolsaIlimitadaXPlan">
                <con:context>
                    <con1:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/getBolsaIlimitadaXPlan" prefix="ns0"/>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con2:wsCallout>
                        <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-75cd</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="GestorUSSD/Business Services/BSServiceGetBolsaIlimitadaXPlan" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>getBolsaIlimitadaXPlan</con2:operation>
                        <con2:request>
                            <con2:body>getBolsaIlimitadaXPlanReq</con2:body>
                        </con2:request>
                        <con2:response>
                            <con2:body>getBolsaIlimitadaXPlanResp</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                            <con2:replace varName="getBolsaIlimitadaXPlanReq">
                                <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7595</con1:id>
                                <con2:expr>
                                    <con1:xqueryTransform>
                                        <con1:resource ref="GestorUSSD/Resources/XQuery/IN_XQ_GetBolsaIlimitadaXPlan"/>
                                        <con1:param name="tmcode">
                                            <con1:path>$iDPlan</con1:path>
                                        </con1:param>
                                        <con1:param name="canal">
                                            <con1:path>$body/ussd:ussdOperacion/segmento/text()</con1:path>
                                        </con1:param>
                                        <con1:param name="clasificaBolsa">
                                            <con1:path>$body/ussd:ussdOperacion/idProd/text()</con1:path>
                                        </con1:param>
                                    </con1:xqueryTransform>
                                </con2:expr>
                            </con2:replace>
                        </con2:requestTransform>
                        <con2:responseTransform>
                            <con2:assign varName="Id_prod">
                                <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-755c</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>$getBolsaIlimitadaXPlanResp/ns0:getBolsaIlimitadaXPlanOutput[1]/ns0:ID_PROD/text()</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:ifThenElse>
                                <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-72ee</con1:id>
                                <con2:case>
                                    <con2:condition>
                                        <con1:xqueryText>empty($Id_prod) or $Id_prod = ''</con1:xqueryText>
                                    </con2:condition>
                                    <con2:actions>
                                        <con2:Error>
                                            <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-72b6</con1:id>
                                            <con2:errCode>ERR-0010</con2:errCode>
                                            <con2:message>No se encuentra bolsa ilimitada asociada a el plan del cliente</con2:message>
                                        </con2:Error>
                                    </con2:actions>
                                </con2:case>
                                <con2:default/>
                            </con2:ifThenElse>
                            <con2:assign varName="Id_pcrf_prod">
                                <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7523</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>$getBolsaIlimitadaXPlanResp/ns0:getBolsaIlimitadaXPlanOutput[1]/ns0:ID_PCRF_PROD/text()</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                        </con2:responseTransform>
                    </con2:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage name="setNextelActiveProduct">
                <con:context>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con2:wsCallout>
                        <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7793</con1:id>
                        <con2:service xsi:type="ref:ProxyRef" ref="PortalCautivo/Proxy Services/PSBSCSPortalCautivoService" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>setNextelActiveProduct</con2:operation>
                        <con2:request>
                            <con2:body>NextelActiveProductReq</con2:body>
                        </con2:request>
                        <con2:response>
                            <con2:body>NextelActiveProductResp</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                            <con2:replace varName="NextelActiveProductReq">
                                <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7796</con1:id>
                                <con2:expr>
                                    <con1:xqueryTransform>
                                        <con1:resource ref="GestorUSSD/Resources/XQuery/IN_XQ_NextelActiveProductIlimitado_OutInfoCliente"/>
                                        <con1:param name="id_prod_service">
                                            <con1:path>$Id_pcrf_prod</con1:path>
                                        </con1:param>
                                        <con1:param name="getNextelCustomerInfoResponse1">
                                            <con1:path>$nextelCustomerInfoResp</con1:path>
                                        </con1:param>
                                        <con1:param name="canal">
                                            <con1:path>$body/ussd:ussdOperacion/segmento/text()</con1:path>
                                        </con1:param>
                                        <con1:param name="id_prod">
                                            <con1:path>$Id_prod</con1:path>
                                        </con1:param>
                                        <con1:param name="nroCelular">
                                            <con1:path>$body/ussd:ussdOperacion/nroCelular/text()</con1:path>
                                        </con1:param>
                                    </con1:xqueryTransform>
                                </con2:expr>
                            </con2:replace>
                        </con2:requestTransform>
                        <con2:responseTransform>
                            <con2:assign varName="msjPortalRespuesta">
                                <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7795</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>$NextelActiveProductResp/err_description/text()</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:assign varName="codPortalRespuesta">
                                <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7794</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>$NextelActiveProductResp/error_code/text()</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                        </con2:responseTransform>
                    </con2:wsCallout>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="PipelineCompraBolsaIlimitaXPlan_response" errorHandler="_onErrorHandler-1125534872727065929-5944a1b0.15f2650c606.-7412">
            <con:stage name="outCompraBolsaIlimitaXPlan">
                <con:context>
                    <con1:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/getInfoMensajeDba" prefix="ns0"/>
                </con:context>
                <con:actions>
                    <con2:ifThenElse>
                        <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7684</con1:id>
                        <con2:case>
                            <con2:condition>
                                <con1:xqueryText>fn-bea:trim(upper-case($msjPortalRespuesta)) = 'OK'</con1:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:wsCallout>
                                    <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-767d</con1:id>
                                    <con2:service xsi:type="ref:BusinessServiceRef" ref="GestorUSSD/Business Services/BSServiceGetInfoMensaje" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con2:operation>getInfoMensajeDba</con2:operation>
                                    <con2:request>
                                        <con2:body>InfoMensajeReq</con2:body>
                                    </con2:request>
                                    <con2:response>
                                        <con2:body>InfoMensajeResp</con2:body>
                                    </con2:response>
                                    <con2:requestTransform>
                                        <con2:replace varName="InfoMensajeReq" contents-only="false">
                                            <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7683</con1:id>
                                            <con2:expr>
                                                <con1:xqueryTransform>
                                                    <con1:resource ref="GestorUSSD/Resources/XQuery/IN_XQ_getMensaje"/>
                                                    <con1:param name="idMsj">
                                                        <con1:path>$Id_prod</con1:path>
                                                    </con1:param>
                                                </con1:xqueryTransform>
                                            </con2:expr>
                                        </con2:replace>
                                    </con2:requestTransform>
                                    <con2:responseTransform>
                                        <con2:assign varName="msjOut">
                                            <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7682</con1:id>
                                            <con2:expr>
                                                <con1:xqueryText>$InfoMensajeResp/ns0:getInfoMensajeDbaOutput[1]/ns0:MENSAJE/text()</con1:xqueryText>
                                            </con2:expr>
                                        </con2:assign>
                                        <con2:ifThenElse>
                                            <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7681</con1:id>
                                            <con2:case>
                                                <con2:condition>
                                                    <con1:xqueryText>empty($msjOut)</con1:xqueryText>
                                                </con2:condition>
                                                <con2:actions>
                                                    <con2:assign varName="msjOut">
                                                        <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7680</con1:id>
                                                        <con2:expr>
                                                            <con1:xqueryText>'Felicidades su bolsa ha sido activada :D.'</con1:xqueryText>
                                                        </con2:expr>
                                                    </con2:assign>
                                                </con2:actions>
                                            </con2:case>
                                            <con2:default/>
                                        </con2:ifThenElse>
                                        <con2:replace varName="body" contents-only="true">
                                            <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-767f</con1:id>
                                            <con2:expr>
                                                <con1:xqueryTransform>
                                                    <con1:resource ref="GestorUSSD/Resources/XQuery/OUT_XQ_Msj_NextelActiveProduct"/>
                                                    <con1:param name="codError">
                                                        <con1:path>$codPortalRespuesta</con1:path>
                                                    </con1:param>
                                                    <con1:param name="msjError">
                                                        <con1:path>$msjOut</con1:path>
                                                    </con1:param>
                                                </con1:xqueryTransform>
                                            </con2:expr>
                                        </con2:replace>
                                    </con2:responseTransform>
                                </con2:wsCallout>
                            </con2:actions>
                        </con2:case>
                        <con2:default>
                            <con2:replace varName="body" contents-only="true">
                                <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-767c</con1:id>
                                <con2:expr>
                                    <con1:xqueryTransform>
                                        <con1:resource ref="GestorUSSD/Resources/XQuery/OUT_XQ_NextelActiveProduct"/>
                                        <con1:param name="setNextelActiveProductResponse1">
                                            <con1:path>$NextelActiveProductResp</con1:path>
                                        </con1:param>
                                    </con1:xqueryTransform>
                                </con2:expr>
                            </con2:replace>
                        </con2:default>
                    </con2:ifThenElse>
                    <con2:delete varName="iDPlan">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7a82</con1:id>
                    </con2:delete>
                    <con2:delete varName="Id_prod">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7a81</con1:id>
                    </con2:delete>
                    <con2:delete varName="Id_pcrf_prod">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7a80</con1:id>
                    </con2:delete>
                    <con2:delete varName="msjPortalRespuesta">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7a7f</con1:id>
                    </con2:delete>
                    <con2:delete varName="codPortalRespuesta">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7a7e</con1:id>
                    </con2:delete>
                    <con2:delete varName="msjOut">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7a7d</con1:id>
                    </con2:delete>
                    <con2:delete varName="nextelCustomerInfoReq">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7a7c</con1:id>
                    </con2:delete>
                    <con2:delete varName="nextelCustomerInfoResp">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7a7b</con1:id>
                    </con2:delete>
                    <con2:delete varName="getBolsaIlimitadaXPlanReq">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7a7a</con1:id>
                    </con2:delete>
                    <con2:delete varName="getBolsaIlimitadaXPlanResp">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7a79</con1:id>
                    </con2:delete>
                    <con2:delete varName="NextelActiveProductReq">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7a78</con1:id>
                    </con2:delete>
                    <con2:delete varName="NextelActiveProductResp">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7a77</con1:id>
                    </con2:delete>
                    <con2:delete varName="InfoMensajeReq">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7a76</con1:id>
                    </con2:delete>
                    <con2:delete varName="InfoMensajeResp">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7a75</con1:id>
                    </con2:delete>
                    <con1:reply isError="false">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7a73</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-1125534872727065929-5944a1b0.15f2650c606.-7413">
            <con:stage name="manejarError">
                <con:context/>
                <con:actions>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-739f</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
   <segmento></segmento>
   <errorCode>{$fault/ctx:errorCode/text()}</errorCode>
   <errorDescription>{concat('stage: ',$fault/ctx:location/ctx:stage/text(),', Error: ', $fault/ctx:reason/text())}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-739e</con1:id>
                        <con4:logLevel>error</con4:logLevel>
                        <con4:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con4:expr>
                        <con4:message>-----|||Response PSUSSDOperaciones|||-----</con4:message>
                    </con4:log>
                    <con2:delete varName="iDPlan">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7f5b</con1:id>
                    </con2:delete>
                    <con2:delete varName="Id_prod">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7f3e</con1:id>
                    </con2:delete>
                    <con2:delete varName="Id_pcrf_prod">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7f21</con1:id>
                    </con2:delete>
                    <con2:delete varName="msjPortalRespuesta">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7e98</con1:id>
                    </con2:delete>
                    <con2:delete varName="codPortalRespuesta">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7e7b</con1:id>
                    </con2:delete>
                    <con2:delete varName="nextelCustomerInfoReq">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7ddf</con1:id>
                    </con2:delete>
                    <con2:delete varName="nextelCustomerInfoResp">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7dc2</con1:id>
                    </con2:delete>
                    <con2:delete varName="getBolsaIlimitadaXPlanReq">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7da5</con1:id>
                    </con2:delete>
                    <con2:delete varName="getBolsaIlimitadaXPlanResp">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7d88</con1:id>
                    </con2:delete>
                    <con2:delete varName="NextelActiveProductReq">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7d6b</con1:id>
                    </con2:delete>
                    <con2:delete varName="NextelActiveProductResp">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7d33</con1:id>
                    </con2:delete>
                    <con1:reply isError="false" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-739d</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-1125534872727065929-5944a1b0.15f2650c606.-7412">
            <con:stage name="manejarError">
                <con:context/>
                <con:actions>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-732a</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<ns0:ussdOperacionResponse xmlns:ns0="http://ussd.operaciones.wom.ws.ncl.com">
   <segmento></segmento>
   <errorCode>{$fault/ctx:errorCode/text()}</errorCode>
   <errorDescription>{concat('stage: ',$fault/ctx:location/ctx:stage/text(),', Error: ', $fault/ctx:reason/text())}</errorDescription>
</ns0:ussdOperacionResponse>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7329</con1:id>
                        <con4:logLevel>error</con4:logLevel>
                        <con4:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con4:expr>
                        <con4:message>-----|||Response PSUSSDOperaciones|||-----</con4:message>
                    </con4:log>
                    <con2:delete varName="iDPlan">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7e55</con1:id>
                    </con2:delete>
                    <con2:delete varName="Id_prod">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7e54</con1:id>
                    </con2:delete>
                    <con2:delete varName="Id_pcrf_prod">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7e53</con1:id>
                    </con2:delete>
                    <con2:delete varName="msjPortalRespuesta">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7e52</con1:id>
                    </con2:delete>
                    <con2:delete varName="codPortalRespuesta">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7e51</con1:id>
                    </con2:delete>
                    <con2:delete varName="msjOut">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7e34</con1:id>
                    </con2:delete>
                    <con2:delete varName="nextelCustomerInfoReq">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7d03</con1:id>
                    </con2:delete>
                    <con2:delete varName="nextelCustomerInfoResp">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7d02</con1:id>
                    </con2:delete>
                    <con2:delete varName="getBolsaIlimitadaXPlanReq">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7d01</con1:id>
                    </con2:delete>
                    <con2:delete varName="getBolsaIlimitadaXPlanResp">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7d00</con1:id>
                    </con2:delete>
                    <con2:delete varName="NextelActiveProductReq">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7cff</con1:id>
                    </con2:delete>
                    <con2:delete varName="NextelActiveProductResp">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7cfe</con1:id>
                    </con2:delete>
                    <con2:delete varName="InfoMensajeReq">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7ce1</con1:id>
                    </con2:delete>
                    <con2:delete varName="InfoMensajeResp">
                        <con1:id>_ActionId-4386260187504852157-72a92cb7.15f589ca829.-7cc4</con1:id>
                    </con2:delete>
                    <con1:reply isError="false" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
                        <con1:id>_ActionId-1125534872727065929-5944a1b0.15f2650c606.-7328</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="request" name="PipelineSetCompraBolsaRoaming_request" errorHandler="_onErrorHandler-1019642516480440373--b5a5c2d.167a28775f4.-7c71">
            <con:stage name="stageValidaBolsaCliente" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config">
                <con:context>
                    <con1:userNsDecl namespace="http://ws.wom.cl/WOM/NEG/ProductCatalog/purchaseValidation/v/2.0" prefix="ns1"/>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con2:wsCallout>
                        <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c7e</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="GestorUSSD/Business Services/BSGetPurchaseValidation" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>purchaseValidation</con2:operation>
                        <con2:request>
                            <con2:body wrapped="false">requestPurchaseValidationData</con2:body>
                        </con2:request>
                        <con2:response>
                            <con2:body wrapped="false">responsePurchaseData</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                            <con2:replace varName="requestPurchaseValidationData" contents-only="false">
                                <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c83</con1:id>
                                <con2:expr>
                                    <con1:xqueryTransform>
                                        <con1:resource ref="GestorUSSD/Resources/XQuery/IN_XQ_getValidationPurch"/>
                                        <con1:param name="nroCelular">
                                            <con1:path>$body/ussd:ussdOperacion/nroCelular/text()</con1:path>
                                        </con1:param>
                                        <con1:param name="idProd">
                                            <con1:path>$body/ussd:ussdOperacion/idProd/text()</con1:path>
                                        </con1:param>
                                    </con1:xqueryTransform>
                                </con2:expr>
                            </con2:replace>
                        </con2:requestTransform>
                        <con2:responseTransform>
                            <con2:assign varName="statusCode">
                                <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c82</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>$responsePurchaseData/ns1:status/text()</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:assign varName="description">
                                <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c81</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>$responsePurchaseData/ns1:description/text()</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:ifThenElse>
                                <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c80</con1:id>
                                <con2:case>
                                    <con2:condition>
                                        <con1:xqueryText>empty($statusCode) or $statusCode != '00'</con1:xqueryText>
                                    </con2:condition>
                                    <con2:actions>
                                        <con2:Error>
                                            <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c7f</con1:id>
                                            <con2:errCode>01</con2:errCode>
                                        </con2:Error>
                                    </con2:actions>
                                </con2:case>
                                <con2:default/>
                            </con2:ifThenElse>
                        </con2:responseTransform>
                    </con2:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage name="stageProvisionaBolsa" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config">
                <con:context>
                    <con1:userNsDecl namespace="http://ws.wom.cl/WOM/NEG/ServiceOrderManagement/bundleProvisioning/v/1.0" prefix="ns2"/>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con2:wsCallout>
                        <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c78</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="GestorUSSD/Business Services/BSGetBundleProvisioning" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>bundleProvisioning</con2:operation>
                        <con2:request>
                            <con2:body>requestBundleProvisioning</con2:body>
                        </con2:request>
                        <con2:response>
                            <con2:body>responseBundleProvisioning</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                            <con2:replace varName="requestBundleProvisioning">
                                <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c7d</con1:id>
                                <con2:expr>
                                    <con1:xqueryTransform>
                                        <con1:resource ref="GestorUSSD/Resources/XQuery/IN_XQ_GetBundleProvisioning"/>
                                        <con1:param name="ussdOperacion1">
                                            <con1:path>$body/ussd:ussdOperacion</con1:path>
                                        </con1:param>
                                    </con1:xqueryTransform>
                                </con2:expr>
                            </con2:replace>
                        </con2:requestTransform>
                        <con2:responseTransform>
                            <con2:assign varName="statusCode">
                                <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c7c</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>$responseBundleProvisioning/ns2:status/text()</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:assign varName="description">
                                <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c7b</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>$responseBundleProvisioning/ns2:description/text()</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:ifThenElse>
                                <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c7a</con1:id>
                                <con2:case>
                                    <con2:condition>
                                        <con1:xqueryText>empty($statusCode) or $statusCode != '00'</con1:xqueryText>
                                    </con2:condition>
                                    <con2:actions>
                                        <con2:Error>
                                            <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c79</con1:id>
                                            <con2:errCode>02</con2:errCode>
                                        </con2:Error>
                                    </con2:actions>
                                </con2:case>
                                <con2:default/>
                            </con2:ifThenElse>
                        </con2:responseTransform>
                    </con2:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage name="stageCobraBolsa" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config">
                <con:context>
                    <con1:userNsDecl namespace="http://ws.wom.cl/WOM/NEG/PaymentManagement/bundlePurchasePayment/v/1.0" prefix="ns3"/>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con2:wsCallout>
                        <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c72</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="GestorUSSD/Business Services/BSGetBundlePurchasePayment" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>bundlePurchasePayment</con2:operation>
                        <con2:request>
                            <con2:body>requestBundlePurchasePayment</con2:body>
                        </con2:request>
                        <con2:response>
                            <con2:body>responseBundlePurchasePayment</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                            <con2:replace varName="requestBundlePurchasePayment">
                                <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c77</con1:id>
                                <con2:expr>
                                    <con1:xqueryTransform>
                                        <con1:resource ref="GestorUSSD/Resources/XQuery/IN_XQ_GetBundlePurchasePayment"/>
                                        <con1:param name="ussdOperacion1">
                                            <con1:path>$body/ussd:ussdOperacion</con1:path>
                                        </con1:param>
                                    </con1:xqueryTransform>
                                </con2:expr>
                            </con2:replace>
                        </con2:requestTransform>
                        <con2:responseTransform>
                            <con2:assign varName="statusCode">
                                <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c76</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>$responseBundlePurchasePayment/ns3:status/text()</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:assign varName="description">
                                <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c75</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>$responseBundlePurchasePayment/ns3:description/text()</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:ifThenElse>
                                <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c74</con1:id>
                                <con2:case>
                                    <con2:condition>
                                        <con1:xqueryText>empty($statusCode) or $statusCode != '00'</con1:xqueryText>
                                    </con2:condition>
                                    <con2:actions>
                                        <con2:Error>
                                            <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c73</con1:id>
                                            <con2:errCode>03</con2:errCode>
                                        </con2:Error>
                                    </con2:actions>
                                </con2:case>
                                <con2:default/>
                            </con2:ifThenElse>
                        </con2:responseTransform>
                    </con2:wsCallout>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="PipelineSetCompraBolsaRoaming_response">
            <con:stage name="stageRespuestaOk" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config">
                <con:context>
                    <con1:varNsDecl namespace="http://ussd.operaciones.wom.ws.ncl.com" prefix="ussd"/>
                </con:context>
                <con:actions>
                    <con2:replace varName="body" contents-only="true">
                        <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c60</con1:id>
                        <con2:expr>
                            <con1:xqueryTransform>
                                <con1:resource ref="GestorUSSD/Resources/XQuery/OUT_XQ_RoamingExitoResponse"/>
                                <con1:param name="status">
                                    <con1:path>$statusCode</con1:path>
                                </con1:param>
                                <con1:param name="description">
                                    <con1:path>$description</con1:path>
                                </con1:param>
                            </con1:xqueryTransform>
                        </con2:expr>
                    </con2:replace>
                    <con2:delete varName="requestPurchaseValidationData">
                        <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c5f</con1:id>
                    </con2:delete>
                    <con2:delete varName="responsePurchaseData">
                        <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c5e</con1:id>
                    </con2:delete>
                    <con2:delete varName="requestBundleProvisioning">
                        <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c5d</con1:id>
                    </con2:delete>
                    <con2:delete varName="responseBundleProvisioning">
                        <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c5c</con1:id>
                    </con2:delete>
                    <con2:delete varName="requestBundlePurchasePayment">
                        <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c5b</con1:id>
                    </con2:delete>
                    <con2:delete varName="responseBundlePurchasePayment">
                        <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c5a</con1:id>
                    </con2:delete>
                    <con2:delete varName="statusCode">
                        <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c59</con1:id>
                    </con2:delete>
                    <con2:delete varName="description">
                        <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c58</con1:id>
                    </con2:delete>
                    <con1:reply>
                        <con1:id>_ActionId-1974116152548819101-18787888.1681562d790.-7fa6</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-1019642516480440373--b5a5c2d.167a28775f4.-7c71">
            <con:stage name="stageErrorHandlerRoamingInter" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config">
                <con:context>
                    <con1:userNsDecl namespace="http://ws.wom.cl/WOM/NEG/ProductCatalog/purchaseValidation/v/2.0" prefix="ns1"/>
                </con:context>
                <con:actions>
                    <con2:ifThenElse>
                        <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c70</con1:id>
                        <con2:case>
                            <con2:condition>
                                <con1:xqueryText>empty($statusCode)</con1:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:assign varName="statusCode">
                                    <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c6f</con1:id>
                                    <con2:expr>
                                        <con1:xqueryText>$fault/ctx:errorCode/text()</con1:xqueryText>
                                    </con2:expr>
                                </con2:assign>
                                <con2:assign varName="description">
                                    <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c6e</con1:id>
                                    <con2:expr>
                                        <con1:xqueryText>concat('stage: ',$fault/ctx:location/ctx:stage/text(),', Error: ', $fault/ctx:reason/text())</con1:xqueryText>
                                    </con2:expr>
                                </con2:assign>
                            </con2:actions>
                        </con2:case>
                        <con2:case>
                            <con2:condition>
                                <con1:xqueryText>$statusCode = '04'</con1:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:assign varName="description">
                                    <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c6d</con1:id>
                                    <con2:expr>
                                        <con1:xqueryText>'Tu servicio de Roaming no está activado, recuerda hacerlo escribiendo al whatsapp +56935120838'</con1:xqueryText>
                                    </con2:expr>
                                </con2:assign>
                            </con2:actions>
                        </con2:case>
                        <con2:case>
                            <con2:condition>
                                <con1:xqueryText>$statusCode = '05'</con1:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:assign varName="description">
                                    <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c6c</con1:id>
                                    <con2:expr>
                                        <con1:xqueryText>'Buu :(, Tu saldo es insuficiente para realizar la compra.'</con1:xqueryText>
                                    </con2:expr>
                                </con2:assign>
                            </con2:actions>
                        </con2:case>
                        <con2:case>
                            <con2:condition>
                                <con1:xqueryText>$statusCode = '07'</con1:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:assign varName="description">
                                    <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c6b</con1:id>
                                    <con2:expr>
                                        <con1:xqueryText>'Cliente No puede comprar producto, existe producto'</con1:xqueryText>
                                    </con2:expr>
                                </con2:assign>
                            </con2:actions>
                        </con2:case>
                        <con2:default/>
                    </con2:ifThenElse>
                    <con2:replace varName="body" contents-only="true">
                        <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c6a</con1:id>
                        <con2:expr>
                            <con1:xqueryTransform>
                                <con1:resource ref="GestorUSSD/Resources/XQuery/OUT_XQ_faultResponseRoaming"/>
                                <con1:param name="faultstring">
                                    <con1:path>'300'</con1:path>
                                </con1:param>
                                <con1:param name="faultcode">
                                    <con1:path>$description</con1:path>
                                </con1:param>
                            </con1:xqueryTransform>
                        </con2:expr>
                    </con2:replace>
                    <con3:log>
                        <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c69</con1:id>
                        <con3:logLevel>debug</con3:logLevel>
                        <con3:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con3:expr>
                        <con3:message>-----|||Request setCompraBolsaRoaming|||-----</con3:message>
                    </con3:log>
                    <con2:delete varName="requestPurchaseData">
                        <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c68</con1:id>
                    </con2:delete>
                    <con2:delete varName="responsePurchaseData">
                        <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c67</con1:id>
                    </con2:delete>
                    <con2:delete varName="requestBundleProvisioning">
                        <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c66</con1:id>
                    </con2:delete>
                    <con2:delete varName="responseBundleProvisioning">
                        <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c65</con1:id>
                    </con2:delete>
                    <con2:delete varName="requestBundlePurchasePayment">
                        <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c64</con1:id>
                    </con2:delete>
                    <con2:delete varName="responseBundlePurchasePayment">
                        <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c63</con1:id>
                    </con2:delete>
                    <con2:delete varName="statusCode">
                        <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c62</con1:id>
                    </con2:delete>
                    <con2:delete varName="description">
                        <con1:id>_ActionId-1019642516480440373--b5a5c2d.167a28775f4.-7c61</con1:id>
                    </con2:delete>
                    <con1:reply>
                        <con1:id>_ActionId-1974116152548819101-18787888.1681562d790.-7f7a</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:flow>
            <con:pipeline-node name="PipelineUSSDOperaciones">
                <con:request>PipelineUSSDOperaciones_request</con:request>
                <con:response>PipelineUSSDOperaciones_response</con:response>
            </con:pipeline-node>
            <con:branch-node type="condition" name="BranchEventoOperacion">
                <con:context/>
                <con:branch-table variable="EventoOperacion">
                    <con:branch name="getSegmento">
                        <con:operator>equals</con:operator>
                        <con:value>'0'</con:value>
                        <con:flow>
                            <con:pipeline-node name="PipelinePairSegmento">
                                <con:request>PipelinePairSegmento_request</con:request>
                                <con:response>PipelinePairSegmento_response</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:branch name="setCompraBolsas">
                        <con:operator>equals</con:operator>
                        <con:value>'1'</con:value>
                        <con:flow>
                            <con:pipeline-node name="PipelinePairCompraBolsas">
                                <con:request>PipelinePairCompraBolsas_request</con:request>
                                <con:response>PipelinePairCompraBolsas_response</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:branch name="getConsultaSaldo">
                        <con:operator>equals</con:operator>
                        <con:value>'2'</con:value>
                        <con:flow>
                            <con:pipeline-node name="PipelineConsultaSaldo">
                                <con:request>PipelineConsultaSaldo_request</con:request>
                                <con:response>PipelineConsultaSaldo_response</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:branch name="getMsjPromocion">
                        <con:operator>equals</con:operator>
                        <con:value>'3'</con:value>
                        <con:flow>
                            <con:pipeline-node name="PipelineMsjPromocion">
                                <con:request>PipelineMsjPromocion_request</con:request>
                                <con:response>PipelineMsjPromocion_response</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:branch name="getMsjRecarga">
                        <con:operator>equals</con:operator>
                        <con:value>'4'</con:value>
                        <con:flow>
                            <con:pipeline-node name="PipelineMsjRecarga">
                                <con:comment/>
                                <con:request>PipelineMsjRecarga_request</con:request>
                                <con:response>PipelineMsjRecarga_response</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:branch name="getMsjTarifa">
                        <con:operator>equals</con:operator>
                        <con:value>'5'</con:value>
                        <con:flow>
                            <con:pipeline-node name="PipelineMsjTarifa">
                                <con:request>PipelineMsjTarifa_request</con:request>
                                <con:response>PipelineMsjTarifa_response</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:branch name="getMsjDeudaVencida">
                        <con:operator>equals</con:operator>
                        <con:value>'6'</con:value>
                        <con:flow>
                            <con:pipeline-node name="PipelineGetMsjDeudaVencida">
                                <con:request>PipelineGetMsjDeudaVencida_request</con:request>
                                <con:response>PipelineGetMsjDeudaVencida_response</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:branch name="getMsjCicloFacturacion">
                        <con:operator>equals</con:operator>
                        <con:value>'7'</con:value>
                        <con:flow>
                            <con:pipeline-node name="PipelineCicloFacturacion">
                                <con:request>PipelineCicloFacturacion_request</con:request>
                                <con:response>PipelineCicloFacturacion_response</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:branch name="getCreditoEmergencia">
                        <con:operator>equals</con:operator>
                        <con:value>'8'</con:value>
                        <con:flow>
                            <con:pipeline-node name="PipelineCreditoEmergencia">
                                <con:request>PipelineCreditoEmergencia_request</con:request>
                                <con:response>PipelineCreditoEmergencia_response</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:branch name="setCompraBolsasMahindra">
                        <con:operator>equals</con:operator>
                        <con:value>'9'</con:value>
                        <con:flow>
                            <con:pipeline-node name="PipelinePairCompraBolsasMahindra">
                                <con:request>PipelinePairCompraBolsasMahindra_request</con:request>
                                <con:response>PipelinePairCompraBolsasMahindra_response</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:branch name="GetOfferUSSD">
                        <con:operator>equals</con:operator>
                        <con:value>'10'</con:value>
                        <con:flow>
                            <con:pipeline-node name="PipelineGetOffersMahindra">
                                <con:request>PipelineGetOffersMahindra_request</con:request>
                                <con:response>PipelineGetOffersMahindra_response</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:branch name="getConsultaSaldoTematico">
                        <con:operator>equals</con:operator>
                        <con:value>'11'</con:value>
                        <con:flow>
                            <con:pipeline-node name="PipelinePairNode1">
                                <con:request>PipelinePairNode1_request</con:request>
                                <con:response>PipelinePairNode1_response</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:branch name="setCompraBolsaIlimitadaXPlan">
                        <con:operator>equals</con:operator>
                        <con:value>12</con:value>
                        <con:flow>
                            <con:pipeline-node name="PipelineCompraBolsaIlimitaXPlan">
                                <con:request>PipelineCompraBolsaIlimitaXPlan_request</con:request>
                                <con:response>PipelineCompraBolsaIlimitaXPlan_response</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:branch name="setCompraBolsaRoamingInter">
                        <con:operator>equals</con:operator>
                        <con:value>'13'</con:value>
                        <con:flow>
                            <con:pipeline-node name="PipelineSetCompraBolsaRoaming">
                                <con:request>PipelineSetCompraBolsaRoaming_request</con:request>
                                <con:response>PipelineSetCompraBolsaRoaming_response</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:default-branch>
                        <con:flow>
                            <con:pipeline-node name="PipelinePairDefault">
                                <con:request>PipelinePairDefault_request</con:request>
                                <con:response>PipelinePairDefault_response</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:default-branch>
                </con:branch-table>
            </con:branch-node>
        </con:flow>
    </con:router>
</con:pipelineEntry>