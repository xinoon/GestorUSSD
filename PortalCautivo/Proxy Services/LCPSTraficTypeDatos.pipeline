<?xml version="1.0" encoding="UTF-8"?>
<con:pipelineEntry xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations">
    <con:coreEntry>
        <con:binding type="SOAP" isSoap12="false" xsi:type="con:SoapBindingType">
            <con5:wsdl ref="PortalCautivo/Resources/WSDLs/TraficTypePortal" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con="http://www.bea.com/wli/sb/services/bindings/config" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con5="http://www.bea.com/wli/sb/pipeline/config"/>
            <con:binding>
                <con:name>CaptivePortalPortBinding</con:name>
                <con:namespace>http://captive.portal.ws.ncl.nii.com</con:namespace>
            </con:binding>
        </con:binding>
        <oper:operations>
            <oper:monitoring enabled="false" aggregationInterval="10" level="pipeline"/>
            <oper:tracingEnabled>false</oper:tracingEnabled>
            <oper:reporting>true</oper:reporting>
            <oper:logging enabled="true" level="error"/>
            <oper:sla-alerting enabled="true" level="normal"/>
            <oper:pipeline-alerting enabled="true" level="normal"/>
        </oper:operations>
    </con:coreEntry>
    <con:router xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
        <con:pipeline type="request" name="PipelinePairNode1_request" errorHandler="_onErrorHandler-4952591388299401645-3a5ea217.13faf2b6b35.-795a">
            <con:stage name="in_get_DateSum">
                <con:context>
                    <con1:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/DateSumVigenciaDba" prefix="dat"/>
                    <con1:varNsDecl namespace="http://captive.portal.ws.ncl.nii.com" prefix="cap"/>
                </con:context>
                <con:actions>
                    <con2:wsCallout>
                        <con1:id>_ActionId-3547702909104240946--7a217c5c.140bdb833f7.-7ae6</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="PortalCautivo/Business Services/BSDateSumVigenciaDba" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>DateSumVigenciaDba</con2:operation>
                        <con2:request>
                            <con2:body>DateSumVigencia</con2:body>
                        </con2:request>
                        <con2:response>
                            <con2:body>DateSumVigenciaReponse</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                            <con2:assign varName="DateSumVigencia">
                                <con1:id>_ActionId-3547702909104240946--7a217c5c.140bdb833f7.-7aeb</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>&lt;dat:DateSumVigenciaDbaInput xmlns:dat="http://xmlns.oracle.com/pcbpel/adapter/db/DateSumVigenciaDba">
    &lt;dat:MinVig>{data($body/cap:setNextelActiveProduct/vigencia)}&lt;/dat:MinVig>
&lt;/dat:DateSumVigenciaDbaInput></con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                        </con2:requestTransform>
                        <con2:responseTransform>
                            <con2:assign varName="DateSumVigReponse">
                                <con1:id>_ActionId-3547702909104240946--7a217c5c.140bdb833f7.-7aea</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>$DateSumVigenciaReponse</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:assign varName="ActualDate">
                                <con1:id>_ActionId-5630945374779210100--3f5f8582.1490fc1456e.-7eaa</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>data($DateSumVigReponse/dat:DateSumVigenciaDbaOutput/dat:actualDate)</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:assign varName="TotalDate">
                                <con1:id>_ActionId-3547702909104240946--7a217c5c.140bdb833f7.-7ae9</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>data($DateSumVigReponse/dat:DateSumVigenciaDbaOutput/dat:totalDate)</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:assign varName="LCActualFecha">
                                <con1:id>_ActionId-5630945374779210100--3f5f8582.1490fc1456e.-7e37</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>fn:substring(xs:string($ActualDate),0,fn:string-length(xs:string($ActualDate))-18)</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:assign varName="LCActualHora">
                                <con1:id>_ActionId-5630945374779210100--3f5f8582.1490fc1456e.-7e36</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>fn:substring(xs:string($ActualDate),12,8)</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:assign varName="LCHora">
                                <con1:id>_ActionId-3547702909104240946--7a217c5c.140bdb833f7.-7ae8</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>fn:substring(xs:string($TotalDate),12,8)</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:assign varName="LCFecha">
                                <con1:id>_ActionId-3547702909104240946--7a217c5c.140bdb833f7.-7ae7</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>fn:substring(xs:string($TotalDate),0,fn:string-length(xs:string($TotalDate))-18)</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:assign varName="EndDateTime">
                                <con1:id>_ActionId-3547702909104240946--7a217c5c.140bdb833f7.-7aae</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>fn:concat(fn-bea:date-to-string-with-format("yyyyMMdd",xs:date($LCFecha)),"",fn-bea:time-to-string-with-format("HHmmss",xs:time($LCHora)))</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:assign varName="StartDateTime">
                                <con1:id>_ActionId-5630945374779210100--3f5f8582.1490fc1456e.-7de2</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>fn:concat(fn-bea:date-to-string-with-format("yyyyMMdd",xs:date($LCActualFecha)),"",fn-bea:time-to-string-with-format("HHmmss",xs:time($LCActualHora)))</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:assign varName="fechaOCC">
                                <con1:id>_ActionId-6540090790333812719-254c95c7.14f21fffaa1.-7fe3</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>$ActualDate</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                        </con2:responseTransform>
                    </con2:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage name="In_stg_DATOS">
                <con:context>
                    <con1:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/PROVI_BOLS/NII_BSCS_PORTAL_CAUTIVO_PKG/REGISTRA_ALTA_PRODUCTOS_PRC/" prefix="al"/>
                    <con1:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/ValidaTransacBonific" prefix="val"/>
                    <con1:userNsDecl namespace="http://ws.nextel.cl/schemas/searchBalanceIcc/alcatel/getAllInformation" prefix="get"/>
                    <con1:varNsDecl namespace="http://captive.portal.ws.ncl.nii.com" prefix="cap"/>
                </con:context>
                <con:actions>
                    <con2:ifThenElse>
                        <con1:id>_ActionId-4615884836252970773-52a9e39f.13fa01bf89b.-7b5a</con1:id>
                        <con2:case>
                            <con2:condition>
                                <con1:xqueryConditionExpr>
                                    <con1:compExpr operator="=">
                                        <con1:leftPath>data($body/cap:setNextelActiveProduct/traffic_type)</con1:leftPath>
                                        <con1:rightPath>'DATOS'</con1:rightPath>
                                    </con1:compExpr>
                                </con1:xqueryConditionExpr>
                            </con2:condition>
                            <con2:actions>
                                <con2:ifThenElse>
                                    <con1:id>_ActionId-3602376958848697374--7242e8b0.15d08bfc312.-7d5b</con1:id>
                                    <con2:case>
                                        <con2:condition>
                                            <con1:xqueryText>fn:upper-case(data($body/cap:setNextelActiveProduct/segment_prod)) = 'POSTPAID'</con1:xqueryText>
                                        </con2:condition>
                                        <con2:actions>
                                            <con2:ifThenElse>
                                                <con1:id>_ActionId-3602376958848697374--7242e8b0.15d08bfc312.-7cae</con1:id>
                                                <con2:case>
                                                    <con2:condition>
                                                        <con1:xqueryConditionExpr>
                                                            <con1:compExpr operator="=">
                                                                <con1:leftPath>data($body/cap:setNextelActiveProduct/metodo_pago)</con1:leftPath>
                                                                <con1:rightPath>'CONTRA_FACTURA'</con1:rightPath>
                                                            </con1:compExpr>
                                                        </con1:xqueryConditionExpr>
                                                    </con2:condition>
                                                    <con2:actions>
                                                        <con2:ifThenElse>
                                                            <con1:id>_ActionId-3602376958848697374--7242e8b0.15d08bfc312.-751a</con1:id>
                                                            <con2:case>
                                                                <con2:condition>
                                                                    <con1:xqueryConditionExpr>
                                                                        <con1:compExpr operator="=">
                                                                            <con1:leftPath>data($body/cap:setNextelActiveProduct/pago_aplicado)</con1:leftPath>
                                                                            <con1:rightPath>'N'</con1:rightPath>
                                                                        </con1:compExpr>
                                                                    </con1:xqueryConditionExpr>
                                                                </con2:condition>
                                                                <con2:actions>
                                                                    <con2:ifThenElse>
                                                                        <con1:id>_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7e32</con1:id>
                                                                        <con2:case>
                                                                            <con2:condition>
                                                                                <con1:xqueryText>$body/cap:setNextelActiveProduct/tecnologia/text() = 'TEM'</con1:xqueryText>
                                                                            </con2:condition>
                                                                            <con2:actions>
                                                                                <con2:wsCallout>
                                                                                    <con1:id>_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7e25</con1:id>
                                                                                    <con2:service xsi:type="ref:ProxyRef" ref="PCRF/Proxy Services/PSPcrfService" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                                    <con2:operation>getSubscriberAllInf</con2:operation>
                                                                                    <con2:request>
                                                                                        <con2:param>
                                                                                            <con2:name>inPara</con2:name>
                                                                                            <con2:variable>getSubscriberAllInf</con2:variable>
                                                                                        </con2:param>
                                                                                    </con2:request>
                                                                                    <con2:response>
                                                                                        <con2:param>
                                                                                            <con2:name>result</con2:name>
                                                                                            <con2:variable>getSubscriberAllInfResp</con2:variable>
                                                                                        </con2:param>
                                                                                    </con2:response>
                                                                                    <con2:requestTransform>
                                                                                        <con2:assign varName="getSubscriberAllInf">
                                                                                            <con1:id>_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7e2b</con1:id>
                                                                                            <con2:expr>
                                                                                                <con1:xqueryText><![CDATA[<inPara>
    <subscriber>
        <!--1 or more repetitions:-->
        <attribute>
            <key>USRIDENTIFIER</key>
            <value>{$body/cap:setNextelActiveProduct/lc_imsi/text()}</value>
        </attribute>
    </subscriber>
</inPara>]]></con1:xqueryText>
                                                                                            </con2:expr>
                                                                                        </con2:assign>
                                                                                    </con2:requestTransform>
                                                                                    <con2:responseTransform>
                                                                                        <con2:assign varName="SubscriberAllInfResp">
                                                                                            <con1:id>_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7e2a</con1:id>
                                                                                            <con2:expr>
                                                                                                <con1:xqueryText>$getSubscriberAllInfResp</con1:xqueryText>
                                                                                            </con2:expr>
                                                                                        </con2:assign>
                                                                                        <con2:assign varName="validExistPcrfvalue">
                                                                                            <con1:id>_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7e29</con1:id>
                                                                                            <con2:expr>
                                                                                                <con1:xqueryText>fn:count($SubscriberAllInfResp/subscribedService/attribute[value = $body/cap:setNextelActiveProduct/id_pcrf_prod/text()])</con1:xqueryText>
                                                                                            </con2:expr>
                                                                                        </con2:assign>
                                                                                        <con2:ifThenElse>
                                                                                            <con1:id>_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7e28</con1:id>
                                                                                            <con2:case>
                                                                                                <con2:condition>
                                                                                                    <con1:xqueryText>$SubscriberAllInfResp/resultCode/text() != '0'</con1:xqueryText>
                                                                                                </con2:condition>
                                                                                                <con2:actions>
                                                                                                    <con2:replace varName="body" contents-only="true">
                                                                                                        <con1:id>_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7e27</con1:id>
                                                                                                        <con2:expr>
                                                                                                            <con1:xqueryText><![CDATA[<cap:setNextelActiveProductResponse xmlns:cap="http://captive.portal.ws.ncl.nii.com">
 <error_code>{$SubscriberAllInfResp/resultCode/text()}</error_code>
 <err_description>{fn:concat('Error al obtener informaci√≥n PCRF, Key: ',data($SubscriberAllInfResp/paras/key),' - Value: ' ,data($SubscriberAllInfResp/paras/value))}</err_description>
</cap:setNextelActiveProductResponse>]]></con1:xqueryText>
                                                                                                        </con2:expr>
                                                                                                    </con2:replace>
                                                                                                    <con1:reply isError="false">
                                                                                                        <con1:id>_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7e26</con1:id>
                                                                                                    </con1:reply>
                                                                                                </con2:actions>
                                                                                            </con2:case>
                                                                                            <con2:default/>
                                                                                        </con2:ifThenElse>
                                                                                    </con2:responseTransform>
                                                                                </con2:wsCallout>
                                                                                <con1:ifThenElse xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                                                                    <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7e24</con5:id>
                                                                                    <con1:case>
                                                                                        <con1:condition>
                                                                                            <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">xs:string($validExistPcrfvalue) = '0'</con5:xqueryText>
                                                                                        </con1:condition>
                                                                                        <con1:actions>
                                                                                            <con1:wsCallout>
                                                                                                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7e1e</con5:id>
                                                                                                <con1:service xsi:type="ref:ProxyRef" ref="PCRF/Proxy Services/PSPcrfService" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                                                <con1:operation>subscribeService</con1:operation>
                                                                                                <con1:request>
                                                                                                    <con1:param>
                                                                                                        <con1:name>inPara</con1:name>
                                                                                                        <con1:variable>subscribeServiceReq</con1:variable>
                                                                                                    </con1:param>
                                                                                                </con1:request>
                                                                                                <con1:response>
                                                                                                    <con1:param>
                                                                                                        <con1:name>result</con1:name>
                                                                                                        <con1:variable>subscribeServiceResponse</con1:variable>
                                                                                                    </con1:param>
                                                                                                </con1:response>
                                                                                                <con1:requestTransform>
                                                                                                    <con1:assign varName="subscribeServiceReq">
                                                                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7e23</con5:id>
                                                                                                        <con1:expr>
                                                                                                            <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config"><![CDATA[<inPara>
	<subscriber>
	   <!--1 or more repetitions:-->
	   <attribute>
		  <key>USRIDENTIFIER</key>
		  <value>{data($body/cap:setNextelActiveProduct/lc_imsi)}</value>
	   </attribute>
	</subscriber>
	<!--Zero or more repetitions:-->
	<subscribedService>
	   <!--1 or more repetitions:-->
	   <attribute>
		  <key>SRVNAME</key>
		  <value>{data($body/cap:setNextelActiveProduct/id_pcrf_prod)}</value>
	   </attribute>
	   <attribute>
		  <key>srvStartDateTime</key>
		  <value>{$StartDateTime}</value>
	   </attribute>
	   <attribute>
		  <key>srvEndDateTime</key>
		  <value>{$EndDateTime}</value>
	   </attribute>
	</subscribedService>
 </inPara>]]></con4:xqueryText>
                                                                                                        </con1:expr>
                                                                                                    </con1:assign>
                                                                                                </con1:requestTransform>
                                                                                                <con1:responseTransform>
                                                                                                    <con1:assign varName="subscribeServResp">
                                                                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7e22</con5:id>
                                                                                                        <con1:expr>
                                                                                                            <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$subscribeServiceResponse</con4:xqueryText>
                                                                                                        </con1:expr>
                                                                                                    </con1:assign>
                                                                                                    <con1:ifThenElse>
                                                                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7e21</con5:id>
                                                                                                        <con1:case>
                                                                                                            <con1:condition>
                                                                                                                <con4:xqueryConditionExpr xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                                                                    <con4:compExpr operator="!=">
                                                                                                                        <con4:leftPath>data($subscribeServResp/resultCode)</con4:leftPath>
                                                                                                                        <con4:rightPath>'0'</con4:rightPath>
                                                                                                                    </con4:compExpr>
                                                                                                                </con4:xqueryConditionExpr>
                                                                                                            </con1:condition>
                                                                                                            <con1:actions>
                                                                                                                <con1:replace varName="body" contents-only="true">
                                                                                                                    <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7e20</con5:id>
                                                                                                                    <con1:expr>
                                                                                                                        <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config"><![CDATA[<cap:setNextelActiveProductResponse xmlns:cap="http://captive.portal.ws.ncl.nii.com">
 <error_code>{data($subscribeServResp/resultCode)}</error_code>
 <err_description>{fn:concat('Key: ',data($subscribeServResp/paras/key),' - Value: ' ,data($subscribeServResp/paras/value))}</err_description>
</cap:setNextelActiveProductResponse>]]></con5:xqueryText>
                                                                                                                    </con1:expr>
                                                                                                                </con1:replace>
                                                                                                                <con4:reply isError="false" xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                                                                    <con4:id>_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7e1f</con4:id>
                                                                                                                </con4:reply>
                                                                                                            </con1:actions>
                                                                                                        </con1:case>
                                                                                                        <con1:default/>
                                                                                                    </con1:ifThenElse>
                                                                                                </con1:responseTransform>
                                                                                            </con1:wsCallout>
                                                                                            <con1:wsCallout>
                                                                                                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7cd0</con5:id>
                                                                                                <con1:service ref="PortalCautivo/Proxy Services/LCPSConsultaYCreaOCC" xsi:type="con:PipelineRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                                                <con1:operation>setNextelActiveProduct</con1:operation>
                                                                                                <con1:request>
                                                                                                    <con1:body>consultaCreaOCC</con1:body>
                                                                                                </con1:request>
                                                                                                <con1:response>
                                                                                                    <con1:body>consultaCreaOCCResponse</con1:body>
                                                                                                </con1:response>
                                                                                                <con1:requestTransform>
                                                                                                    <con1:assign varName="consultaCreaOCC">
                                                                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7cd7</con5:id>
                                                                                                        <con1:expr>
                                                                                                            <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config"><![CDATA[<cap:setNextelActiveProduct xmlns:cap="http://captive.portal.ws.ncl.nii.com">
    <lc_customer>{data($body/cap:setNextelActiveProduct/lc_customer)}</lc_customer>
    <tariff_prod>{data($body/cap:setNextelActiveProduct/tariff_prod)}</tariff_prod>
    <traffic_type>{data($body/cap:setNextelActiveProduct/file1)}</traffic_type>
    <sn_code>{data($body/cap:setNextelActiveProduct/id_pcrf_prod)}</sn_code>
    <contractId>{data($body/cap:setNextelActiveProduct/lc_contractId)}</contractId>
	<lc_tmcode>{data($body/cap:setNextelActiveProduct/rate_plan)}</lc_tmcode>
	<fechaActivacion>{$fechaOCC}</fechaActivacion>
</cap:setNextelActiveProduct>]]></con5:xqueryText>
                                                                                                        </con1:expr>
                                                                                                    </con1:assign>
                                                                                                </con1:requestTransform>
                                                                                                <con1:responseTransform>
                                                                                                    <con1:assign varName="consultaCreaOCCResp">
                                                                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7cd6</con5:id>
                                                                                                        <con1:expr>
                                                                                                            <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$consultaCreaOCCResponse</con4:xqueryText>
                                                                                                        </con1:expr>
                                                                                                    </con1:assign>
                                                                                                    <con1:assign varName="LCErrorOCC">
                                                                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7cd5</con5:id>
                                                                                                        <con1:expr>
                                                                                                            <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">data($consultaCreaOCCResp/error_code)</con4:xqueryText>
                                                                                                        </con1:expr>
                                                                                                    </con1:assign>
                                                                                                    <con1:ifThenElse>
                                                                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7cd4</con5:id>
                                                                                                        <con1:case>
                                                                                                            <con1:condition>
                                                                                                                <con4:xqueryConditionExpr xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                                                                    <con4:compExpr operator="!=">
                                                                                                                        <con4:leftPath>$LCErrorOCC</con4:leftPath>
                                                                                                                        <con4:rightPath>'0'</con4:rightPath>
                                                                                                                    </con4:compExpr>
                                                                                                                </con4:xqueryConditionExpr>
                                                                                                            </con1:condition>
                                                                                                            <con1:actions>
                                                                                                                <con1:replace varName="body" contents-only="true">
                                                                                                                    <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7cd2</con5:id>
                                                                                                                    <con1:expr>
                                                                                                                        <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config"><![CDATA[<cap:setNextelActiveProductResponse xmlns:cap="http://captive.portal.ws.ncl.nii.com">
 <error_code>{$LCErrorOCC}</error_code>
 <err_description>{data($consultaCreaOCCResp/err_description)}</err_description>
</cap:setNextelActiveProductResponse>]]></con5:xqueryText>
                                                                                                                    </con1:expr>
                                                                                                                </con1:replace>
                                                                                                                <con4:reply xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                                                                    <con4:id>_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7cd1</con4:id>
                                                                                                                </con4:reply>
                                                                                                            </con1:actions>
                                                                                                        </con1:case>
                                                                                                        <con1:default/>
                                                                                                    </con1:ifThenElse>
                                                                                                </con1:responseTransform>
                                                                                            </con1:wsCallout>
                                                                                        </con1:actions>
                                                                                    </con1:case>
                                                                                    <con1:default>
                                                                                        <con5:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config">
                                                                                            <con1:id>_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7e16</con1:id>
                                                                                            <con5:expr>
                                                                                                <con1:xqueryText><![CDATA[<cap:setNextelActiveProductResponse xmlns:cap="http://captive.portal.ws.ncl.nii.com">
 <error_code>5051</error_code>
 <err_description>Actualmente ya tienes una bolsa activa. Podras comprar otra una vez que esta expire.</err_description>
</cap:setNextelActiveProductResponse>]]></con1:xqueryText>
                                                                                            </con5:expr>
                                                                                        </con5:replace>
                                                                                        <con1:reply isError="false" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                                                                                            <con1:id>_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7e15</con1:id>
                                                                                        </con1:reply>
                                                                                    </con1:default>
                                                                                </con1:ifThenElse>
                                                                            </con2:actions>
                                                                        </con2:case>
                                                                        <con2:default>
                                                                            <con1:wsCallout xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                                                                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7e0e</con5:id>
                                                                                <con1:service xsi:type="ref:ProxyRef" ref="PCRF/Proxy Services/PSPcrfService" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                                <con1:operation>subscribeService</con1:operation>
                                                                                <con1:request>
                                                                                    <con1:param>
                                                                                        <con1:name>inPara</con1:name>
                                                                                        <con1:variable>subscribeServiceReq</con1:variable>
                                                                                    </con1:param>
                                                                                </con1:request>
                                                                                <con1:response>
                                                                                    <con1:param>
                                                                                        <con1:name>result</con1:name>
                                                                                        <con1:variable>subscribeServiceResponse</con1:variable>
                                                                                    </con1:param>
                                                                                </con1:response>
                                                                                <con1:requestTransform>
                                                                                    <con1:assign varName="subscribeServiceReq">
                                                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7e14</con5:id>
                                                                                        <con1:expr>
                                                                                            <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config"><![CDATA[<inPara>
	<subscriber>
	   <!--1 or more repetitions:-->
	   <attribute>
		  <key>USRIDENTIFIER</key>
		  <value>{data($body/cap:setNextelActiveProduct/lc_imsi)}</value>
	   </attribute>
	</subscriber>
	<!--Zero or more repetitions:-->
	<subscribedService>
	   <!--1 or more repetitions:-->
	   <attribute>
		  <key>SRVNAME</key>
		  <value>{data($body/cap:setNextelActiveProduct/id_pcrf_prod)}</value>
	   </attribute>
	   <attribute>
		  <key>srvStartDateTime</key>
		  <value>{$StartDateTime}</value>
	   </attribute>
	   <attribute>
		  <key>srvEndDateTime</key>
		  <value>{$EndDateTime}</value>
	   </attribute>
	</subscribedService>
 </inPara>]]></con4:xqueryText>
                                                                                        </con1:expr>
                                                                                    </con1:assign>
                                                                                </con1:requestTransform>
                                                                                <con1:responseTransform>
                                                                                    <con1:assign varName="subscribeServResp">
                                                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7e13</con5:id>
                                                                                        <con1:expr>
                                                                                            <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$subscribeServiceResponse</con4:xqueryText>
                                                                                        </con1:expr>
                                                                                    </con1:assign>
                                                                                    <con1:ifThenElse>
                                                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7e12</con5:id>
                                                                                        <con1:case>
                                                                                            <con1:condition>
                                                                                                <con4:xqueryConditionExpr xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                                                    <con4:compExpr operator="!=">
                                                                                                        <con4:leftPath>data($subscribeServResp/resultCode)</con4:leftPath>
                                                                                                        <con4:rightPath>'0'</con4:rightPath>
                                                                                                    </con4:compExpr>
                                                                                                </con4:xqueryConditionExpr>
                                                                                            </con1:condition>
                                                                                            <con1:actions>
                                                                                                <con1:replace varName="body" contents-only="true">
                                                                                                    <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7e10</con5:id>
                                                                                                    <con1:expr>
                                                                                                        <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config"><![CDATA[<cap:setNextelActiveProductResponse xmlns:cap="http://captive.portal.ws.ncl.nii.com">
 <error_code>{data($subscribeServResp/resultCode)}</error_code>
 <err_description>{fn:concat('Key: ',data($subscribeServResp/paras/key),' - Value: ' ,data($subscribeServResp/paras/value))}</err_description>
</cap:setNextelActiveProductResponse>]]></con5:xqueryText>
                                                                                                    </con1:expr>
                                                                                                </con1:replace>
                                                                                                <con4:reply xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                                                    <con4:id>_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7e0f</con4:id>
                                                                                                </con4:reply>
                                                                                            </con1:actions>
                                                                                        </con1:case>
                                                                                        <con1:default/>
                                                                                    </con1:ifThenElse>
                                                                                </con1:responseTransform>
                                                                            </con1:wsCallout>
                                                                            <con1:wsCallout xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                                                                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7e06</con5:id>
                                                                                <con1:service ref="PortalCautivo/Proxy Services/LCPSConsultaYCreaOCC" xsi:type="con:PipelineRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                                <con1:operation>setNextelActiveProduct</con1:operation>
                                                                                <con1:request>
                                                                                    <con1:body>consultaCreaOCC</con1:body>
                                                                                </con1:request>
                                                                                <con1:response>
                                                                                    <con1:body>consultaCreaOCCResponse</con1:body>
                                                                                </con1:response>
                                                                                <con1:requestTransform>
                                                                                    <con1:assign varName="consultaCreaOCC">
                                                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7e0d</con5:id>
                                                                                        <con1:expr>
                                                                                            <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config"><![CDATA[<cap:setNextelActiveProduct xmlns:cap="http://captive.portal.ws.ncl.nii.com">
    <lc_customer>{data($body/cap:setNextelActiveProduct/lc_customer)}</lc_customer>
    <tariff_prod>{data($body/cap:setNextelActiveProduct/tariff_prod)}</tariff_prod>
    <traffic_type>{data($body/cap:setNextelActiveProduct/file1)}</traffic_type>
    <sn_code>{data($body/cap:setNextelActiveProduct/id_pcrf_prod)}</sn_code>
    <contractId>{data($body/cap:setNextelActiveProduct/lc_contractId)}</contractId>
	<lc_tmcode>{data($body/cap:setNextelActiveProduct/rate_plan)}</lc_tmcode>
	<fechaActivacion>{$fechaOCC}</fechaActivacion>
</cap:setNextelActiveProduct>]]></con5:xqueryText>
                                                                                        </con1:expr>
                                                                                    </con1:assign>
                                                                                </con1:requestTransform>
                                                                                <con1:responseTransform>
                                                                                    <con1:assign varName="consultaCreaOCCResp">
                                                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7e0c</con5:id>
                                                                                        <con1:expr>
                                                                                            <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$consultaCreaOCCResponse</con4:xqueryText>
                                                                                        </con1:expr>
                                                                                    </con1:assign>
                                                                                    <con1:assign varName="LCErrorOCC">
                                                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7e0b</con5:id>
                                                                                        <con1:expr>
                                                                                            <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">data($consultaCreaOCCResp/error_code)</con4:xqueryText>
                                                                                        </con1:expr>
                                                                                    </con1:assign>
                                                                                    <con1:ifThenElse>
                                                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7e0a</con5:id>
                                                                                        <con1:case>
                                                                                            <con1:condition>
                                                                                                <con4:xqueryConditionExpr xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                                                    <con4:compExpr operator="!=">
                                                                                                        <con4:leftPath>$LCErrorOCC</con4:leftPath>
                                                                                                        <con4:rightPath>'0'</con4:rightPath>
                                                                                                    </con4:compExpr>
                                                                                                </con4:xqueryConditionExpr>
                                                                                            </con1:condition>
                                                                                            <con1:actions>
                                                                                                <con1:replace varName="body" contents-only="true">
                                                                                                    <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7e08</con5:id>
                                                                                                    <con1:expr>
                                                                                                        <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config"><![CDATA[<cap:setNextelActiveProductResponse xmlns:cap="http://captive.portal.ws.ncl.nii.com">
 <error_code>{$LCErrorOCC}</error_code>
 <err_description>{data($consultaCreaOCCResp/err_description)}</err_description>
</cap:setNextelActiveProductResponse>]]></con5:xqueryText>
                                                                                                    </con1:expr>
                                                                                                </con1:replace>
                                                                                                <con4:reply xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                                                    <con4:id>_ActionId-6679472442690164074--3248cc1d.15d51fb1075.-7e07</con4:id>
                                                                                                </con4:reply>
                                                                                            </con1:actions>
                                                                                        </con1:case>
                                                                                        <con1:default/>
                                                                                    </con1:ifThenElse>
                                                                                </con1:responseTransform>
                                                                            </con1:wsCallout>
                                                                        </con2:default>
                                                                    </con2:ifThenElse>
                                                                </con2:actions>
                                                            </con2:case>
                                                            <con2:default>
                                                                <con2:Error>
                                                                    <con1:id>_ActionId-3602376958848697374--7242e8b0.15d08bfc312.-7500</con1:id>
                                                                    <con2:errCode>1</con2:errCode>
                                                                    <con2:message>Error en m√©todo de pago.</con2:message>
                                                                </con2:Error>
                                                            </con2:default>
                                                        </con2:ifThenElse>
                                                    </con2:actions>
                                                </con2:case>
                                                <con2:default>
                                                    <con1:wsCallout xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7f74</con5:id>
                                                        <con1:service xsi:type="ref:ProxyRef" ref="PCRF/Proxy Services/PSPcrfService" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                        <con1:operation>subscribeService</con1:operation>
                                                        <con1:request>
                                                            <con1:param>
                                                                <con1:name>inPara</con1:name>
                                                                <con1:variable>subscribeServiceReq</con1:variable>
                                                            </con1:param>
                                                        </con1:request>
                                                        <con1:response>
                                                            <con1:param>
                                                                <con1:name>result</con1:name>
                                                                <con1:variable>subscribeServiceResponse</con1:variable>
                                                            </con1:param>
                                                        </con1:response>
                                                        <con1:requestTransform>
                                                            <con1:assign varName="subscribeServiceReq">
                                                                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7f7e</con5:id>
                                                                <con1:expr>
                                                                    <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config"><![CDATA[<inPara>
	<subscriber>
	   <!--1 or more repetitions:-->
	   <attribute>
		  <key>USRIDENTIFIER</key>
		  <value>{data($body/cap:setNextelActiveProduct/lc_imsi)}</value>
	   </attribute>
	</subscriber>
	<!--Zero or more repetitions:-->
	<subscribedService>
	   <!--1 or more repetitions:-->
	   <attribute>
		  <key>SRVNAME</key>
		  <value>{data($body/cap:setNextelActiveProduct/id_pcrf_prod)}</value>
	   </attribute>
	   <attribute>
		  <key>srvStartDateTime</key>
		  <value>{$StartDateTime}</value>
	   </attribute>
	   <attribute>
		  <key>srvEndDateTime</key>
		  <value>{$EndDateTime}</value>
	   </attribute>
	</subscribedService>
 </inPara>]]></con4:xqueryText>
                                                                </con1:expr>
                                                            </con1:assign>
                                                        </con1:requestTransform>
                                                        <con1:responseTransform>
                                                            <con1:assign varName="subscribeServResp">
                                                                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7f7d</con5:id>
                                                                <con1:expr>
                                                                    <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$subscribeServiceResponse</con4:xqueryText>
                                                                </con1:expr>
                                                            </con1:assign>
                                                            <con1:ifThenElse>
                                                                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7f7b</con5:id>
                                                                <con1:case>
                                                                    <con1:condition>
                                                                        <con4:xqueryConditionExpr xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                            <con4:compExpr operator="!=">
                                                                                <con4:leftPath>data($subscribeServResp/resultCode)</con4:leftPath>
                                                                                <con4:rightPath>'0'</con4:rightPath>
                                                                            </con4:compExpr>
                                                                        </con4:xqueryConditionExpr>
                                                                    </con1:condition>
                                                                    <con1:actions>
                                                                        <con1:replace varName="body" contents-only="true">
                                                                            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7f76</con5:id>
                                                                            <con1:expr>
                                                                                <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config"><![CDATA[<cap:setNextelActiveProductResponse xmlns:cap="http://captive.portal.ws.ncl.nii.com">
 <error_code>{data($subscribeServResp/resultCode)}</error_code>
 <err_description>{fn:concat('Key: ',data($subscribeServResp/paras/key),' - Value: ' ,data($subscribeServResp/paras/value))}</err_description>
</cap:setNextelActiveProductResponse>]]></con5:xqueryText>
                                                                            </con1:expr>
                                                                        </con1:replace>
                                                                        <con4:reply xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                            <con4:id>_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7f75</con4:id>
                                                                        </con4:reply>
                                                                    </con1:actions>
                                                                </con1:case>
                                                                <con1:default/>
                                                            </con1:ifThenElse>
                                                        </con1:responseTransform>
                                                    </con1:wsCallout>
                                                </con2:default>
                                            </con2:ifThenElse>
                                        </con2:actions>
                                    </con2:case>
                                    <con2:case>
                                        <con2:condition>
                                            <con1:xqueryConditionExpr>
                                                <con1:compExpr operator="=">
                                                    <con1:leftPath>fn:upper-case(data($body/cap:setNextelActiveProduct/segment_prod))</con1:leftPath>
                                                    <con1:rightPath>'HYBRID'</con1:rightPath>
                                                </con1:compExpr>
                                            </con1:xqueryConditionExpr>
                                        </con2:condition>
                                        <con2:actions>
                                            <con2:ifThenElse>
                                                <con1:id>_ActionId-3602376958848697374--7242e8b0.15d08bfc312.-7c8a</con1:id>
                                                <con2:case>
                                                    <con2:condition>
                                                        <con1:xqueryConditionExpr>
                                                            <con1:compExpr operator="=">
                                                                <con1:leftPath>data($body/cap:setNextelActiveProduct/type_prod_bscs)</con1:leftPath>
                                                                <con1:rightPath>'BOL_HIB'</con1:rightPath>
                                                            </con1:compExpr>
                                                        </con1:xqueryConditionExpr>
                                                    </con2:condition>
                                                    <con2:actions>
                                                        <con2:ifThenElse>
                                                            <con1:id>_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7c96</con1:id>
                                                            <con2:case>
                                                                <con2:condition>
                                                                    <con1:xqueryConditionExpr>
                                                                        <con1:compExpr operator=">">
                                                                            <con1:leftPath>xs:integer(data($body/cap:setNextelActiveProduct/tariff_prod))</con1:leftPath>
                                                                            <con1:rightPath>0</con1:rightPath>
                                                                        </con1:compExpr>
                                                                    </con1:xqueryConditionExpr>
                                                                </con2:condition>
                                                                <con2:actions>
                                                                    <con2:ifThenElse>
                                                                        <con1:comment>|</con1:comment>
                                                                        <con1:id>_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7c70</con1:id>
                                                                        <con2:case>
                                                                            <con2:condition>
                                                                                <con1:xqueryConditionExpr>
                                                                                    <con1:compExpr operator="=">
                                                                                        <con1:leftPath>data($body/cap:setNextelActiveProduct/metodo_pago)</con1:leftPath>
                                                                                        <con1:rightPath>'CONTRA_FACTURA'</con1:rightPath>
                                                                                    </con1:compExpr>
                                                                                </con1:xqueryConditionExpr>
                                                                            </con2:condition>
                                                                            <con2:actions>
                                                                                <con2:ifThenElse>
                                                                                    <con1:id>_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7b3c</con1:id>
                                                                                    <con2:case>
                                                                                        <con2:condition>
                                                                                            <con1:xqueryConditionExpr>
                                                                                                <con1:compExpr operator="=">
                                                                                                    <con1:leftPath>data($body/cap:setNextelActiveProduct/pago_aplicado)</con1:leftPath>
                                                                                                    <con1:rightPath>'N'</con1:rightPath>
                                                                                                </con1:compExpr>
                                                                                            </con1:xqueryConditionExpr>
                                                                                        </con2:condition>
                                                                                        <con2:actions>
                                                                                            <con1:wsCallout xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                                                                                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7a93</con5:id>
                                                                                                <con1:service xsi:type="ref:ProxyRef" ref="PCRF/Proxy Services/PSPcrfService" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                                                <con1:operation>subscribeService</con1:operation>
                                                                                                <con1:request>
                                                                                                    <con1:param>
                                                                                                        <con1:name>inPara</con1:name>
                                                                                                        <con1:variable>subscribeServiceReq</con1:variable>
                                                                                                    </con1:param>
                                                                                                </con1:request>
                                                                                                <con1:response>
                                                                                                    <con1:param>
                                                                                                        <con1:name>result</con1:name>
                                                                                                        <con1:variable>subscribeServiceResponse</con1:variable>
                                                                                                    </con1:param>
                                                                                                </con1:response>
                                                                                                <con1:requestTransform>
                                                                                                    <con1:assign varName="subscribeServiceReq">
                                                                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7a99</con5:id>
                                                                                                        <con1:expr>
                                                                                                            <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config"><![CDATA[<inPara>
	<subscriber>
	   <!--1 or more repetitions:-->
	   <attribute>
		  <key>USRIDENTIFIER</key>
		  <value>{data($body/cap:setNextelActiveProduct/lc_imsi)}</value>
	   </attribute>
	</subscriber>
	<!--Zero or more repetitions:-->
	<subscribedService>
	   <!--1 or more repetitions:-->
	   <attribute>
		  <key>SRVNAME</key>
		  <value>{data($body/cap:setNextelActiveProduct/id_pcrf_prod)}</value>
	   </attribute>
	   <attribute>
		  <key>srvStartDateTime</key>
		  <value>{$StartDateTime}</value>
	   </attribute>
	   <attribute>
		  <key>srvEndDateTime</key>
		  <value>{$EndDateTime}</value>
	   </attribute>
	</subscribedService>
 </inPara>]]></con4:xqueryText>
                                                                                                        </con1:expr>
                                                                                                    </con1:assign>
                                                                                                </con1:requestTransform>
                                                                                                <con1:responseTransform>
                                                                                                    <con1:assign varName="subscribeServResp">
                                                                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7a98</con5:id>
                                                                                                        <con1:expr>
                                                                                                            <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$subscribeServiceResponse</con4:xqueryText>
                                                                                                        </con1:expr>
                                                                                                    </con1:assign>
                                                                                                    <con1:ifThenElse>
                                                                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7a97</con5:id>
                                                                                                        <con1:case>
                                                                                                            <con1:condition>
                                                                                                                <con4:xqueryConditionExpr xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                                                                    <con4:compExpr operator="!=">
                                                                                                                        <con4:leftPath>data($subscribeServResp/resultCode)</con4:leftPath>
                                                                                                                        <con4:rightPath>'0'</con4:rightPath>
                                                                                                                    </con4:compExpr>
                                                                                                                </con4:xqueryConditionExpr>
                                                                                                            </con1:condition>
                                                                                                            <con1:actions>
                                                                                                                <con1:replace varName="body" contents-only="true">
                                                                                                                    <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7a95</con5:id>
                                                                                                                    <con1:expr>
                                                                                                                        <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config"><![CDATA[<cap:setNextelActiveProductResponse xmlns:cap="http://captive.portal.ws.ncl.nii.com">
 <error_code>{data($subscribeServResp/resultCode)}</error_code>
 <err_description>{fn:concat('Key: ',data($subscribeServResp/paras/key),' - Value: ' ,data($subscribeServResp/paras/value))}</err_description>
</cap:setNextelActiveProductResponse>]]></con5:xqueryText>
                                                                                                                    </con1:expr>
                                                                                                                </con1:replace>
                                                                                                                <con4:reply xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                                                                    <con4:id>_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7a94</con4:id>
                                                                                                                </con4:reply>
                                                                                                            </con1:actions>
                                                                                                        </con1:case>
                                                                                                        <con1:default/>
                                                                                                    </con1:ifThenElse>
                                                                                                </con1:responseTransform>
                                                                                            </con1:wsCallout>
                                                                                            <con1:wsCallout xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                                                                                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3706191329915299395-565235fc.15d0e4d3360.-79ff</con5:id>
                                                                                                <con1:service ref="PortalCautivo/Proxy Services/LCPSConsultaYCreaOCC" xsi:type="con:PipelineRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                                                <con1:operation>setNextelActiveProduct</con1:operation>
                                                                                                <con1:request>
                                                                                                    <con1:body>consultaCreaOCC</con1:body>
                                                                                                </con1:request>
                                                                                                <con1:response>
                                                                                                    <con1:body>consultaCreaOCCResponse</con1:body>
                                                                                                </con1:response>
                                                                                                <con1:requestTransform>
                                                                                                    <con1:assign varName="consultaCreaOCC">
                                                                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7a06</con5:id>
                                                                                                        <con1:expr>
                                                                                                            <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config"><![CDATA[<cap:setNextelActiveProduct xmlns:cap="http://captive.portal.ws.ncl.nii.com">
    <lc_customer>{data($body/cap:setNextelActiveProduct/lc_customer)}</lc_customer>
    <tariff_prod>{data($body/cap:setNextelActiveProduct/tariff_prod)}</tariff_prod>
    <traffic_type>{data($body/cap:setNextelActiveProduct/file1)}</traffic_type>
    <sn_code>{data($body/cap:setNextelActiveProduct/id_pcrf_prod)}</sn_code>
    <contractId>{data($body/cap:setNextelActiveProduct/lc_contractId)}</contractId>
	<lc_tmcode>{data($body/cap:setNextelActiveProduct/rate_plan)}</lc_tmcode>
	<fechaActivacion>{$fechaOCC}</fechaActivacion>
</cap:setNextelActiveProduct>]]></con5:xqueryText>
                                                                                                        </con1:expr>
                                                                                                    </con1:assign>
                                                                                                </con1:requestTransform>
                                                                                                <con1:responseTransform>
                                                                                                    <con1:assign varName="consultaCreaOCCResp">
                                                                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7a05</con5:id>
                                                                                                        <con1:expr>
                                                                                                            <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$consultaCreaOCCResponse</con4:xqueryText>
                                                                                                        </con1:expr>
                                                                                                    </con1:assign>
                                                                                                    <con1:assign varName="LCErrorOCC">
                                                                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7a04</con5:id>
                                                                                                        <con1:expr>
                                                                                                            <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">data($consultaCreaOCCResp/error_code)</con4:xqueryText>
                                                                                                        </con1:expr>
                                                                                                    </con1:assign>
                                                                                                    <con1:ifThenElse>
                                                                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7a03</con5:id>
                                                                                                        <con1:case>
                                                                                                            <con1:condition>
                                                                                                                <con4:xqueryConditionExpr xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                                                                    <con4:compExpr operator="!=">
                                                                                                                        <con4:leftPath>$LCErrorOCC</con4:leftPath>
                                                                                                                        <con4:rightPath>'0'</con4:rightPath>
                                                                                                                    </con4:compExpr>
                                                                                                                </con4:xqueryConditionExpr>
                                                                                                            </con1:condition>
                                                                                                            <con1:actions>
                                                                                                                <con1:replace varName="body" contents-only="true">
                                                                                                                    <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7a01</con5:id>
                                                                                                                    <con1:expr>
                                                                                                                        <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config"><![CDATA[<cap:setNextelActiveProductResponse xmlns:cap="http://captive.portal.ws.ncl.nii.com">
 <error_code>{$LCErrorOCC}</error_code>
 <err_description>{data($consultaCreaOCCResp/err_description)}</err_description>
</cap:setNextelActiveProductResponse>]]></con5:xqueryText>
                                                                                                                    </con1:expr>
                                                                                                                </con1:replace>
                                                                                                                <con4:reply xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                                                                    <con4:id>_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7a00</con4:id>
                                                                                                                </con4:reply>
                                                                                                            </con1:actions>
                                                                                                        </con1:case>
                                                                                                        <con1:default/>
                                                                                                    </con1:ifThenElse>
                                                                                                </con1:responseTransform>
                                                                                            </con1:wsCallout>
                                                                                        </con2:actions>
                                                                                    </con2:case>
                                                                                    <con2:default>
                                                                                        <con2:Error>
                                                                                            <con1:id>_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7b22</con1:id>
                                                                                            <con2:errCode>1</con2:errCode>
                                                                                            <con2:message>Error m√©todo de pago</con2:message>
                                                                                        </con2:Error>
                                                                                    </con2:default>
                                                                                </con2:ifThenElse>
                                                                            </con2:actions>
                                                                        </con2:case>
                                                                        <con2:default>
                                                                            <con2:wsCallout>
                                                                                <con1:id>_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7b68</con1:id>
                                                                                <con2:service ref="PortalCautivo/Proxy Services/LCPSConsultaYCreaSaldoICC" xsi:type="con:PipelineRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                                <con2:operation>setNextelActiveProduct</con2:operation>
                                                                                <con2:request>
                                                                                    <con2:body>ConsultaICCR</con2:body>
                                                                                </con2:request>
                                                                                <con2:response>
                                                                                    <con2:body>ConsultaICCResponse</con2:body>
                                                                                </con2:response>
                                                                                <con2:requestTransform>
                                                                                    <con2:assign varName="ConsultaICCR">
                                                                                        <con1:id>_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7b70</con1:id>
                                                                                        <con2:expr>
                                                                                            <con1:xqueryText><![CDATA[<cap:setNextelActiveProduct xmlns:cap="http://captive.portal.ws.ncl.nii.com">
    <phone_number>{$body/cap:setNextelActiveProduct/phone_number/text()}</phone_number>
    <tariff_prod>{$body/cap:setNextelActiveProduct/tariff_prod/text()}</tariff_prod>
    <tecnologia>3G</tecnologia>
    <imsi>{$body/cap:setNextelActiveProduct/lc_imsi/text()}</imsi>
    <id_pcrf_prod>{$body/cap:setNextelActiveProduct/id_pcrf_prod/text()}</id_pcrf_prod>
    <unitFree>{$body/cap:setNextelActiveProduct/unit_free/text()}</unitFree>
    <startDateTime>{$StartDateTime}</startDateTime>
    <endDateTime>{$EndDateTime}</endDateTime>
    <iniciaDate>{$ActualDate}</iniciaDate>  
    <finDate>{$TotalDate}</finDate>	
    <flagDesactivaExiste>{if($body/cap:setNextelActiveProduct/channel_act/text() = 'PORTAL') then 
('1')else()}</flagDesactivaExiste>	
 </cap:setNextelActiveProduct>]]></con1:xqueryText>
                                                                                        </con2:expr>
                                                                                    </con2:assign>
                                                                                </con2:requestTransform>
                                                                                <con2:responseTransform>
                                                                                    <con2:assign varName="ConsultaICCRes">
                                                                                        <con1:id>_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7b6f</con1:id>
                                                                                        <con2:expr>
                                                                                            <con1:xqueryText>$ConsultaICCResponse</con1:xqueryText>
                                                                                        </con2:expr>
                                                                                    </con2:assign>
                                                                                    <con2:assign varName="errorLC">
                                                                                        <con1:id>_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7b6e</con1:id>
                                                                                        <con2:expr>
                                                                                            <con1:xqueryText>data($ConsultaICCRes/error_code)</con1:xqueryText>
                                                                                        </con2:expr>
                                                                                    </con2:assign>
                                                                                    <con2:assign varName="cadenaBucket">
                                                                                        <con1:id>_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7b6d</con1:id>
                                                                                        <con2:expr>
                                                                                            <con1:xqueryText>data($ConsultaICCRes/cadenaBucket)</con1:xqueryText>
                                                                                        </con2:expr>
                                                                                    </con2:assign>
                                                                                    <con1:ifThenElse xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7b6c</con5:id>
                                                                                        <con1:case>
                                                                                            <con1:condition>
                                                                                                <con4:xqueryConditionExpr xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                                                    <con4:compExpr operator="!=">
                                                                                                        <con4:leftPath>data($errorLC)</con4:leftPath>
                                                                                                        <con4:rightPath>'0'</con4:rightPath>
                                                                                                    </con4:compExpr>
                                                                                                </con4:xqueryConditionExpr>
                                                                                            </con1:condition>
                                                                                            <con1:actions>
                                                                                                <con1:replace varName="body" contents-only="true">
                                                                                                    <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7b6a</con5:id>
                                                                                                    <con1:expr>
                                                                                                        <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config"><![CDATA[<cap:setNextelActiveProductResponse xmlns:cap="http://captive.portal.ws.ncl.nii.com">
 <error_code>{data($ConsultaICCRes/error_code)}</error_code>
 <err_description>{data($ConsultaICCRes/err_description)}</err_description>
</cap:setNextelActiveProductResponse>]]></con5:xqueryText>
                                                                                                    </con1:expr>
                                                                                                </con1:replace>
                                                                                                <con4:reply xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                                                    <con4:id>_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7b69</con4:id>
                                                                                                </con4:reply>
                                                                                            </con1:actions>
                                                                                        </con1:case>
                                                                                        <con1:default/>
                                                                                    </con1:ifThenElse>
                                                                                </con2:responseTransform>
                                                                            </con2:wsCallout>
                                                                        </con2:default>
                                                                    </con2:ifThenElse>
                                                                </con2:actions>
                                                            </con2:case>
                                                            <con2:default>
                                                                <con1:wsCallout xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                                                    <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7bef</con5:id>
                                                                    <con1:service xsi:type="ref:ProxyRef" ref="PCRF/Proxy Services/PSPcrfService" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                    <con1:operation>subscribeService</con1:operation>
                                                                    <con1:request>
                                                                        <con1:param>
                                                                            <con1:name>inPara</con1:name>
                                                                            <con1:variable>subscribeServiceReq</con1:variable>
                                                                        </con1:param>
                                                                    </con1:request>
                                                                    <con1:response>
                                                                        <con1:param>
                                                                            <con1:name>result</con1:name>
                                                                            <con1:variable>subscribeServiceResponse</con1:variable>
                                                                        </con1:param>
                                                                    </con1:response>
                                                                    <con1:requestTransform>
                                                                        <con1:assign varName="subscribeServiceReq">
                                                                            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7bf5</con5:id>
                                                                            <con1:expr>
                                                                                <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config"><![CDATA[<inPara>
	<subscriber>
	   <!--1 or more repetitions:-->
	   <attribute>
		  <key>USRIDENTIFIER</key>
		  <value>{data($body/cap:setNextelActiveProduct/lc_imsi)}</value>
	   </attribute>
	</subscriber>
	<!--Zero or more repetitions:-->
	<subscribedService>
	   <!--1 or more repetitions:-->
	   <attribute>
		  <key>SRVNAME</key>
		  <value>{data($body/cap:setNextelActiveProduct/id_pcrf_prod)}</value>
	   </attribute>
	   <attribute>
		  <key>srvStartDateTime</key>
		  <value>{$StartDateTime}</value>
	   </attribute>
	   <attribute>
		  <key>srvEndDateTime</key>
		  <value>{$EndDateTime}</value>
	   </attribute>
	</subscribedService>
 </inPara>]]></con4:xqueryText>
                                                                            </con1:expr>
                                                                        </con1:assign>
                                                                    </con1:requestTransform>
                                                                    <con1:responseTransform>
                                                                        <con1:assign varName="subscribeServResp">
                                                                            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7bf4</con5:id>
                                                                            <con1:expr>
                                                                                <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$subscribeServiceResponse</con4:xqueryText>
                                                                            </con1:expr>
                                                                        </con1:assign>
                                                                        <con1:ifThenElse>
                                                                            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7bf3</con5:id>
                                                                            <con1:case>
                                                                                <con1:condition>
                                                                                    <con4:xqueryConditionExpr xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                                        <con4:compExpr operator="!=">
                                                                                            <con4:leftPath>data($subscribeServResp/resultCode)</con4:leftPath>
                                                                                            <con4:rightPath>'0'</con4:rightPath>
                                                                                        </con4:compExpr>
                                                                                    </con4:xqueryConditionExpr>
                                                                                </con1:condition>
                                                                                <con1:actions>
                                                                                    <con1:replace varName="body" contents-only="true">
                                                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7bf1</con5:id>
                                                                                        <con1:expr>
                                                                                            <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config"><![CDATA[<cap:setNextelActiveProductResponse xmlns:cap="http://captive.portal.ws.ncl.nii.com">
 <error_code>{data($subscribeServResp/resultCode)}</error_code>
 <err_description>{fn:concat('Key: ',data($subscribeServResp/paras/key),' - Value: ' ,data($subscribeServResp/paras/value))}</err_description>
</cap:setNextelActiveProductResponse>]]></con5:xqueryText>
                                                                                        </con1:expr>
                                                                                    </con1:replace>
                                                                                    <con4:reply xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                                        <con4:id>_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7bf0</con4:id>
                                                                                    </con4:reply>
                                                                                </con1:actions>
                                                                            </con1:case>
                                                                            <con1:default/>
                                                                        </con1:ifThenElse>
                                                                    </con1:responseTransform>
                                                                </con1:wsCallout>
                                                            </con2:default>
                                                        </con2:ifThenElse>
                                                    </con2:actions>
                                                </con2:case>
                                                <con2:default>
                                                    <con2:Error>
                                                        <con1:id>_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7cb4</con1:id>
                                                        <con2:errCode>1</con2:errCode>
                                                        <con2:message>Error: Producto Invalido</con2:message>
                                                    </con2:Error>
                                                </con2:default>
                                            </con2:ifThenElse>
                                        </con2:actions>
                                    </con2:case>
                                    <con2:case>
                                        <con2:condition>
                                            <con1:xqueryConditionExpr>
                                                <con1:compExpr operator="=">
                                                    <con1:leftPath>fn:upper-case(data($body/cap:setNextelActiveProduct/segment_prod))</con1:leftPath>
                                                    <con1:rightPath>'PREPAID'</con1:rightPath>
                                                </con1:compExpr>
                                            </con1:xqueryConditionExpr>
                                        </con2:condition>
                                        <con2:actions>
                                            <con2:ifThenElse>
                                                <con1:id>_ActionId-3602376958848697374--7242e8b0.15d08bfc312.-7c64</con1:id>
                                                <con2:case>
                                                    <con2:condition>
                                                        <con1:xqueryConditionExpr>
                                                            <con1:compExpr operator="=">
                                                                <con1:leftPath>data($body/cap:setNextelActiveProduct/type_prod_bscs)</con1:leftPath>
                                                                <con1:rightPath>'BOL_PREP'</con1:rightPath>
                                                            </con1:compExpr>
                                                        </con1:xqueryConditionExpr>
                                                    </con2:condition>
                                                    <con2:actions>
                                                        <con2:ifThenElse>
                                                            <con1:id>_ActionId-3706191329915299395-565235fc.15d0e4d3360.-79ce</con1:id>
                                                            <con2:case>
                                                                <con2:condition>
                                                                    <con1:xqueryConditionExpr>
                                                                        <con1:compExpr operator=">">
                                                                            <con1:leftPath>xs:integer(data($body/cap:setNextelActiveProduct/tariff_prod))</con1:leftPath>
                                                                            <con1:rightPath>0</con1:rightPath>
                                                                        </con1:compExpr>
                                                                    </con1:xqueryConditionExpr>
                                                                </con2:condition>
                                                                <con2:actions>
                                                                    <con2:ifThenElse>
                                                                        <con1:id>_ActionId-3706191329915299395-565235fc.15d0e4d3360.-79b2</con1:id>
                                                                        <con2:case>
                                                                            <con2:condition>
                                                                                <con1:xqueryConditionExpr>
                                                                                    <con1:compExpr operator="=">
                                                                                        <con1:leftPath>data($body/cap:setNextelActiveProduct/metodo_pago)</con1:leftPath>
                                                                                        <con1:rightPath>'SALDO_PREPAGO'</con1:rightPath>
                                                                                    </con1:compExpr>
                                                                                </con1:xqueryConditionExpr>
                                                                            </con2:condition>
                                                                            <con2:actions>
                                                                                <con2:ifThenElse>
                                                                                    <con1:id>_ActionId-521356982271692406--3b5917de.15d12e6197c.-7f3f</con1:id>
                                                                                    <con2:case>
                                                                                        <con2:condition>
                                                                                            <con1:xqueryConditionExpr>
                                                                                                <con1:compExpr operator="=">
                                                                                                    <con1:leftPath>data($body/cap:setNextelActiveProduct/pago_aplicado)</con1:leftPath>
                                                                                                    <con1:rightPath>'N'</con1:rightPath>
                                                                                                </con1:compExpr>
                                                                                            </con1:xqueryConditionExpr>
                                                                                        </con2:condition>
                                                                                        <con2:actions>
                                                                                            <con2:ifThenElse>
                                                                                                <con1:id>_ActionId-3983233839552650961--de8752b.15d4d639764.-7f27</con1:id>
                                                                                                <con2:case>
                                                                                                    <con2:condition>
                                                                                                        <con1:xqueryText>$body/cap:setNextelActiveProduct/tecnologia/text() = 'TEM'</con1:xqueryText>
                                                                                                    </con2:condition>
                                                                                                    <con2:actions>
                                                                                                        <con2:wsCallout>
                                                                                                            <con1:id>_ActionId-3983233839552650961--de8752b.15d4d639764.-7b56</con1:id>
                                                                                                            <con2:service xsi:type="ref:ProxyRef" ref="SearchBalancesICC/Proxy Services/PSSearchBalancesICCService" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                                                            <con2:operation>getSearchBalanceIcc</con2:operation>
                                                                                                            <con2:request>
                                                                                                                <con2:body>getSearchBalanceIcc</con2:body>
                                                                                                            </con2:request>
                                                                                                            <con2:response>
                                                                                                                <con2:body>getSearchBalanceIccRespo</con2:body>
                                                                                                            </con2:response>
                                                                                                            <con2:requestTransform>
                                                                                                                <con1:assign varName="getSearchBalanceIcc" xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                                                                                                    <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3983233839552650961--de8752b.15d4d639764.-7b59</con5:id>
                                                                                                                    <con1:expr>
                                                                                                                        <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config"><![CDATA[<get:searchBalancesICC-request 	xmlns:get="http://ws.nextel.cl/schemas/searchBalanceIcc/alcatel/getAllInformation">
<!--Optional:-->
<get:phone_number>{data($body/cap:setNextelActiveProduct/phone_number)}</get:phone_number>
<!--Optional:-->
<get:detail_bucket>Y</get:detail_bucket>
</get:searchBalancesICC-request>]]></con5:xqueryText>
                                                                                                                    </con1:expr>
                                                                                                                </con1:assign>
                                                                                                            </con2:requestTransform>
                                                                                                            <con2:responseTransform>
                                                                                                                <con2:assign varName="getSearchRespo">
                                                                                                                    <con1:id>_ActionId-3983233839552650961--de8752b.15d4d639764.-7b58</con1:id>
                                                                                                                    <con2:expr>
                                                                                                                        <con1:xqueryText>$getSearchBalanceIccRespo</con1:xqueryText>
                                                                                                                    </con2:expr>
                                                                                                                </con2:assign>
                                                                                                                <con2:assign varName="currentBalance">
                                                                                                                    <con1:id>_ActionId-3983233839552650961--de8752b.15d4d639764.-7b57</con1:id>
                                                                                                                    <con2:expr>
                                                                                                                        <con1:xqueryText>data($getSearchRespo/get:totalBalance)</con1:xqueryText>
                                                                                                                    </con2:expr>
                                                                                                                </con2:assign>
                                                                                                                <con1:ifThenElse xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                                                                                                    <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3983233839552650961--de8752b.15d4d639764.-7b53</con5:id>
                                                                                                                    <con1:case>
                                                                                                                        <con1:condition>
                                                                                                                            <con4:xqueryConditionExpr xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                                                                                <con4:compExpr operator="&lt;">
                                                                                                                                    <con4:leftPath>xs:decimal($currentBalance)</con4:leftPath>
                                                                                                                                    <con4:rightPath>xs:decimal($body/cap:setNextelActiveProduct/tariff_prod)</con4:rightPath>
                                                                                                                                </con4:compExpr>
                                                                                                                            </con4:xqueryConditionExpr>
                                                                                                                        </con1:condition>
                                                                                                                        <con1:actions>
                                                                                                                            <con1:Error>
                                                                                                                                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3983233839552650961--de8752b.15d4d639764.-7b52</con5:id>
                                                                                                                                <con1:errCode>1</con1:errCode>
                                                                                                                                <con1:message>Saldo Insuficiente</con1:message>
                                                                                                                            </con1:Error>
                                                                                                                        </con1:actions>
                                                                                                                    </con1:case>
                                                                                                                    <con1:default/>
                                                                                                                </con1:ifThenElse>
                                                                                                            </con2:responseTransform>
                                                                                                        </con2:wsCallout>
                                                                                                        <con2:wsCallout>
                                                                                                            <con1:id>_ActionId-3983233839552650961--de8752b.15d4d639764.-7de9</con1:id>
                                                                                                            <con2:service xsi:type="ref:ProxyRef" ref="PCRF/Proxy Services/PSPcrfService" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                                                            <con2:operation>getSubscriberAllInf</con2:operation>
                                                                                                            <con2:request>
                                                                                                                <con2:param>
                                                                                                                    <con2:name>inPara</con2:name>
                                                                                                                    <con2:variable>getSubscriberAllInf</con2:variable>
                                                                                                                </con2:param>
                                                                                                            </con2:request>
                                                                                                            <con2:response>
                                                                                                                <con2:param>
                                                                                                                    <con2:name>result</con2:name>
                                                                                                                    <con2:variable>getSubscriberAllInfResp</con2:variable>
                                                                                                                </con2:param>
                                                                                                            </con2:response>
                                                                                                            <con2:requestTransform>
                                                                                                                <con2:assign varName="getSubscriberAllInf">
                                                                                                                    <con1:id>_ActionId-3983233839552650961--de8752b.15d4d639764.-7dee</con1:id>
                                                                                                                    <con2:expr>
                                                                                                                        <con1:xqueryText><![CDATA[<inPara>
    <subscriber>
        <!--1 or more repetitions:-->
        <attribute>
            <key>USRIDENTIFIER</key>
            <value>{$body/cap:setNextelActiveProduct/lc_imsi/text()}</value>
        </attribute>
    </subscriber>
</inPara>]]></con1:xqueryText>
                                                                                                                    </con2:expr>
                                                                                                                </con2:assign>
                                                                                                            </con2:requestTransform>
                                                                                                            <con2:responseTransform>
                                                                                                                <con2:assign varName="SubscriberAllInfResp">
                                                                                                                    <con1:id>_ActionId-3983233839552650961--de8752b.15d4d639764.-7ded</con1:id>
                                                                                                                    <con2:expr>
                                                                                                                        <con1:xqueryText>$getSubscriberAllInfResp</con1:xqueryText>
                                                                                                                    </con2:expr>
                                                                                                                </con2:assign>
                                                                                                                <con2:assign varName="validExistPcrfvalue">
                                                                                                                    <con1:id>_ActionId-3983233839552650961--de8752b.15d4d639764.-7dcc</con1:id>
                                                                                                                    <con2:expr>
                                                                                                                        <con1:xqueryText>fn:count($SubscriberAllInfResp/subscribedService/attribute[value = $body/cap:setNextelActiveProduct/id_pcrf_prod/text()])</con1:xqueryText>
                                                                                                                    </con2:expr>
                                                                                                                </con2:assign>
                                                                                                                <con2:ifThenElse>
                                                                                                                    <con1:id>_ActionId-3983233839552650961--de8752b.15d4d639764.-7dec</con1:id>
                                                                                                                    <con2:case>
                                                                                                                        <con2:condition>
                                                                                                                            <con1:xqueryText>$SubscriberAllInfResp/resultCode/text() != '0'</con1:xqueryText>
                                                                                                                        </con2:condition>
                                                                                                                        <con2:actions>
                                                                                                                            <con2:replace varName="body" contents-only="true">
                                                                                                                                <con1:id>_ActionId-3983233839552650961--de8752b.15d4d639764.-7deb</con1:id>
                                                                                                                                <con2:expr>
                                                                                                                                    <con1:xqueryText><![CDATA[<cap:setNextelActiveProductResponse xmlns:cap="http://captive.portal.ws.ncl.nii.com">
 <error_code>{$SubscriberAllInfResp/resultCode/text()}</error_code>
 <err_description>{fn:concat('Error al obtener informaci√≥n PCRF, Key: ',data($SubscriberAllInfResp/paras/key),' - Value: ' ,data($SubscriberAllInfResp/paras/value))}</err_description>
</cap:setNextelActiveProductResponse>]]></con1:xqueryText>
                                                                                                                                </con2:expr>
                                                                                                                            </con2:replace>
                                                                                                                            <con1:reply isError="false">
                                                                                                                                <con1:id>_ActionId-3983233839552650961--de8752b.15d4d639764.-7dea</con1:id>
                                                                                                                            </con1:reply>
                                                                                                                        </con2:actions>
                                                                                                                    </con2:case>
                                                                                                                    <con2:default/>
                                                                                                                </con2:ifThenElse>
                                                                                                            </con2:responseTransform>
                                                                                                        </con2:wsCallout>
                                                                                                        <con1:ifThenElse xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                                                                                            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3983233839552650961--de8752b.15d4d639764.-7c23</con5:id>
                                                                                                            <con1:case>
                                                                                                                <con1:condition>
                                                                                                                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">xs:string($validExistPcrfvalue) = '0'</con5:xqueryText>
                                                                                                                </con1:condition>
                                                                                                                <con1:actions>
                                                                                                                    <con1:wsCallout>
                                                                                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3983233839552650961--de8752b.15d4d639764.-7c15</con5:id>
                                                                                                                        <con1:service xsi:type="ref:ProxyRef" ref="PCRF/Proxy Services/PSPcrfService" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                                                                        <con1:operation>subscribeService</con1:operation>
                                                                                                                        <con1:request>
                                                                                                                            <con1:param>
                                                                                                                                <con1:name>inPara</con1:name>
                                                                                                                                <con1:variable>subscribeServiceReq</con1:variable>
                                                                                                                            </con1:param>
                                                                                                                        </con1:request>
                                                                                                                        <con1:response>
                                                                                                                            <con1:param>
                                                                                                                                <con1:name>result</con1:name>
                                                                                                                                <con1:variable>subscribeServiceResponse</con1:variable>
                                                                                                                            </con1:param>
                                                                                                                        </con1:response>
                                                                                                                        <con1:requestTransform>
                                                                                                                            <con1:assign varName="subscribeServiceReq">
                                                                                                                                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3983233839552650961--de8752b.15d4d639764.-7c1b</con5:id>
                                                                                                                                <con1:expr>
                                                                                                                                    <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config"><![CDATA[<inPara>
	<subscriber>
	   <!--1 or more repetitions:-->
	   <attribute>
		  <key>USRIDENTIFIER</key>
		  <value>{data($body/cap:setNextelActiveProduct/lc_imsi)}</value>
	   </attribute>
	</subscriber>
	<!--Zero or more repetitions:-->
	<subscribedService>
	   <!--1 or more repetitions:-->
	   <attribute>
		  <key>SRVNAME</key>
		  <value>{data($body/cap:setNextelActiveProduct/id_pcrf_prod)}</value>
	   </attribute>
	   <attribute>
		  <key>srvStartDateTime</key>
		  <value>{$StartDateTime}</value>
	   </attribute>
	   <attribute>
		  <key>srvEndDateTime</key>
		  <value>{$EndDateTime}</value>
	   </attribute>
	</subscribedService>
 </inPara>]]></con4:xqueryText>
                                                                                                                                </con1:expr>
                                                                                                                            </con1:assign>
                                                                                                                        </con1:requestTransform>
                                                                                                                        <con1:responseTransform>
                                                                                                                            <con1:assign varName="subscribeServResp">
                                                                                                                                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3983233839552650961--de8752b.15d4d639764.-7c1a</con5:id>
                                                                                                                                <con1:expr>
                                                                                                                                    <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$subscribeServiceResponse</con4:xqueryText>
                                                                                                                                </con1:expr>
                                                                                                                            </con1:assign>
                                                                                                                            <con1:ifThenElse>
                                                                                                                                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3983233839552650961--de8752b.15d4d639764.-7c19</con5:id>
                                                                                                                                <con1:case>
                                                                                                                                    <con1:condition>
                                                                                                                                        <con4:xqueryConditionExpr xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                                                                                            <con4:compExpr operator="!=">
                                                                                                                                                <con4:leftPath>data($subscribeServResp/resultCode)</con4:leftPath>
                                                                                                                                                <con4:rightPath>'0'</con4:rightPath>
                                                                                                                                            </con4:compExpr>
                                                                                                                                        </con4:xqueryConditionExpr>
                                                                                                                                    </con1:condition>
                                                                                                                                    <con1:actions>
                                                                                                                                        <con1:replace varName="body" contents-only="true">
                                                                                                                                            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3983233839552650961--de8752b.15d4d639764.-7c17</con5:id>
                                                                                                                                            <con1:expr>
                                                                                                                                                <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config"><![CDATA[<cap:setNextelActiveProductResponse xmlns:cap="http://captive.portal.ws.ncl.nii.com">
 <error_code>{data($subscribeServResp/resultCode)}</error_code>
 <err_description>{fn:concat('Key: ',data($subscribeServResp/paras/key),' - Value: ' ,data($subscribeServResp/paras/value))}</err_description>
</cap:setNextelActiveProductResponse>]]></con5:xqueryText>
                                                                                                                                            </con1:expr>
                                                                                                                                        </con1:replace>
                                                                                                                                        <con4:reply isError="false" xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                                                                                            <con4:id>_ActionId-3983233839552650961--de8752b.15d4d639764.-7c16</con4:id>
                                                                                                                                        </con4:reply>
                                                                                                                                    </con1:actions>
                                                                                                                                </con1:case>
                                                                                                                                <con1:default/>
                                                                                                                            </con1:ifThenElse>
                                                                                                                        </con1:responseTransform>
                                                                                                                    </con1:wsCallout>
                                                                                                                    <con5:wsCallout xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config">
                                                                                                                        <con1:id>_ActionId-3983233839552650961--de8752b.15d4d639764.-7a29</con1:id>
                                                                                                                        <con5:service xsi:type="ref:ProxyRef" ref="PortalCautivo/Proxy Services/PSAjustaICCPortal" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                                                                        <con5:operation>setAjustaICCPortal</con5:operation>
                                                                                                                        <con5:request>
                                                                                                                            <con5:body>ajusteICCReq</con5:body>
                                                                                                                        </con5:request>
                                                                                                                        <con5:response>
                                                                                                                            <con5:body>ajusteICCResp</con5:body>
                                                                                                                        </con5:response>
                                                                                                                        <con5:requestTransform>
                                                                                                                            <con5:assign varName="ajusteICCReq">
                                                                                                                                <con1:id>_ActionId-3983233839552650961--de8752b.15d4d639764.-7a30</con1:id>
                                                                                                                                <con5:expr>
                                                                                                                                    <con1:xqueryText><![CDATA[<cap:setAjustaICCPortal xmlns:cap="http://captive.portal.ws.ncl.nii.com">
    <phone_number>{data($body/cap:setNextelActiveProduct/phone_number)}</phone_number>
    <tariff_prod>{data($body/cap:setNextelActiveProduct/tariff_prod)}</tariff_prod>
</cap:setAjustaICCPortal>]]></con1:xqueryText>
                                                                                                                                </con5:expr>
                                                                                                                            </con5:assign>
                                                                                                                        </con5:requestTransform>
                                                                                                                        <con5:responseTransform>
                                                                                                                            <con1:assign varName="LCErrorOCC" xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                                                                                                                <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-3983233839552650961--de8752b.15d4d639764.-7a2f</con6:id>
                                                                                                                                <con1:expr>
                                                                                                                                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">data($ajusteICCResp/error_code)</con5:xqueryText>
                                                                                                                                </con1:expr>
                                                                                                                            </con1:assign>
                                                                                                                            <con1:assign varName="cadenaBucket" xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                                                                                                                <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-3983233839552650961--de8752b.15d4d639764.-7a2e</con6:id>
                                                                                                                                <con1:expr>
                                                                                                                                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">data($ajusteICCResp/cadenaBucket)</con5:xqueryText>
                                                                                                                                </con1:expr>
                                                                                                                            </con1:assign>
                                                                                                                            <con1:ifThenElse xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                                                                                                                <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-3983233839552650961--de8752b.15d4d639764.-7a2d</con6:id>
                                                                                                                                <con1:case>
                                                                                                                                    <con1:condition>
                                                                                                                                        <con4:xqueryConditionExpr xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                                                                                            <con4:compExpr operator="!=">
                                                                                                                                                <con4:leftPath>$LCErrorOCC</con4:leftPath>
                                                                                                                                                <con4:rightPath>'0'</con4:rightPath>
                                                                                                                                            </con4:compExpr>
                                                                                                                                        </con4:xqueryConditionExpr>
                                                                                                                                    </con1:condition>
                                                                                                                                    <con1:actions>
                                                                                                                                        <con1:replace varName="body" contents-only="true">
                                                                                                                                            <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-3983233839552650961--de8752b.15d4d639764.-7a2b</con6:id>
                                                                                                                                            <con1:expr>
                                                                                                                                                <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config"><![CDATA[<cap:setNextelActiveProductResponse xmlns:cap="http://captive.portal.ws.ncl.nii.com">
   <error_code>{$LCErrorOCC}</error_code>
   <err_description>{concat('Error: ',data($ajusteICCResp/err_description),', Nivel: AjusteICC')}</err_description>
</cap:setNextelActiveProductResponse>]]></con6:xqueryText>
                                                                                                                                            </con1:expr>
                                                                                                                                        </con1:replace>
                                                                                                                                        <con4:reply xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                                                                                            <con4:id>_ActionId-3983233839552650961--de8752b.15d4d639764.-7a2a</con4:id>
                                                                                                                                        </con4:reply>
                                                                                                                                    </con1:actions>
                                                                                                                                </con1:case>
                                                                                                                                <con1:default/>
                                                                                                                            </con1:ifThenElse>
                                                                                                                        </con5:responseTransform>
                                                                                                                    </con5:wsCallout>
                                                                                                                </con1:actions>
                                                                                                            </con1:case>
                                                                                                            <con1:default>
                                                                                                                <con5:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config">
                                                                                                                    <con1:id>_ActionId-3983233839552650961--de8752b.15d4d639764.-7ad8</con1:id>
                                                                                                                    <con5:expr>
                                                                                                                        <con1:xqueryText><![CDATA[<cap:setNextelActiveProductResponse xmlns:cap="http://captive.portal.ws.ncl.nii.com">
 <error_code>5051</error_code>
 <err_description>Actualmente ya tienes una bolsa activa. Podras comprar otra una vez que esta expire.</err_description>
</cap:setNextelActiveProductResponse>]]></con1:xqueryText>
                                                                                                                    </con5:expr>
                                                                                                                </con5:replace>
                                                                                                                <con1:reply isError="false" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                                                                                                                    <con1:id>_ActionId-3983233839552650961--de8752b.15d4d639764.-7adb</con1:id>
                                                                                                                </con1:reply>
                                                                                                            </con1:default>
                                                                                                        </con1:ifThenElse>
                                                                                                    </con2:actions>
                                                                                                </con2:case>
                                                                                                <con2:default>
                                                                                                    <con2:wsCallout>
                                                                                                        <con1:id>_ActionId-3983233839552650961--de8752b.15d4d639764.-7f15</con1:id>
                                                                                                        <con2:service ref="PortalCautivo/Proxy Services/LCPSConsultaYCreaSaldoICC" xsi:type="con:PipelineRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                                                        <con2:operation>setNextelActiveProduct</con2:operation>
                                                                                                        <con2:request>
                                                                                                            <con2:body>ConsultaICCR</con2:body>
                                                                                                        </con2:request>
                                                                                                        <con2:response>
                                                                                                            <con2:body>ConsultaICCResponse</con2:body>
                                                                                                        </con2:response>
                                                                                                        <con2:requestTransform>
                                                                                                            <con2:assign varName="ConsultaICCR">
                                                                                                                <con1:id>_ActionId-3983233839552650961--de8752b.15d4d639764.-7f1d</con1:id>
                                                                                                                <con2:expr>
                                                                                                                    <con1:xqueryText><![CDATA[<cap:setNextelActiveProduct xmlns:cap="http://captive.portal.ws.ncl.nii.com">
    <phone_number>{$body/cap:setNextelActiveProduct/phone_number/text()}</phone_number>
    <tariff_prod>{$body/cap:setNextelActiveProduct/tariff_prod/text()}</tariff_prod>
    <tecnologia>3G</tecnologia>
    <imsi>{$body/cap:setNextelActiveProduct/lc_imsi/text()}</imsi>
    <id_pcrf_prod>{$body/cap:setNextelActiveProduct/id_pcrf_prod/text()}</id_pcrf_prod>
    <unitFree>{$body/cap:setNextelActiveProduct/unit_free/text()}</unitFree>
    <startDateTime>{$StartDateTime}</startDateTime>
    <endDateTime>{$EndDateTime}</endDateTime>
    <iniciaDate>{$ActualDate}</iniciaDate>  
    <finDate>{$TotalDate}</finDate>	
    <flagDesactivaExiste>{if($body/cap:setNextelActiveProduct/channel_act/text() = 'PORTAL') then 
('1')else()}</flagDesactivaExiste>	
 </cap:setNextelActiveProduct>]]></con1:xqueryText>
                                                                                                                </con2:expr>
                                                                                                            </con2:assign>
                                                                                                        </con2:requestTransform>
                                                                                                        <con2:responseTransform>
                                                                                                            <con2:assign varName="ConsultaICCRes">
                                                                                                                <con1:id>_ActionId-3983233839552650961--de8752b.15d4d639764.-7f1c</con1:id>
                                                                                                                <con2:expr>
                                                                                                                    <con1:xqueryText>$ConsultaICCResponse</con1:xqueryText>
                                                                                                                </con2:expr>
                                                                                                            </con2:assign>
                                                                                                            <con2:assign varName="errorLC">
                                                                                                                <con1:id>_ActionId-3983233839552650961--de8752b.15d4d639764.-7f1b</con1:id>
                                                                                                                <con2:expr>
                                                                                                                    <con1:xqueryText>data($ConsultaICCRes/error_code)</con1:xqueryText>
                                                                                                                </con2:expr>
                                                                                                            </con2:assign>
                                                                                                            <con2:assign varName="cadenaBucket">
                                                                                                                <con1:id>_ActionId-3983233839552650961--de8752b.15d4d639764.-7f1a</con1:id>
                                                                                                                <con2:expr>
                                                                                                                    <con1:xqueryText>data($ConsultaICCRes/cadenaBucket)</con1:xqueryText>
                                                                                                                </con2:expr>
                                                                                                            </con2:assign>
                                                                                                            <con1:ifThenElse xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                                                                                                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3983233839552650961--de8752b.15d4d639764.-7f19</con5:id>
                                                                                                                <con1:case>
                                                                                                                    <con1:condition>
                                                                                                                        <con4:xqueryConditionExpr xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                                                                            <con4:compExpr operator="!=">
                                                                                                                                <con4:leftPath>data($errorLC)</con4:leftPath>
                                                                                                                                <con4:rightPath>'0'</con4:rightPath>
                                                                                                                            </con4:compExpr>
                                                                                                                        </con4:xqueryConditionExpr>
                                                                                                                    </con1:condition>
                                                                                                                    <con1:actions>
                                                                                                                        <con1:replace varName="body" contents-only="true">
                                                                                                                            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3983233839552650961--de8752b.15d4d639764.-7f17</con5:id>
                                                                                                                            <con1:expr>
                                                                                                                                <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config"><![CDATA[<cap:setNextelActiveProductResponse xmlns:cap="http://captive.portal.ws.ncl.nii.com">
 <error_code>{data($ConsultaICCRes/error_code)}</error_code>
 <err_description>{data($ConsultaICCRes/err_description)}</err_description>
</cap:setNextelActiveProductResponse>]]></con5:xqueryText>
                                                                                                                            </con1:expr>
                                                                                                                        </con1:replace>
                                                                                                                        <con4:reply xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                                                                            <con4:id>_ActionId-3983233839552650961--de8752b.15d4d639764.-7f16</con4:id>
                                                                                                                        </con4:reply>
                                                                                                                    </con1:actions>
                                                                                                                </con1:case>
                                                                                                                <con1:default/>
                                                                                                            </con1:ifThenElse>
                                                                                                        </con2:responseTransform>
                                                                                                    </con2:wsCallout>
                                                                                                </con2:default>
                                                                                            </con2:ifThenElse>
                                                                                        </con2:actions>
                                                                                    </con2:case>
                                                                                    <con2:default>
                                                                                        <con2:Error>
                                                                                            <con1:id>_ActionId-521356982271692406--3b5917de.15d12e6197c.-7f00</con1:id>
                                                                                            <con2:errCode>1</con2:errCode>
                                                                                            <con2:message>Error m√©todo pago</con2:message>
                                                                                        </con2:Error>
                                                                                    </con2:default>
                                                                                </con2:ifThenElse>
                                                                            </con2:actions>
                                                                        </con2:case>
                                                                        <con2:default>
                                                                            <con2:wsCallout>
                                                                                <con1:id>_ActionId-521356982271692406--3b5917de.15d12e6197c.-7ebc</con1:id>
                                                                                <con2:service ref="PortalCautivo/Proxy Services/LCPSDesactivaSRV" xsi:type="con:PipelineRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                                <con2:operation>setNextelActiveProduct</con2:operation>
                                                                                <con2:request>
                                                                                    <con2:body>desactivaReq</con2:body>
                                                                                </con2:request>
                                                                                <con2:response>
                                                                                    <con2:body>desactivaResp</con2:body>
                                                                                </con2:response>
                                                                                <con2:requestTransform>
                                                                                    <con2:assign varName="desactivaReq">
                                                                                        <con1:id>_ActionId-521356982271692406--3b5917de.15d12e6197c.-7ec2</con1:id>
                                                                                        <con2:expr>
                                                                                            <con1:xqueryText><![CDATA[<cap:setNextelActiveProduct xmlns:cap="http://captive.portal.ws.ncl.nii.com">
    <client_name>{$body/cap:setNextelActiveProduct/channel_act/text()}</client_name>
    <traffic_type>{$body/cap:setNextelActiveProduct/traffic_type/text()}</traffic_type>
    <imsi>{$body/cap:setNextelActiveProduct/lc_imsi/text()}</imsi>
    <id_pcrf_prod>{$body/cap:setNextelActiveProduct/id_pcrf_prod/text()}</id_pcrf_prod>
    <flagDesactivaExiste>1</flagDesactivaExiste>
	
    <unitFree>{$body/cap:setNextelActiveProduct/unit_free/text()}</unitFree>
    <cadenaInicioDate>{$StartDateTime}</cadenaInicioDate>
    <cadenaFinDate>{$EndDateTime}</cadenaFinDate>
    <iniciaDate>{$ActualDate}</iniciaDate>
    <finDate>{$TotalDate}</finDate>	
</cap:setNextelActiveProduct>]]></con1:xqueryText>
                                                                                        </con2:expr>
                                                                                    </con2:assign>
                                                                                </con2:requestTransform>
                                                                                <con2:responseTransform>
                                                                                    <con2:assign varName="desactivarErrorSrv">
                                                                                        <con1:id>_ActionId-521356982271692406--3b5917de.15d12e6197c.-7ec1</con1:id>
                                                                                        <con2:expr>
                                                                                            <con1:xqueryText>data($desactivaResp/error_code)</con1:xqueryText>
                                                                                        </con2:expr>
                                                                                    </con2:assign>
                                                                                    <con2:assign varName="desactivarErrorDescSrv">
                                                                                        <con1:id>_ActionId-521356982271692406--3b5917de.15d12e6197c.-7ec0</con1:id>
                                                                                        <con2:expr>
                                                                                            <con1:xqueryText>data($desactivaResp/err_description)</con1:xqueryText>
                                                                                        </con2:expr>
                                                                                    </con2:assign>
                                                                                    <con1:ifThenElse xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-521356982271692406--3b5917de.15d12e6197c.-7ebf</con5:id>
                                                                                        <con1:case>
                                                                                            <con1:condition>
                                                                                                <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">$desactivarErrorSrv != '0' and $desactivarErrorSrv != 'OK-0001'</con5:xqueryText>
                                                                                            </con1:condition>
                                                                                            <con1:actions>
                                                                                                <con1:replace varName="body" contents-only="true">
                                                                                                    <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-521356982271692406--3b5917de.15d12e6197c.-7ebe</con5:id>
                                                                                                    <con1:expr>
                                                                                                        <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config"><![CDATA[<cap:setNextelActiveProductResponse xmlns:cap="http://captive.portal.ws.ncl.nii.com">
   <error_code>{$desactivarErrorSrv}</error_code>
   <err_description>{$desactivarErrorDescSrv}</err_description>
</cap:setNextelActiveProductResponse>]]></con5:xqueryText>
                                                                                                    </con1:expr>
                                                                                                </con1:replace>
                                                                                                <con4:reply xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                                                    <con4:id>_ActionId-521356982271692406--3b5917de.15d12e6197c.-7ebd</con4:id>
                                                                                                </con4:reply>
                                                                                            </con1:actions>
                                                                                        </con1:case>
                                                                                        <con1:default/>
                                                                                    </con1:ifThenElse>
                                                                                </con2:responseTransform>
                                                                            </con2:wsCallout>
                                                                            <con2:ifThenElse>
                                                                                <con1:id>_ActionId-521356982271692406--3b5917de.15d12e6197c.-7e91</con1:id>
                                                                                <con2:case>
                                                                                    <con2:condition>
                                                                                        <con1:xqueryText>$desactivarErrorSrv = '0'</con1:xqueryText>
                                                                                    </con2:condition>
                                                                                    <con2:actions>
                                                                                        <con1:wsCallout xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                                                                            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-521356982271692406--3b5917de.15d12e6197c.-7e02</con5:id>
                                                                                            <con1:service xsi:type="ref:ProxyRef" ref="PCRF/Proxy Services/PSPcrfService" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                                            <con1:operation>subscribeService</con1:operation>
                                                                                            <con1:request>
                                                                                                <con1:param>
                                                                                                    <con1:name>inPara</con1:name>
                                                                                                    <con1:variable>subscribeServiceReq</con1:variable>
                                                                                                </con1:param>
                                                                                            </con1:request>
                                                                                            <con1:response>
                                                                                                <con1:param>
                                                                                                    <con1:name>result</con1:name>
                                                                                                    <con1:variable>subscribeServiceResponse</con1:variable>
                                                                                                </con1:param>
                                                                                            </con1:response>
                                                                                            <con1:requestTransform>
                                                                                                <con1:assign varName="subscribeServiceReq">
                                                                                                    <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-521356982271692406--3b5917de.15d12e6197c.-7e08</con5:id>
                                                                                                    <con1:expr>
                                                                                                        <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config"><![CDATA[<inPara>
	<subscriber>
	   <!--1 or more repetitions:-->
	   <attribute>
		  <key>USRIDENTIFIER</key>
		  <value>{data($body/cap:setNextelActiveProduct/lc_imsi)}</value>
	   </attribute>
	</subscriber>
	<!--Zero or more repetitions:-->
	<subscribedService>
	   <!--1 or more repetitions:-->
	   <attribute>
		  <key>SRVNAME</key>
		  <value>{data($body/cap:setNextelActiveProduct/id_pcrf_prod)}</value>
	   </attribute>
	   <attribute>
		  <key>srvStartDateTime</key>
		  <value>{$StartDateTime}</value>
	   </attribute>
	   <attribute>
		  <key>srvEndDateTime</key>
		  <value>{$EndDateTime}</value>
	   </attribute>
	</subscribedService>
 </inPara>]]></con4:xqueryText>
                                                                                                    </con1:expr>
                                                                                                </con1:assign>
                                                                                            </con1:requestTransform>
                                                                                            <con1:responseTransform>
                                                                                                <con1:assign varName="subscribeServResp">
                                                                                                    <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-521356982271692406--3b5917de.15d12e6197c.-7e07</con5:id>
                                                                                                    <con1:expr>
                                                                                                        <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$subscribeServiceResponse</con4:xqueryText>
                                                                                                    </con1:expr>
                                                                                                </con1:assign>
                                                                                                <con1:ifThenElse>
                                                                                                    <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-521356982271692406--3b5917de.15d12e6197c.-7e06</con5:id>
                                                                                                    <con1:case>
                                                                                                        <con1:condition>
                                                                                                            <con4:xqueryConditionExpr xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                                                                <con4:compExpr operator="!=">
                                                                                                                    <con4:leftPath>data($subscribeServResp/resultCode)</con4:leftPath>
                                                                                                                    <con4:rightPath>'0'</con4:rightPath>
                                                                                                                </con4:compExpr>
                                                                                                            </con4:xqueryConditionExpr>
                                                                                                        </con1:condition>
                                                                                                        <con1:actions>
                                                                                                            <con1:replace varName="body" contents-only="true">
                                                                                                                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-521356982271692406--3b5917de.15d12e6197c.-7e04</con5:id>
                                                                                                                <con1:expr>
                                                                                                                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config"><![CDATA[<cap:setNextelActiveProductResponse xmlns:cap="http://captive.portal.ws.ncl.nii.com">
 <error_code>{data($subscribeServResp/resultCode)}</error_code>
 <err_description>{fn:concat('Key: ',data($subscribeServResp/paras/key),' - Value: ' ,data($subscribeServResp/paras/value))}</err_description>
</cap:setNextelActiveProductResponse>]]></con5:xqueryText>
                                                                                                                </con1:expr>
                                                                                                            </con1:replace>
                                                                                                            <con4:reply xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                                                                <con4:id>_ActionId-521356982271692406--3b5917de.15d12e6197c.-7e03</con4:id>
                                                                                                            </con4:reply>
                                                                                                        </con1:actions>
                                                                                                    </con1:case>
                                                                                                    <con1:default/>
                                                                                                </con1:ifThenElse>
                                                                                            </con1:responseTransform>
                                                                                        </con1:wsCallout>
                                                                                    </con2:actions>
                                                                                </con2:case>
                                                                                <con2:default/>
                                                                            </con2:ifThenElse>
                                                                        </con2:default>
                                                                    </con2:ifThenElse>
                                                                </con2:actions>
                                                            </con2:case>
                                                            <con2:default>
                                                                <con2:wsCallout>
                                                                    <con1:id>_ActionId-3706191329915299395-565235fc.15d0e4d3360.-790f</con1:id>
                                                                    <con2:service ref="PortalCautivo/Proxy Services/LCPSDesactivaSRV" xsi:type="con:PipelineRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                    <con2:operation>setNextelActiveProduct</con2:operation>
                                                                    <con2:request>
                                                                        <con2:body>desactivaReq</con2:body>
                                                                    </con2:request>
                                                                    <con2:response>
                                                                        <con2:body>desactivaResp</con2:body>
                                                                    </con2:response>
                                                                    <con2:requestTransform>
                                                                        <con2:assign varName="desactivaReq">
                                                                            <con1:id>_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7919</con1:id>
                                                                            <con2:expr>
                                                                                <con1:xqueryText><![CDATA[<cap:setNextelActiveProduct xmlns:cap="http://captive.portal.ws.ncl.nii.com">
    <client_name>{$body/cap:setNextelActiveProduct/channel_act/text()}</client_name>
    <traffic_type>{$body/cap:setNextelActiveProduct/traffic_type/text()}</traffic_type>
    <imsi>{$body/cap:setNextelActiveProduct/lc_imsi/text()}</imsi>
    <id_pcrf_prod>{$body/cap:setNextelActiveProduct/id_pcrf_prod/text()}</id_pcrf_prod>
    <flagDesactivaExiste>1</flagDesactivaExiste>
	
    <unitFree>{$body/cap:setNextelActiveProduct/unit_free/text()}</unitFree>
    <cadenaInicioDate>{$StartDateTime}</cadenaInicioDate>
    <cadenaFinDate>{$EndDateTime}</cadenaFinDate>
    <iniciaDate>{$ActualDate}</iniciaDate>
    <finDate>{$TotalDate}</finDate>	
</cap:setNextelActiveProduct>]]></con1:xqueryText>
                                                                            </con2:expr>
                                                                        </con2:assign>
                                                                    </con2:requestTransform>
                                                                    <con2:responseTransform>
                                                                        <con2:assign varName="desactivarErrorSrv">
                                                                            <con1:id>_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7918</con1:id>
                                                                            <con2:expr>
                                                                                <con1:xqueryText>data($desactivaResp/error_code)</con1:xqueryText>
                                                                            </con2:expr>
                                                                        </con2:assign>
                                                                        <con2:assign varName="desactivarErrorDescSrv">
                                                                            <con1:id>_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7917</con1:id>
                                                                            <con2:expr>
                                                                                <con1:xqueryText>data($desactivaResp/err_description)</con1:xqueryText>
                                                                            </con2:expr>
                                                                        </con2:assign>
                                                                        <con1:ifThenElse xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                                                            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7916</con5:id>
                                                                            <con1:case>
                                                                                <con1:condition>
                                                                                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">$desactivarErrorSrv != '0' and $desactivarErrorSrv != 'OK-0001'</con5:xqueryText>
                                                                                </con1:condition>
                                                                                <con1:actions>
                                                                                    <con1:replace varName="body" contents-only="true">
                                                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7911</con5:id>
                                                                                        <con1:expr>
                                                                                            <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config"><![CDATA[<cap:setNextelActiveProductResponse xmlns:cap="http://captive.portal.ws.ncl.nii.com">
   <error_code>{$desactivarErrorSrv}</error_code>
   <err_description>{$desactivarErrorDescSrv}</err_description>
</cap:setNextelActiveProductResponse>]]></con5:xqueryText>
                                                                                        </con1:expr>
                                                                                    </con1:replace>
                                                                                    <con4:reply xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                                        <con4:id>_ActionId-3706191329915299395-565235fc.15d0e4d3360.-7910</con4:id>
                                                                                    </con4:reply>
                                                                                </con1:actions>
                                                                            </con1:case>
                                                                            <con1:default/>
                                                                        </con1:ifThenElse>
                                                                    </con2:responseTransform>
                                                                </con2:wsCallout>
                                                                <con2:ifThenElse>
                                                                    <con1:id>_ActionId-3706191329915299395-565235fc.15d0e4d3360.-799c</con1:id>
                                                                    <con2:case>
                                                                        <con2:condition>
                                                                            <con1:xqueryText>$desactivarErrorSrv = '0'</con1:xqueryText>
                                                                        </con2:condition>
                                                                        <con2:actions>
                                                                            <con1:wsCallout xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                                                                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3706191329915299395-565235fc.15d0e4d3360.-77de</con5:id>
                                                                                <con1:service xsi:type="ref:ProxyRef" ref="PCRF/Proxy Services/PSPcrfService" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                                <con1:operation>subscribeService</con1:operation>
                                                                                <con1:request>
                                                                                    <con1:param>
                                                                                        <con1:name>inPara</con1:name>
                                                                                        <con1:variable>subscribeServiceReq</con1:variable>
                                                                                    </con1:param>
                                                                                </con1:request>
                                                                                <con1:response>
                                                                                    <con1:param>
                                                                                        <con1:name>result</con1:name>
                                                                                        <con1:variable>subscribeServiceResponse</con1:variable>
                                                                                    </con1:param>
                                                                                </con1:response>
                                                                                <con1:requestTransform>
                                                                                    <con1:assign varName="subscribeServiceReq">
                                                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3706191329915299395-565235fc.15d0e4d3360.-77e4</con5:id>
                                                                                        <con1:expr>
                                                                                            <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config"><![CDATA[<inPara>
	<subscriber>
	   <!--1 or more repetitions:-->
	   <attribute>
		  <key>USRIDENTIFIER</key>
		  <value>{data($body/cap:setNextelActiveProduct/lc_imsi)}</value>
	   </attribute>
	</subscriber>
	<!--Zero or more repetitions:-->
	<subscribedService>
	   <!--1 or more repetitions:-->
	   <attribute>
		  <key>SRVNAME</key>
		  <value>{data($body/cap:setNextelActiveProduct/id_pcrf_prod)}</value>
	   </attribute>
	   <attribute>
		  <key>srvStartDateTime</key>
		  <value>{$StartDateTime}</value>
	   </attribute>
	   <attribute>
		  <key>srvEndDateTime</key>
		  <value>{$EndDateTime}</value>
	   </attribute>
	</subscribedService>
 </inPara>]]></con4:xqueryText>
                                                                                        </con1:expr>
                                                                                    </con1:assign>
                                                                                </con1:requestTransform>
                                                                                <con1:responseTransform>
                                                                                    <con1:assign varName="subscribeServResp">
                                                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3706191329915299395-565235fc.15d0e4d3360.-77e3</con5:id>
                                                                                        <con1:expr>
                                                                                            <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$subscribeServiceResponse</con4:xqueryText>
                                                                                        </con1:expr>
                                                                                    </con1:assign>
                                                                                    <con1:ifThenElse>
                                                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3706191329915299395-565235fc.15d0e4d3360.-77e2</con5:id>
                                                                                        <con1:case>
                                                                                            <con1:condition>
                                                                                                <con4:xqueryConditionExpr xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                                                    <con4:compExpr operator="!=">
                                                                                                        <con4:leftPath>data($subscribeServResp/resultCode)</con4:leftPath>
                                                                                                        <con4:rightPath>'0'</con4:rightPath>
                                                                                                    </con4:compExpr>
                                                                                                </con4:xqueryConditionExpr>
                                                                                            </con1:condition>
                                                                                            <con1:actions>
                                                                                                <con1:replace varName="body" contents-only="true">
                                                                                                    <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3706191329915299395-565235fc.15d0e4d3360.-77e0</con5:id>
                                                                                                    <con1:expr>
                                                                                                        <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config"><![CDATA[<cap:setNextelActiveProductResponse xmlns:cap="http://captive.portal.ws.ncl.nii.com">
 <error_code>{data($subscribeServResp/resultCode)}</error_code>
 <err_description>{fn:concat('Key: ',data($subscribeServResp/paras/key),' - Value: ' ,data($subscribeServResp/paras/value))}</err_description>
</cap:setNextelActiveProductResponse>]]></con5:xqueryText>
                                                                                                    </con1:expr>
                                                                                                </con1:replace>
                                                                                                <con4:reply xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                                                    <con4:id>_ActionId-3706191329915299395-565235fc.15d0e4d3360.-77df</con4:id>
                                                                                                </con4:reply>
                                                                                            </con1:actions>
                                                                                        </con1:case>
                                                                                        <con1:default/>
                                                                                    </con1:ifThenElse>
                                                                                </con1:responseTransform>
                                                                            </con1:wsCallout>
                                                                        </con2:actions>
                                                                    </con2:case>
                                                                    <con2:default/>
                                                                </con2:ifThenElse>
                                                            </con2:default>
                                                        </con2:ifThenElse>
                                                    </con2:actions>
                                                </con2:case>
                                                <con2:default>
                                                    <con2:Error>
                                                        <con1:id>_ActionId-3706191329915299395-565235fc.15d0e4d3360.-79e6</con1:id>
                                                        <con2:errCode>1</con2:errCode>
                                                        <con2:message>Error: Producto Invalido</con2:message>
                                                    </con2:Error>
                                                </con2:default>
                                            </con2:ifThenElse>
                                        </con2:actions>
                                    </con2:case>
                                    <con2:default>
                                        <con2:Error>
                                            <con1:id>_ActionId-3602376958848697374--7242e8b0.15d08bfc312.-7d07</con1:id>
                                            <con2:errCode>1</con2:errCode>
                                            <con2:message>Error: Ingreso segmento invalido.</con2:message>
                                        </con2:Error>
                                    </con2:default>
                                </con2:ifThenElse>
                            </con2:actions>
                        </con2:case>
                        <con2:default>
                            <con2:Error>
                                <con1:id>_ActionId-4167845050929980214--2051313f.13fc8db7d1b.-7512</con1:id>
                                <con2:errCode>0101</con2:errCode>
                                <con2:message>no coincide con este flujo Dat.</con2:message>
                            </con2:Error>
                        </con2:default>
                    </con2:ifThenElse>
                </con:actions>
            </con:stage>
            <con:stage name="In_stg_RegistraAltaDat">
                <con:context>
                    <con1:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/PROVI_BOLS/NII_BSCS_PORTAL_CAUTIVO_PKG/REGISTRA_ALTA_PRODUCTOS_PRC/" prefix="al"/>
                    <con1:varNsDecl namespace="http://captive.portal.ws.ncl.nii.com" prefix="cap"/>
                </con:context>
                <con:actions>
                    <con2:wsCallout>
                        <con1:id>_ActionId-1410913502282591576--57abb68d.164f77c3c54.-6b9d</con1:id>
                        <con2:service xsi:type="ref:ProxyRef" ref="BenePro/Proxy Services/PSRecv" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>aplicarPromocion</con2:operation>
                        <con2:request>
                            <con2:body>aplicaPromocionReq</con2:body>
                        </con2:request>
                        <con2:response>
                            <con2:body>aplicaPromocionResp</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                            <con2:replace varName="aplicaPromocionReq">
                                <con1:id>_ActionId-1410913502282591576--57abb68d.164f77c3c54.-6ba0</con1:id>
                                <con2:expr>
                                    <con1:xqueryTransform>
                                        <con1:resource ref="PortalCautivo/Resources/XQuery/IN_XQ_BenePro_AplicaPromociones"/>
                                        <con1:param name="segment_prod">
                                            <con1:path>normalize-space($body/cap:setNextelActiveProduct/segment_prod/text())</con1:path>
                                        </con1:param>
                                        <con1:param name="id_pcrf_prod">
                                            <con1:path>normalize-space($body/cap:setNextelActiveProduct/id_pcrf_prod/text())</con1:path>
                                        </con1:param>
                                        <con1:param name="traffic_type">
                                            <con1:path>normalize-space($body/cap:setNextelActiveProduct/traffic_type/text())</con1:path>
                                        </con1:param>
                                        <con1:param name="type_prod_bscs">
                                            <con1:path>normalize-space($body/cap:setNextelActiveProduct/type_prod_bscs/text())</con1:path>
                                        </con1:param>
                                        <con1:param name="tariff_prod">
                                            <con1:path>normalize-space($body/cap:setNextelActiveProduct/tariff_prod/text())</con1:path>
                                        </con1:param>
                                        <con1:param name="vigencia">
                                            <con1:path>normalize-space($body/cap:setNextelActiveProduct/vigencia/text())</con1:path>
                                        </con1:param>
                                        <con1:param name="channel_act">
                                            <con1:path>normalize-space($body/cap:setNextelActiveProduct/channel_act/text())</con1:path>
                                        </con1:param>
                                        <con1:param name="id_prod">
                                            <con1:path>normalize-space($body/cap:setNextelActiveProduct/id_prod/text())</con1:path>
                                        </con1:param>
                                        <con1:param name="rate_plan">
                                            <con1:path>normalize-space($body/cap:setNextelActiveProduct/rate_plan/text())</con1:path>
                                        </con1:param>
                                        <con1:param name="phone_number">
                                            <con1:path>normalize-space($body/cap:setNextelActiveProduct/phone_number/text())</con1:path>
                                        </con1:param>
                                        <con1:param name="cod_plan">
                                            <con1:path>normalize-space($body/cap:setNextelActiveProduct/codPlan/text())</con1:path>
                                        </con1:param>
                                    </con1:xqueryTransform>
                                </con2:expr>
                            </con2:replace>
                        </con2:requestTransform>
                        <con2:responseTransform>
                            <con2:assign varName="codigoPromo">
                                <con1:id>_ActionId-1410913502282591576--57abb68d.164f77c3c54.-6b9f</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>$aplicaPromocionResp/return/codigo/text()</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:assign varName="codNullReplace">
                                <con1:id>_ActionId-1410913502282591576--57abb68d.164f77c3c54.-6b9e</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>if(empty($codigoPromo)) then (
$aplicaPromocionResp/return/descripcion/text()
) else
($codigoPromo)</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                        </con2:responseTransform>
                    </con2:wsCallout>
                    <con2:wsCallout>
                        <con1:id>_ActionId-1410913502282591576--57abb68d.164f77c3c54.-6b8f</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="PortalCautivo/Business Services/BSRegistraAltaProductosDBA" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>RegistraAltaProductosDBA</con2:operation>
                        <con2:request>
                            <con2:body>RegistraAltaProd</con2:body>
                        </con2:request>
                        <con2:response>
                            <con2:body>RegistraAltaProdResponse</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                            <con2:assign varName="RegistraAltaProd">
                                <con1:id>_ActionId-1410913502282591576--57abb68d.164f77c3c54.-6b95</con1:id>
                                <con2:expr>
                                    <con1:xqueryText><![CDATA[<reg:InputParameters xmlns:reg="http://xmlns.oracle.com/pcbpel/adapter/db/PROVI_BOLS/NII_BSCS_PORTAL_CAUTIVO_PKG/REGISTRA_ALTA_PRODUCTOS_PRC/">
    <reg:P_IMSI>{data($body/cap:setNextelActiveProduct/lc_imsi)}</reg:P_IMSI>
    <reg:P_PHONE_NUMBER>{data($body/cap:setNextelActiveProduct/phone_number)}</reg:P_PHONE_NUMBER>
    <reg:P_CUSTOMER_ID>{data($body/cap:setNextelActiveProduct/lc_customer)}</reg:P_CUSTOMER_ID>
    <reg:P_ID_PROD>{data($body/cap:setNextelActiveProduct/id_prod)}</reg:P_ID_PROD>
    <reg:P_ID_PCRF_PROD>{data($body/cap:setNextelActiveProduct/id_pcrf_prod)}</reg:P_ID_PCRF_PROD>
    <reg:P_ID_BSCS_PROD>{data($body/cap:setNextelActiveProduct/id_bscs_prod)}</reg:P_ID_BSCS_PROD>
    <reg:P_CLIENT_NAME>{data($body/cap:setNextelActiveProduct/channel_act)}</reg:P_CLIENT_NAME>
    <reg:P_DATE_BUY>{data(fn:concat(fn-bea:date-to-string-with-format("MM-dd-yyyy",xs:date($LCActualFecha))," ",fn-bea:time-to-string-with-format("HH:mm:ss", xs:time($LCActualHora))))}</reg:P_DATE_BUY>
    <reg:P_ESTADO_ASIGNADO>{$cadenaBucket}</reg:P_ESTADO_ASIGNADO>
    <reg:P_METODO_PAGO>{data($body/cap:setNextelActiveProduct/metodo_pago)}</reg:P_METODO_PAGO>
    <reg:P_FECHA_EXPIRACION>{fn:concat(fn-bea:date-to-string-with-format("MM-dd-yyyy",xs:date($LCFecha))," ",fn-bea:time-to-string-with-format("HH:mm:ss",xs:time($LCHora)))}</reg:P_FECHA_EXPIRACION>
    <reg:PV_PLAN>{$body/cap:setNextelActiveProduct/rate_plan/text()}</reg:PV_PLAN>
    <reg:PV_TICKET_PROMO>{$codNullReplace}</reg:PV_TICKET_PROMO>
    <reg:PV_FILE_1></reg:PV_FILE_1>
    <reg:PV_FILE_2></reg:PV_FILE_2>
    <reg:PV_FILE_3></reg:PV_FILE_3>
</reg:InputParameters>]]></con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                        </con2:requestTransform>
                        <con2:responseTransform>
                            <con2:assign varName="LC_SN_COD_RETORNO">
                                <con1:id>_ActionId-1410913502282591576--57abb68d.164f77c3c54.-6b94</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>data($RegistraAltaProdResponse/al:SN_COD_RETORNO)</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:assign varName="LC_SQ_TRANSACTION_CODE_BUY">
                                <con1:id>_ActionId-1410913502282591576--57abb68d.164f77c3c54.-6b93</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>data($RegistraAltaProdResponse/al:SV_SQ_TRANSACTION_CODE_BUY)</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con1:ifThenElse xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-1410913502282591576--57abb68d.164f77c3c54.-6b92</con5:id>
                                <con1:case>
                                    <con1:condition>
                                        <con4:xqueryConditionExpr xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                            <con4:boolExpr operator="or">
                                                <con4:compExpr operator="!=">
                                                    <con4:leftPath>data($LC_SN_COD_RETORNO)</con4:leftPath>
                                                    <con4:rightPath>'0'</con4:rightPath>
                                                </con4:compExpr>
                                                <con4:compExpr operator="=">
                                                    <con4:leftPath>data($LC_SQ_TRANSACTION_CODE_BUY)</con4:leftPath>
                                                    <con4:rightPath>'1'</con4:rightPath>
                                                </con4:compExpr>
                                            </con4:boolExpr>
                                        </con4:xqueryConditionExpr>
                                    </con1:condition>
                                    <con1:actions>
                                        <con1:replace varName="body" contents-only="true">
                                            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-1410913502282591576--57abb68d.164f77c3c54.-6b91</con5:id>
                                            <con1:expr>
                                                <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config"><![CDATA[<cap:setNextelActiveProductResponse xmlns:cap="http://captive.portal.ws.ncl.nii.com">
 <transaction_code></transaction_code>
 <error_code>{$LC_SN_COD_RETORNO}</error_code>
 <err_description>{data(data($RegistraAltaProdResp/al:SV_MENS_RETORNO))}</err_description>
</cap:setNextelActiveProductResponse>]]></con5:xqueryText>
                                            </con1:expr>
                                        </con1:replace>
                                        <con4:reply xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                            <con4:id>_ActionId-1410913502282591576--57abb68d.164f77c3c54.-6b90</con4:id>
                                        </con4:reply>
                                    </con1:actions>
                                </con1:case>
                                <con1:default/>
                            </con1:ifThenElse>
                        </con2:responseTransform>
                    </con2:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage name="In_stg_validaRegistro">
                <con:context>
                    <con1:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/validaTransaccioDBA" prefix="val"/>
                    <con1:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/ValidaTransacBonific" prefix="vals"/>
                    <con1:varNsDecl namespace="http://captive.portal.ws.ncl.nii.com" prefix="cap"/>
                </con:context>
                <con:actions>
                    <con2:wsCallout>
                        <con1:id>_ActionId-1410913502282591576--57abb68d.164f77c3c54.-6b4f</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="PortalCautivo/Business Services/BSValidaTransaccioDBA" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>validaTransaccioDBA</con2:operation>
                        <con2:request>
                            <con2:body>validaTransaccioDBA</con2:body>
                        </con2:request>
                        <con2:response>
                            <con2:body>validaTransaccioDBAResponse</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                            <con2:assign varName="validaTransaccioDBA">
                                <con1:id>_ActionId-1410913502282591576--57abb68d.164f77c3c54.-6b53</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>&lt;val:validaTransaccioDBAInput xmlns:val="http://xmlns.oracle.com/pcbpel/adapter/db/validaTransaccioDBA">
    &lt;val:transaction_code>{$LC_SQ_TRANSACTION_CODE_BUY}&lt;/val:transaction_code>
&lt;/val:validaTransaccioDBAInput></con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                        </con2:requestTransform>
                        <con2:responseTransform>
                            <con2:assign varName="LCValCount">
                                <con1:id>_ActionId-1410913502282591576--57abb68d.164f77c3c54.-6b52</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>data($validaTransaccioDBAResponse/val:valCount)</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con1:ifThenElse xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-1410913502282591576--57abb68d.164f77c3c54.-6b51</con5:id>
                                <con1:case>
                                    <con1:condition>
                                        <con4:xqueryConditionExpr xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                            <con4:compExpr operator="=">
                                                <con4:leftPath>$LCValCount</con4:leftPath>
                                                <con4:rightPath>'0'</con4:rightPath>
                                            </con4:compExpr>
                                        </con4:xqueryConditionExpr>
                                    </con1:condition>
                                    <con1:actions>
                                        <con1:Error>
                                            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-1410913502282591576--57abb68d.164f77c3c54.-6b50</con5:id>
                                            <con1:errCode>0</con1:errCode>
                                            <con1:message>La ejecucion se realizo pero no se registro la transaccion</con1:message>
                                        </con1:Error>
                                    </con1:actions>
                                </con1:case>
                                <con1:default/>
                            </con1:ifThenElse>
                        </con2:responseTransform>
                    </con2:wsCallout>
                    <con2:ifThenElse>
                        <con1:id>_ActionId-1410913502282591576--57abb68d.164f77c3c54.-6b46</con1:id>
                        <con2:case>
                            <con2:condition>
                                <con1:xqueryText>$body/cap:setNextelActiveProduct/segment_prod/text() = 'PREPAID'</con1:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:wsCallout>
                                    <con1:id>_ActionId-1410913502282591576--57abb68d.164f77c3c54.-6b41</con1:id>
                                    <con2:service xsi:type="ref:BusinessServiceRef" ref="PortalCautivo/Business Services/BSServiceGetMensajeSmsProducto" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con2:operation>getMensajeSmsProducto</con2:operation>
                                    <con2:request>
                                        <con2:body>getMensajeSmsProdReq</con2:body>
                                    </con2:request>
                                    <con2:response>
                                        <con2:body>getMensajeSmsProdResp</con2:body>
                                    </con2:response>
                                    <con2:requestTransform>
                                        <con2:assign varName="getMensajeSmsProdReq">
                                            <con1:id>_ActionId-1410913502282591576--57abb68d.164f77c3c54.-6b45</con1:id>
                                            <con2:expr>
                                                <con1:xqueryTransform>
                                                    <con1:resource ref="PortalCautivo/Resources/XQuery/IN_XQ_getMensajeSmsProduct"/>
                                                    <con1:param name="id_prod">
                                                        <con1:path>$body/cap:setNextelActiveProduct/id_prod/text()</con1:path>
                                                    </con1:param>
                                                    <con1:param name="id_prod_pcrf">
                                                        <con1:path>$body/cap:setNextelActiveProduct/id_pcrf_prod/text()</con1:path>
                                                    </con1:param>
                                                </con1:xqueryTransform>
                                            </con2:expr>
                                        </con2:assign>
                                    </con2:requestTransform>
                                    <con2:responseTransform/>
                                </con2:wsCallout>
                                <con4:route>
                                    <con1:id>_ActionId-1410913502282591576--57abb68d.164f77c3c54.-6961</con1:id>
                                    <con4:service ref="PortalCautivo/Business Services/BSServiceSendSMSSiebelRqRs" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con4:operation>sendSMS</con4:operation>
                                    <con4:outboundTransform>
                                        <con2:routing-options>
                                            <con1:id>_ActionId-1410913502282591576--57abb68d.164f77c3c54.-6960</con1:id>
                                            <con2:mode>request</con2:mode>
                                            <con2:qualityOfService>best-effort</con2:qualityOfService>
                                            <con2:retryCount>0</con2:retryCount>
                                        </con2:routing-options>
                                        <con2:replace contents-only="true" varName="body">
                                            <con1:id>_ActionId-1410913502282591576--57abb68d.164f77c3c54.-695f</con1:id>
                                            <con2:expr>
                                                <con1:xqueryTransform>
                                                    <con1:resource ref="PortalCautivo/Resources/XQuery/IN_XQ_SendSMSSiebel"/>
                                                    <con1:param name="nroCelular">
                                                        <con1:path>$body/cap:setNextelActiveProduct/phone_number/text()</con1:path>
                                                    </con1:param>
                                                    <con1:param name="producto">
                                                        <con1:path>$body/cap:setNextelActiveProduct/id_pcrf_prod/text()</con1:path>
                                                    </con1:param>
                                                    <con1:param name="getMensajeSmsProductoOutputCollection1">
                                                        <con1:path>$getMensajeSmsProdResp</con1:path>
                                                    </con1:param>
                                                </con1:xqueryTransform>
                                            </con2:expr>
                                        </con2:replace>
                                    </con4:outboundTransform>
                                </con4:route>
                            </con2:actions>
                        </con2:case>
                        <con2:default/>
                    </con2:ifThenElse>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="PipelinePairNode1_response" errorHandler="_onErrorHandler-4952591388299401645-3a5ea217.13faf2b6b35.-78e4">
            <con:stage name="Out_stg_DATOS">
                <con:context>
                    <con1:varNsDecl namespace="http://captive.portal.ws.ncl.nii.com" prefix="cap"/>
                </con:context>
                <con:actions>
                    <con1:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-4952591388299401645-3a5ea217.13faf2b6b35.-795c</con4:id>
                        <con1:expr>
                            <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config"><![CDATA[<cap:setNextelActiveProductResponse xmlns:cap="http://captive.portal.ws.ncl.nii.com">
   <transaction_code>{$LC_SQ_TRANSACTION_CODE_BUY}</transaction_code>
   <error_code>0</error_code>
   <err_description>OK</err_description>
</cap:setNextelActiveProductResponse>]]></con5:xqueryText>
                        </con1:expr>
                    </con1:replace>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-4952591388299401645-3a5ea217.13faf2b6b35.-795a">
            <con:stage name="In_stg_error_DATOS">
                <con:context/>
                <con:actions>
                    <con1:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-4952591388299401645-3a5ea217.13faf2b6b35.-78e6</con4:id>
                        <con1:expr>
                            <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config"><![CDATA[<cap:setNextelActiveProductResponse xmlns:cap="http://captive.portal.ws.ncl.nii.com">
   <error_code>{$fault/ctx:errorCode/text()}</error_code>
   <err_description>{$fault/ctx:reason/text()}</err_description>
</cap:setNextelActiveProductResponse>]]></con5:xqueryText>
                        </con1:expr>
                    </con1:replace>
                    <con4:reply xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                        <con4:id>_ActionId-4952591388299401645-3a5ea217.13faf2b6b35.-78e5</con4:id>
                    </con4:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-4952591388299401645-3a5ea217.13faf2b6b35.-78e4">
            <con:stage name="Out_stg_error_DATOS">
                <con:context/>
                <con:actions>
                    <con1:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-4952591388299401645-3a5ea217.13faf2b6b35.-7870</con4:id>
                        <con1:expr>
                            <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config"><![CDATA[<cap:setNextelActiveProductResponse xmlns:cap="http://captive.portal.ws.ncl.nii.com">
   <error_code>{$fault/ctx:errorCode/text()}</error_code>
   <err_description>{$fault/ctx:reason/text()}</err_description>
</cap:setNextelActiveProductResponse>]]></con5:xqueryText>
                        </con1:expr>
                    </con1:replace>
                    <con4:reply xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                        <con4:id>_ActionId-4952591388299401645-3a5ea217.13faf2b6b35.-786f</con4:id>
                    </con4:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:flow>
            <con:branch-node type="operation" name="BranchNode1">
                <con:context/>
                <con:branch-table>
                    <con:branch name="setNextelActiveProduct">
                        <con:operator>equals</con:operator>
                        <con:value/>
                        <con:flow>
                            <con:pipeline-node name="PipelinePairNode1">
                                <con:request>PipelinePairNode1_request</con:request>
                                <con:response>PipelinePairNode1_response</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:default-branch>
                        <con:flow/>
                    </con:default-branch>
                </con:branch-table>
            </con:branch-node>
        </con:flow>
    </con:router>
</con:pipelineEntry>